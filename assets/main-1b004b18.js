var Fr=Object.defineProperty;var Wr=(n,e,t)=>e in n?Fr(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var j=(n,e,t)=>(Wr(n,typeof e!="symbol"?e+"":e,t),t);class we{constructor(e){this.properties=e??[]}get(e){const t=this.properties.filter(s=>s.name===e).map(s=>s.value);if(t.length>1)throw new Error('Expected only one property to be named "'+e+'"');if(t.length!==0)return t[0]}getString(e){return this.getByType(e,"string")}getNumber(e){return this.getByType(e,"number")}getBoolean(e){return this.getByType(e,"boolean")}getByType(e,t){const s=this.get(e);if(s!==void 0){if(t!=="json"&&typeof s!==t)throw new Error('Expected property "'+e+'" to have type "'+t+'"');return s}}mustGetString(e){return this.mustGetByType(e,"string")}mustGetNumber(e){return this.mustGetByType(e,"number")}mustGetBoolean(e){return this.mustGetByType(e,"boolean")}mustGetByType(e,t){const s=this.get(e);if(s===void 0)throw new Error('Property "'+e+'" is missing');if(t!=="json"&&typeof s!==t)throw new Error('Expected property "'+e+'" to have type "'+t+'"');return s}getType(e){const t=this.properties.filter(s=>s.name===e).map(s=>s.type);if(t.length>1)throw new Error('Expected only one property to be named "'+e+'"');if(t.length!==0)return t[0]}}const Ts="https://unpkg.com/@workadventure/scripting-api-extra@1.7.4/dist";class Ir{constructor(e){this.name=e.name,this.x=e.x,this.y=e.y,this.properties=new we(e.properties)}get isReadable(){const e=this.properties.getString("readableBy");return e?WA.player.tags.includes(e):!0}get isWritable(){const e=this.properties.getString("writableBy");return e?WA.player.tags.includes(e):!0}}function qn(n){const e=n?"#"+n.join():"";WA.nav.openCoWebSite(Ts+"/configuration.html"+e,!0)}async function Lr(n,e){const t=await WA.room.getTiledMap(),s=new Map;return vs(t.layers,s,n,e),s}function vs(n,e,t,s){for(const r of n)if(r.type==="objectgroup"){for(const i of r.objects)if(i.type==="variable"||i.class==="variable"){if(t&&r.name!==t||s&&!s.includes(i.name))continue;e.set(i.name,new Ir(i))}}else r.type==="group"&&vs(r.layers,e,t,s)}let Vt;async function De(){return Vt===void 0&&(Vt=$r()),Vt}async function $r(){return Nr(await WA.room.getTiledMap())}function Nr(n){const e=new Map;return Os(n.layers,"",e),e}function Os(n,e,t){for(const s of n)s.type==="group"?Os(s.layers,e+s.name+"/",t):(s.name=e+s.name,t.set(s.name,s))}async function Ms(){const n=await De(),e=[];for(const t of n.values())if(t.type==="objectgroup")for(const s of t.objects)(s.type==="area"||s.class==="area")&&e.push(s);return e}function Br(n){let e=1/0,t=1/0,s=0,r=0;const i=n.data;if(typeof i=="string")throw new Error("Unsupported tile layer data stored as string instead of CSV");for(let a=0;a<n.height;a++)for(let o=0;o<n.width;o++)i[o+a*n.width]!==0&&(e=Math.min(e,o),r=Math.max(r,o),t=Math.min(t,a),s=Math.max(s,a));return{top:t,left:e,right:r+1,bottom:s+1}}function ks(n){let e=1/0,t=1/0,s=0,r=0;for(const i of n){const a=Br(i);a.left<e&&(e=a.left),a.top<t&&(t=a.top),a.right>r&&(r=a.right),a.bottom>s&&(s=a.bottom)}return{top:t,left:e,right:r,bottom:s}}/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */var jr=Object.prototype.toString,Se=Array.isArray||function(e){return jr.call(e)==="[object Array]"};function Sn(n){return typeof n=="function"}function Dr(n){return Se(n)?"array":typeof n}function Jt(n){return n.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function Hn(n,e){return n!=null&&typeof n=="object"&&e in n}function Ur(n,e){return n!=null&&typeof n!="object"&&n.hasOwnProperty&&n.hasOwnProperty(e)}var qr=RegExp.prototype.test;function Hr(n,e){return qr.call(n,e)}var Vr=/\S/;function Jr(n){return!Hr(Vr,n)}var Xr={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function Gr(n){return String(n).replace(/[&<>"'`=\/]/g,function(t){return Xr[t]})}var zr=/\s*/,Kr=/\s+/,Vn=/\s*=/,Qr=/\s*\}/,Yr=/#|\^|\/|>|\{|&|=|!/;function Zr(n,e){if(!n)return[];var t=!1,s=[],r=[],i=[],a=!1,o=!1,c="",l=0;function h(){if(a&&!o)for(;i.length;)delete r[i.pop()];else i=[];a=!1,o=!1}var u,w,b;function d(L){if(typeof L=="string"&&(L=L.split(Kr,2)),!Se(L)||L.length!==2)throw new Error("Invalid tags: "+L);u=new RegExp(Jt(L[0])+"\\s*"),w=new RegExp("\\s*"+Jt(L[1])),b=new RegExp("\\s*"+Jt("}"+L[1]))}d(e||B.tags);for(var p=new Ue(n),y,m,_,C,T,x;!p.eos();){if(y=p.pos,_=p.scanUntil(u),_)for(var O=0,M=_.length;O<M;++O)C=_.charAt(O),Jr(C)?(i.push(r.length),c+=C):(o=!0,t=!0,c+=" "),r.push(["text",C,y,y+1]),y+=1,C===`
`&&(h(),c="",l=0,t=!1);if(!p.scan(u))break;if(a=!0,m=p.scan(Yr)||"name",p.scan(zr),m==="="?(_=p.scanUntil(Vn),p.scan(Vn),p.scanUntil(w)):m==="{"?(_=p.scanUntil(b),p.scan(Qr),p.scanUntil(w),m="&"):_=p.scanUntil(w),!p.scan(w))throw new Error("Unclosed tag at "+p.pos);if(m==">"?T=[m,_,y,p.pos,c,l,t]:T=[m,_,y,p.pos],l++,r.push(T),m==="#"||m==="^")s.push(T);else if(m==="/"){if(x=s.pop(),!x)throw new Error('Unopened section "'+_+'" at '+y);if(x[1]!==_)throw new Error('Unclosed section "'+x[1]+'" at '+y)}else m==="name"||m==="{"||m==="&"?o=!0:m==="="&&d(_)}if(h(),x=s.pop(),x)throw new Error('Unclosed section "'+x[1]+'" at '+p.pos);return ti(ei(r))}function ei(n){for(var e=[],t,s,r=0,i=n.length;r<i;++r)t=n[r],t&&(t[0]==="text"&&s&&s[0]==="text"?(s[1]+=t[1],s[3]=t[3]):(e.push(t),s=t));return e}function ti(n){for(var e=[],t=e,s=[],r,i,a=0,o=n.length;a<o;++a)switch(r=n[a],r[0]){case"#":case"^":t.push(r),s.push(r),t=r[4]=[];break;case"/":i=s.pop(),i[5]=r[2],t=s.length>0?s[s.length-1][4]:e;break;default:t.push(r)}return e}function Ue(n){this.string=n,this.tail=n,this.pos=0}Ue.prototype.eos=function(){return this.tail===""};Ue.prototype.scan=function(e){var t=this.tail.match(e);if(!t||t.index!==0)return"";var s=t[0];return this.tail=this.tail.substring(s.length),this.pos+=s.length,s};Ue.prototype.scanUntil=function(e){var t=this.tail.search(e),s;switch(t){case-1:s=this.tail,this.tail="";break;case 0:s="";break;default:s=this.tail.substring(0,t),this.tail=this.tail.substring(t)}return this.pos+=s.length,s};function be(n,e){this.view=n,this.cache={".":this.view},this.parent=e}be.prototype.push=function(e){return new be(e,this)};be.prototype.lookup=function(e){var t=this.cache,s;if(t.hasOwnProperty(e))s=t[e];else{for(var r=this,i,a,o,c=!1;r;){if(e.indexOf(".")>0)for(i=r.view,a=e.split("."),o=0;i!=null&&o<a.length;)o===a.length-1&&(c=Hn(i,a[o])||Ur(i,a[o])),i=i[a[o++]];else i=r.view[e],c=Hn(r.view,e);if(c){s=i;break}r=r.parent}t[e]=s}return Sn(s)&&(s=s.call(this.view)),s};function N(){this.templateCache={_cache:{},set:function(e,t){this._cache[e]=t},get:function(e){return this._cache[e]},clear:function(){this._cache={}}}}N.prototype.clearCache=function(){typeof this.templateCache<"u"&&this.templateCache.clear()};N.prototype.parse=function(e,t){var s=this.templateCache,r=e+":"+(t||B.tags).join(":"),i=typeof s<"u",a=i?s.get(r):void 0;return a==null&&(a=Zr(e,t),i&&s.set(r,a)),a};N.prototype.render=function(e,t,s,r){var i=this.getConfigTags(r),a=this.parse(e,i),o=t instanceof be?t:new be(t,void 0);return this.renderTokens(a,o,s,e,r)};N.prototype.renderTokens=function(e,t,s,r,i){for(var a="",o,c,l,h=0,u=e.length;h<u;++h)l=void 0,o=e[h],c=o[0],c==="#"?l=this.renderSection(o,t,s,r,i):c==="^"?l=this.renderInverted(o,t,s,r,i):c===">"?l=this.renderPartial(o,t,s,i):c==="&"?l=this.unescapedValue(o,t):c==="name"?l=this.escapedValue(o,t,i):c==="text"&&(l=this.rawValue(o)),l!==void 0&&(a+=l);return a};N.prototype.renderSection=function(e,t,s,r,i){var a=this,o="",c=t.lookup(e[1]);function l(w){return a.render(w,t,s,i)}if(c){if(Se(c))for(var h=0,u=c.length;h<u;++h)o+=this.renderTokens(e[4],t.push(c[h]),s,r,i);else if(typeof c=="object"||typeof c=="string"||typeof c=="number")o+=this.renderTokens(e[4],t.push(c),s,r,i);else if(Sn(c)){if(typeof r!="string")throw new Error("Cannot use higher-order sections without the original template");c=c.call(t.view,r.slice(e[3],e[5]),l),c!=null&&(o+=c)}else o+=this.renderTokens(e[4],t,s,r,i);return o}};N.prototype.renderInverted=function(e,t,s,r,i){var a=t.lookup(e[1]);if(!a||Se(a)&&a.length===0)return this.renderTokens(e[4],t,s,r,i)};N.prototype.indentPartial=function(e,t,s){for(var r=t.replace(/[^ \t]/g,""),i=e.split(`
`),a=0;a<i.length;a++)i[a].length&&(a>0||!s)&&(i[a]=r+i[a]);return i.join(`
`)};N.prototype.renderPartial=function(e,t,s,r){if(s){var i=this.getConfigTags(r),a=Sn(s)?s(e[1]):s[e[1]];if(a!=null){var o=e[6],c=e[5],l=e[4],h=a;c==0&&l&&(h=this.indentPartial(a,l,o));var u=this.parse(h,i);return this.renderTokens(u,t,s,h,r)}}};N.prototype.unescapedValue=function(e,t){var s=t.lookup(e[1]);if(s!=null)return s};N.prototype.escapedValue=function(e,t,s){var r=this.getConfigEscape(s)||B.escape,i=t.lookup(e[1]);if(i!=null)return typeof i=="number"&&r===B.escape?String(i):r(i)};N.prototype.rawValue=function(e){return e[1]};N.prototype.getConfigTags=function(e){return Se(e)?e:e&&typeof e=="object"?e.tags:void 0};N.prototype.getConfigEscape=function(e){if(e&&typeof e=="object"&&!Se(e))return e.escape};var B={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(n){Le.templateCache=n},get templateCache(){return Le.templateCache}},Le=new N;B.clearCache=function(){return Le.clearCache()};B.parse=function(e,t){return Le.parse(e,t)};B.render=function(e,t,s,r){if(typeof e!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+Dr(e)+'" was given as the first argument for mustache#render(template, view, partials)');return Le.render(e,t,s,r)};B.escape=Gr;B.Scanner=Ue;B.Context=be;B.Writer=N;class Fs{constructor(e,t){this.template=e,this.state=t,this.ast=B.parse(e)}getValue(){return this.value===void 0&&(this.value=B.render(this.template,this.state)),this.value}onChange(e){const t=[];for(const s of this.getUsedVariables().values())t.push(this.state.onVariableChange(s).subscribe(()=>{const r=B.render(this.template,this.state);r!==this.value&&(this.value=r,e(this.value))}));return{unsubscribe:()=>{for(const s of t)s.unsubscribe()}}}isPureString(){return this.ast.length===0||this.ast.length===1&&this.ast[0][0]==="text"}getUsedVariables(){const e=new Set;return this.recursiveGetUsedVariables(this.ast,e),e}recursiveGetUsedVariables(e,t){for(const s of e){const r=s[0],i=s[1],a=s[4];["name","&","#","^"].includes(r)&&t.add(i),a!==void 0&&typeof a!="string"&&this.recursiveGetUsedVariables(a,t)}}}async function ni(){var n;const e=await Ms();for(const t of e){const s=(n=t.properties)!==null&&n!==void 0?n:[];for(const r of s){if(r.type==="int"||r.type==="bool"||r.type==="object"||typeof r.value!="string")continue;const i=new Fs(r.value,WA.state);if(i.isPureString())continue;const a=i.getValue();await Jn(t.name,r.name,a),i.onChange(async o=>{await Jn(t.name,r.name,o)})}}}async function si(){var n;const e=await De();for(const[t,s]of e.entries())if(s.type!=="objectgroup"){const r=(n=s.properties)!==null&&n!==void 0?n:[];for(const i of r){if(i.type==="int"||i.type==="bool"||i.type==="object"||typeof i.value!="string")continue;const a=new Fs(i.value,WA.state);if(a.isPureString())continue;const o=a.getValue();Xn(t,i.name,o),a.onChange(c=>{Xn(t,i.name,c)})}}}async function Jn(n,e,t){console.log(n),(await WA.room.area.get(n)).setProperty(e,t)}function Xn(n,e,t){WA.room.setProperty(n,e,t),e==="visible"&&(t?WA.room.showLayer(n):WA.room.hideLayer(n))}const ri="https://admin.workadventu.re/html";let sn,An=0,Rn=0;function Gn(n){if(WA.state[n.name]){let e=n.properties.mustGetString("openLayer");for(const t of e.split(`
`))WA.room.showLayer(t);e=n.properties.mustGetString("closeLayer");for(const t of e.split(`
`))WA.room.hideLayer(t)}else{let e=n.properties.mustGetString("openLayer");for(const t of e.split(`
`))WA.room.hideLayer(t);e=n.properties.mustGetString("closeLayer");for(const t of e.split(`
`))WA.room.showLayer(t)}}function ii(n){const e=n.properties.getString("openSound"),t=n.properties.getNumber("soundRadius");let s=1;if(t){const r=Is(n.properties.mustGetString("openLayer").split(`
`));if(r>t)return;s=1-r/t}e&&WA.sound.loadSound(e).play({volume:s})}function ai(n){const e=n.properties.getString("closeSound"),t=n.properties.getNumber("soundRadius");let s=1;if(t){const r=Is(n.properties.mustGetString("closeLayer").split(`
`));if(r>t)return;s=1-r/t}e&&WA.sound.loadSound(e).play({volume:s})}function Ws(n){return n.map(e=>sn.get(e)).filter(e=>(e==null?void 0:e.type)==="tilelayer")}function Is(n){const e=Ws(n),t=ks(e),s=((t.right-t.left)/2+t.left)*32,r=((t.bottom-t.top)/2+t.top)*32;return Math.sqrt(Math.pow(An-s,2)+Math.pow(Rn-r,2))}function oi(n){WA.state.onVariableChange(n.name).subscribe(()=>{WA.state[n.name]?ii(n):ai(n),Gn(n)}),Gn(n)}function zn(n,e,t,s){const r=n.name;let i,a,o=!1;const c=t.getString("tag");let l=!0;c&&!WA.player.tags.includes(c)&&(l=!1);const h=!!c;function u(){var m;i&&i.remove(),i=WA.ui.displayActionMessage({message:(m=t.getString("closeTriggerMessage"))!==null&&m!==void 0?m:"Press SPACE to close the door",callback:()=>{WA.state[e.name]=!1,w()}})}function w(){var m;i&&i.remove(),i=WA.ui.displayActionMessage({message:(m=t.getString("openTriggerMessage"))!==null&&m!==void 0?m:"Press SPACE to open the door",callback:()=>{WA.state[e.name]=!0,u()}})}function b(){let m;if(n.type==="tilelayer")m=ks(Ws(e.properties.mustGetString("closeLayer").split(`
`)));else{if(n.x===void 0||n.y===void 0||n.width===void 0||n.height===void 0)throw new Error(`Doorstep zone "${n.name}" is missing x, y, width or height`);m={top:n.y,left:n.x,right:n.x+n.width,bottom:n.y+n.height}}a=WA.room.website.create({name:"doorKeypad"+r,url:s+"/keypad.html#"+encodeURIComponent(r),position:{x:m.right*32,y:m.top*32,width:32*3,height:32*4},allowApi:!0})}function d(){a&&(WA.room.website.delete(a.name),a=void 0)}function p(){if(o=!0,t.getBoolean("autoOpen")&&l){WA.state[e.name]=!0;return}if(!WA.state[e.name]&&(h&&!l||!h)&&(t.getString("code")||t.getString("codeVariable"))){b();return}l&&(WA.state[e.name]?u():w())}function y(){o=!1,t.getBoolean("autoClose")&&(WA.state[e.name]=!1),i&&i.remove(),d()}n.type==="tilelayer"?(WA.room.onEnterLayer(r).subscribe(p),WA.room.onLeaveLayer(r).subscribe(y)):(WA.room.area.onEnter(r).subscribe(p),WA.room.area.onLeave(r).subscribe(y)),WA.state.onVariableChange(e.name).subscribe(()=>{o&&(!t.getBoolean("autoClose")&&WA.state[e.name]===!0&&u(),a&&WA.state[e.name]===!0&&d(),!t.getBoolean("autoOpen")&&WA.state[e.name]===!1&&w())})}function ci(n){const e=n.properties.mustGetString("bellSound"),t=n.properties.getNumber("soundRadius");let s=1;if(t){const r=Math.sqrt(Math.pow(n.x-An,2)+Math.pow(n.y-Rn,2));if(r>t)return;s=1-r/t}WA.sound.loadSound(e).play({volume:s})}function li(n){WA.state[n.name]===void 0&&(WA.state[n.name]=0),WA.state.onVariableChange(n.name).subscribe(()=>{WA.state[n.name]&&ci(n)})}function Kn(n,e,t){let s;const r=e.getString("bellPopup");if(t.type==="tilelayer"){const i=t.name;WA.room.onEnterLayer(i).subscribe(()=>{var a;r?s=WA.ui.openPopup(r,"",[{label:(a=e.getString("bellButtonText"))!==null&&a!==void 0?a:"Ring",callback:()=>{WA.state[n]=WA.state[n]+1}}]):WA.state[n]=WA.state[n]+1}),WA.room.onLeaveLayer(i).subscribe(()=>{s&&(s.close(),s=void 0)})}else{const i=t.name;WA.room.area.onEnter(i).subscribe(()=>{var a;r?s=WA.ui.openPopup(r,"",[{label:(a=e.getString("bellButtonText"))!==null&&a!==void 0?a:"Ring",callback:()=>{WA.state[n]=WA.state[n]+1}}]):WA.state[n]=WA.state[n]+1}),WA.room.area.onLeave(i).subscribe(()=>{s&&(s.close(),s=void 0)})}}async function ui(n){n=n??ri;const e=await Lr();sn=await De();for(const t of e.values())t.properties.get("door")&&oi(t),t.properties.get("bell")&&li(t);for(const t of sn.values()){const s=new we(t.properties),r=s.getString("doorVariable");if(r&&t.type==="tilelayer"){const a=e.get(r);if(a===void 0)throw new Error('Cannot find variable "'+r+'" referred in the "doorVariable" property of layer "'+t.name+'"');zn(t,a,s,n)}const i=s.getString("bellVariable");i&&t.type==="tilelayer"&&Kn(i,s,t)}for(const t of await Ms()){const s=new we(t.properties),r=s.getString("doorVariable");if(r){const a=e.get(r);if(a===void 0)throw new Error('Cannot find variable "'+r+'" referred in the "doorVariable" property of object "'+t.name+'"');zn(t,a,s,n)}const i=s.getString("bellVariable");i&&Kn(i,s,t)}WA.player.onPlayerMove(t=>{An=t.x,Rn=t.y})}function fi(n,e){const t=n.getString("bindVariable");if(t){const s=n.get("enterValue"),r=n.get("leaveValue"),i=n.getString("triggerMessage"),a=n.getString("tag");hi(t,e,s,r,i,a)}}function hi(n,e,t,s,r,i){i&&!WA.player.tags.includes(i)||(t!==void 0&&WA.room.onEnterLayer(e).subscribe(()=>{r||(WA.state[n]=t)}),s!==void 0&&WA.room.onLeaveLayer(e).subscribe(()=>{WA.state[n]=s}))}async function di(){const n=await De();for(const e of n.values()){const t=new we(e.properties);fi(t,e.name)}}let Qn;async function pi(n){const e=await WA.room.getTiledMap();n=n??Ts,Qn=await De();const t=e.layers.find(s=>s.name==="configuration");if(t){const r=new we(t.properties).getString("tag");(!r||WA.player.tags.includes(r))&&WA.ui.registerMenuCommand("Configure the room",()=>{WA.nav.openCoWebSite(n+"/configuration.html",!0)});for(const i of Qn.values()){const a=new we(i.properties),o=a.getString("openConfig");o&&i.type==="tilelayer"&&mi(o.split(","),i.name,a)}}}function mi(n,e,t){let s;const r=t.getString("openConfigAdminTag");let i=!0;r&&!WA.player.tags.includes(r)&&(i=!1);function a(){var c;s&&s.remove(),s=WA.ui.displayActionMessage({message:(c=t.getString("openConfigTriggerMessage"))!==null&&c!==void 0?c:"Press SPACE or touch here to configure",callback:()=>qn(n)})}function o(){WA.nav.closeCoWebSite()}WA.room.onEnterLayer(e).subscribe(()=>{const c=t.getString("openConfigTrigger");i&&(c&&c==="onaction"?a():qn(n))}),WA.room.onLeaveLayer(e).subscribe(()=>{s&&s.remove(),o()})}function gi(){return WA.onInit().then(()=>{ui().catch(n=>console.error(n)),di().catch(n=>console.error(n)),pi().catch(n=>console.error(n)),si().catch(n=>console.error(n)),ni().catch(n=>console.error(n))}).catch(n=>console.error(n))}const fe="4.32.1";let Yn=!1,We,Ls,$s,rn,Ns,Bs,js,Ds,Us;function yi(n,e={auto:!1}){if(Yn)throw new Error(`you must \`import 'openai/shims/${n.kind}'\` before importing anything else from openai`);if(We)throw new Error(`can't \`import 'openai/shims/${n.kind}'\` after \`import 'openai/shims/${We}'\``);Yn=e.auto,We=n.kind,Ls=n.fetch,n.Request,n.Response,n.Headers,$s=n.FormData,n.Blob,rn=n.File,Ns=n.ReadableStream,Bs=n.getMultipartRequestOptions,js=n.getDefaultAgent,Ds=n.fileFromPath,Us=n.isFsReadStream}class wi{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}function bi({manuallyImported:n}={}){const e=n?"You may need to use polyfills":"Add one of these imports before your first `import … from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let t,s,r,i;try{t=fetch,s=Request,r=Response,i=Headers}catch(a){throw new Error(`this environment is missing the following Web Fetch API type: ${a.message}. ${e}`)}return{kind:"web",fetch:t,Request:s,Response:r,Headers:i,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(a,o)=>({...o,body:new wi(a)}),getDefaultAgent:a=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:a=>!1}}We||yi(bi(),{auto:!0});class R extends Error{}class I extends R{constructor(e,t,s,r){super(`${I.makeMessage(e,t,s)}`),this.status=e,this.headers=r;const i=t;this.error=i,this.code=i==null?void 0:i.code,this.param=i==null?void 0:i.param,this.type=i==null?void 0:i.type}static makeMessage(e,t,s){const r=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):s;return e&&r?`${e} ${r}`:e?`${e} status code (no body)`:r||"(no status code or body)"}static generate(e,t,s,r){if(!e)return new $t({cause:on(t)});const i=t==null?void 0:t.error;return e===400?new qs(e,i,s,r):e===401?new Hs(e,i,s,r):e===403?new Vs(e,i,s,r):e===404?new Js(e,i,s,r):e===409?new Xs(e,i,s,r):e===422?new Gs(e,i,s,r):e===429?new zs(e,i,s,r):e>=500?new Ks(e,i,s,r):new I(e,i,s,r)}}class q extends I{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0),this.status=void 0}}class $t extends I{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),this.status=void 0,t&&(this.cause=t)}}class Cn extends $t{constructor({message:e}={}){super({message:e??"Request timed out."})}}class qs extends I{constructor(){super(...arguments),this.status=400}}class Hs extends I{constructor(){super(...arguments),this.status=401}}class Vs extends I{constructor(){super(...arguments),this.status=403}}class Js extends I{constructor(){super(...arguments),this.status=404}}class Xs extends I{constructor(){super(...arguments),this.status=409}}class Gs extends I{constructor(){super(...arguments),this.status=422}}class zs extends I{constructor(){super(...arguments),this.status=429}}class Ks extends I{}class Y{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let s=!1;const r=new _i;async function*i(){if(!e.body)throw t.abort(),new R("Attempted to iterate over a response with no body");const o=new ue,c=Zn(e.body);for await(const l of c)for(const h of o.decode(l)){const u=r.decode(h);u&&(yield u)}for(const l of o.flush()){const h=r.decode(l);h&&(yield h)}}async function*a(){if(s)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let o=!1;try{for await(const c of i())if(!o){if(c.data.startsWith("[DONE]")){o=!0;continue}if(c.event===null){let l;try{l=JSON.parse(c.data)}catch(h){throw console.error("Could not parse message into JSON:",c.data),console.error("From chunk:",c.raw),h}if(l&&l.error)throw new I(void 0,l.error,void 0,void 0);yield l}else{let l;try{l=JSON.parse(c.data)}catch(h){throw console.error("Could not parse message into JSON:",c.data),console.error("From chunk:",c.raw),h}if(c.event=="error")throw new I(void 0,l.error,l.message,void 0);yield{event:c.event,data:l}}}o=!0}catch(c){if(c instanceof Error&&c.name==="AbortError")return;throw c}finally{o||t.abort()}}return new Y(a,t)}static fromReadableStream(e,t){let s=!1;async function*r(){const a=new ue,o=Zn(e);for await(const c of o)for(const l of a.decode(c))yield l;for(const c of a.flush())yield c}async function*i(){if(s)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let a=!1;try{for await(const o of r())a||o&&(yield JSON.parse(o));a=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{a||t.abort()}}return new Y(i,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],s=this.iterator(),r=i=>({next:()=>{if(i.length===0){const a=s.next();e.push(a),t.push(a)}return i.shift()}});return[new Y(()=>r(e),this.controller),new Y(()=>r(t),this.controller)]}toReadableStream(){const e=this;let t;const s=new TextEncoder;return new Ns({async start(){t=e[Symbol.asyncIterator]()},async pull(r){try{const{value:i,done:a}=await t.next();if(a)return r.close();const o=s.encode(JSON.stringify(i)+`
`);r.enqueue(o)}catch(i){r.error(i)}},async cancel(){var r;await((r=t.return)==null?void 0:r.call(t))}})}}class _i{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,s,r]=Si(e,":");return r.startsWith(" ")&&(r=r.substring(1)),t==="event"?this.event=r:t==="data"&&this.data.push(r),null}}class ue{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];const s=ue.NEWLINE_CHARS.has(t[t.length-1]||"");let r=t.split(ue.NEWLINE_REGEXP);return s&&r.pop(),r.length===1&&!s?(this.buffer.push(r[0]),[]):(this.buffer.length>0&&(r=[this.buffer.join("")+r[0],...r.slice(1)],this.buffer=[]),s||(this.buffer=[r.pop()||""]),r)}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new R(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new R(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new R("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}}ue.NEWLINE_CHARS=new Set([`
`,"\r","\v","\f","","","","","\u2028","\u2029"]);ue.NEWLINE_REGEXP=/\r\n|[\n\r\x0b\x0c\x1c\x1d\x1e\x85\u2028\u2029]/g;function Si(n,e){const t=n.indexOf(e);return t!==-1?[n.substring(0,t),e,n.substring(t+e.length)]:[n,"",""]}function Zn(n){if(n[Symbol.asyncIterator])return n;const e=n.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}const Qs=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function",Ys=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&Zs(n),Zs=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function",Ai=n=>Ys(n)||Qs(n)||Us(n);async function er(n,e,t){var r;if(n=await n,t??(t=Ys(n)?{lastModified:n.lastModified,type:n.type}:{}),Qs(n)){const i=await n.blob();return e||(e=new URL(n.url).pathname.split(/[\\/]/).pop()??"unknown_file"),new rn([i],e,t)}const s=await Ri(n);if(e||(e=Ei(n)??"unknown_file"),!t.type){const i=(r=s[0])==null?void 0:r.type;typeof i=="string"&&(t={...t,type:i})}return new rn(s,e,t)}async function Ri(n){var t;let e=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)e.push(n);else if(Zs(n))e.push(await n.arrayBuffer());else if(Pi(n))for await(const s of n)e.push(s);else throw new Error(`Unexpected data type: ${typeof n}; constructor: ${(t=n==null?void 0:n.constructor)==null?void 0:t.name}; props: ${Ci(n)}`);return e}function Ci(n){return`[${Object.getOwnPropertyNames(n).map(t=>`"${t}"`).join(", ")}]`}function Ei(n){var e;return Xt(n.name)||Xt(n.filename)||((e=Xt(n.path))==null?void 0:e.split(/[\\/]/).pop())}const Xt=n=>{if(typeof n=="string")return n;if(typeof Buffer<"u"&&n instanceof Buffer)return String(n)},Pi=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function",es=n=>n&&typeof n=="object"&&n.body&&n[Symbol.toStringTag]==="MultipartBody",$e=async n=>{const e=await xi(n.body);return Bs(e,n)},xi=async n=>{const e=new $s;return await Promise.all(Object.entries(n||{}).map(([t,s])=>an(e,t,s))),e},an=async(n,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")n.append(e,String(t));else if(Ai(t)){const s=await er(t);n.append(e,s)}else if(Array.isArray(t))await Promise.all(t.map(s=>an(n,e+"[]",s)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([s,r])=>an(n,`${e}[${s}]`,r)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var Ti=globalThis&&globalThis.__classPrivateFieldSet||function(n,e,t,s,r){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?r.call(n,t):r?r.value=t:e.set(n,t),t},vi=globalThis&&globalThis.__classPrivateFieldGet||function(n,e,t,s){if(t==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?s:t==="a"?s.call(n):s?s.value:e.get(n)},Ve;async function tr(n){const{response:e}=n;if(n.options.stream)return me("response",e.status,e.url,e.headers,e.body),n.options.__streamClass?n.options.__streamClass.fromSSEResponse(e,n.controller):Y.fromSSEResponse(e,n.controller);if(e.status===204)return null;if(n.options.__binaryResponse)return e;const t=e.headers.get("content-type");if((t==null?void 0:t.includes("application/json"))||(t==null?void 0:t.includes("application/vnd.api+json"))){const i=await e.json();return me("response",e.status,e.url,e.headers,i),i}const r=await e.text();return me("response",e.status,e.url,e.headers,r),r}class Nt extends Promise{constructor(e,t=tr){super(s=>{s(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new Nt(this.responsePromise,async t=>e(await this.parseResponse(t)))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class Oi{constructor({baseURL:e,maxRetries:t=2,timeout:s=6e5,httpAgent:r,fetch:i}){this.baseURL=e,this.maxRetries=Gt("maxRetries",t),this.timeout=Gt("timeout",s),this.httpAgent=r,this.fetch=i??Ls}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...Li(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${ji()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,s){return this.request(Promise.resolve(s).then(r=>({method:e,path:t,...r})))}getAPIList(e,t,s){return this.requestAPIList(t,{method:"get",path:e,...s})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}return null}buildRequest(e){var d;const{method:t,path:s,query:r,headers:i={}}=e,a=es(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,o=this.calculateContentLength(a),c=this.buildURL(s,r);"timeout"in e&&Gt("timeout",e.timeout);const l=e.timeout??this.timeout,h=e.httpAgent??this.httpAgent??js(c),u=l+1e3;typeof((d=h==null?void 0:h.options)==null?void 0:d.timeout)=="number"&&u>(h.options.timeout??0)&&(h.options.timeout=u),this.idempotencyHeader&&t!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),i[this.idempotencyHeader]=e.idempotencyKey);const w=this.buildHeaders({options:e,headers:i,contentLength:o});return{req:{method:t,...a&&{body:a},headers:w,...h&&{agent:h},signal:e.signal??null},url:c,timeout:l}}buildHeaders({options:e,headers:t,contentLength:s}){const r={};s&&(r["content-length"]=s);const i=this.defaultHeaders(e);return rs(r,i),rs(r,t),es(e.body)&&We!=="node"&&delete r["content-type"],this.validateHeaders(r,t),r}async prepareOptions(e){}async prepareRequest(e,{url:t,options:s}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,s,r){return I.generate(e,t,s,r)}request(e,t=null){return new Nt(this.makeRequest(e,t))}async makeRequest(e,t){var h,u;const s=await e;t==null&&(t=s.maxRetries??this.maxRetries),await this.prepareOptions(s);const{req:r,url:i,timeout:a}=this.buildRequest(s);if(await this.prepareRequest(r,{url:i,options:s}),me("request",i,s,r.headers),(h=s.signal)!=null&&h.aborted)throw new q;const o=new AbortController,c=await this.fetchWithTimeout(i,r,a,o).catch(on);if(c instanceof Error){if((u=s.signal)!=null&&u.aborted)throw new q;if(t)return this.retryRequest(s,t);throw c.name==="AbortError"?new Cn:new $t({cause:c})}const l=ki(c.headers);if(!c.ok){if(t&&this.shouldRetry(c)){const m=`retrying, ${t} attempts remaining`;return me(`response (error; ${m})`,c.status,i,l),this.retryRequest(s,t,l)}const w=await c.text().catch(m=>on(m).message),b=$i(w),d=b?void 0:w;throw me(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,c.status,i,l,d),this.makeStatusError(c.status,b,d,l)}return{response:c,options:s,controller:o}}requestAPIList(e,t){const s=this.makeRequest(t,null);return new Mi(this,s,e)}buildURL(e,t){const s=Bi(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),r=this.defaultQuery();return sr(r)||(t={...r,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(s.search=this.stringifyQuery(t)),s.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,s])=>typeof s<"u").map(([t,s])=>{if(typeof s=="string"||typeof s=="number"||typeof s=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(s)}`;if(s===null)return`${encodeURIComponent(t)}=`;throw new R(`Cannot stringify type ${typeof s}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,s,r){const{signal:i,...a}=t||{};i&&i.addEventListener("abort",()=>r.abort());const o=setTimeout(()=>r.abort(),s);return this.getRequestClient().fetch.call(void 0,e,{signal:r.signal,...a}).finally(()=>{clearTimeout(o)})}getRequestClient(){return{fetch:this.fetch}}shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,s){let r;const i=s==null?void 0:s["retry-after-ms"];if(i){const o=parseFloat(i);Number.isNaN(o)||(r=o)}const a=s==null?void 0:s["retry-after"];if(a&&!r){const o=parseFloat(a);Number.isNaN(o)?r=Date.parse(a)-Date.now():r=o*1e3}if(!(r&&0<=r&&r<60*1e3)){const o=e.maxRetries??this.maxRetries;r=this.calculateDefaultRetryTimeoutMillis(t,o)}return await En(r),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const i=t-e,a=Math.min(.5*Math.pow(2,i),8),o=1-Math.random()*.25;return a*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${fe}`}}class nr{constructor(e,t,s,r){Ve.set(this,void 0),Ti(this,Ve,e,"f"),this.options=r,this.response=t,this.body=s}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new R("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){const s=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[r,i]of s)e.url.searchParams.set(r,i);t.query=void 0,t.path=e.url.toString()}return await vi(this,Ve,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(Ve=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class Mi extends Nt{constructor(e,t,s){super(t,async r=>new s(e,r.response,await tr(r),r.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}}const ki=n=>new Proxy(Object.fromEntries(n.entries()),{get(e,t){const s=t.toString();return e[s.toLowerCase()]||e[s]}}),Fi={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryResponse:!0,__streamClass:!0},ee=n=>typeof n=="object"&&n!==null&&!sr(n)&&Object.keys(n).every(e=>rr(Fi,e)),Wi=()=>{var e;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":fe,"X-Stainless-OS":ns(Deno.build.os),"X-Stainless-Arch":ts(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((e=Deno.version)==null?void 0:e.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":fe,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":fe,"X-Stainless-OS":ns(process.platform),"X-Stainless-Arch":ts(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const n=Ii();return n?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":fe,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${n.browser}`,"X-Stainless-Runtime-Version":n.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":fe,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function Ii(){if(typeof navigator>"u"||!navigator)return null;const n=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of n){const s=t.exec(navigator.userAgent);if(s){const r=s[1]||0,i=s[2]||0,a=s[3]||0;return{browser:e,version:`${r}.${i}.${a}`}}}return null}const ts=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?`other:${n}`:"unknown",ns=n=>(n=n.toLowerCase(),n.includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?`Other:${n}`:"Unknown");let ss;const Li=()=>ss??(ss=Wi()),$i=n=>{try{return JSON.parse(n)}catch{return}},Ni=new RegExp("^(?:[a-z]+:)?//","i"),Bi=n=>Ni.test(n),En=n=>new Promise(e=>setTimeout(e,n)),Gt=(n,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new R(`${n} must be an integer`);if(e<0)throw new R(`${n} must be a positive integer`);return e},on=n=>n instanceof Error?n:new Error(n),zt=n=>{var e,t,s,r,i;if(typeof process<"u")return((t=(e=process.env)==null?void 0:e[n])==null?void 0:t.trim())??void 0;if(typeof Deno<"u")return(i=(r=(s=Deno.env)==null?void 0:s.get)==null?void 0:r.call(s,n))==null?void 0:i.trim()};function sr(n){if(!n)return!0;for(const e in n)return!1;return!0}function rr(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function rs(n,e){for(const t in e){if(!rr(e,t))continue;const s=t.toLowerCase();if(!s)continue;const r=e[t];r===null?delete n[s]:r!==void 0&&(n[s]=r)}}function me(n,...e){var t;typeof process<"u"&&((t=process==null?void 0:process.env)==null?void 0:t.DEBUG)==="true"&&console.log(`OpenAI:DEBUG:${n}`,...e)}const ji=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const e=Math.random()*16|0;return(n==="x"?e:e&3|8).toString(16)}),Di=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";function is(n){return n!=null&&typeof n=="object"&&!Array.isArray(n)}class Pn extends nr{constructor(e,t,s,r){super(e,t,s,r),this.data=s.data||[],this.object=s.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class ie extends nr{constructor(e,t,s,r){super(e,t,s,r),this.data=s.data||[]}getPaginatedItems(){return this.data??[]}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){var s;const e=this.getPaginatedItems();if(!e.length)return null;const t=(s=e[e.length-1])==null?void 0:s.id;return t?{params:{after:t}}:null}}class E{constructor(e){this._client=e}}let ft=class extends E{create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}};ft||(ft={});let ht=class extends E{constructor(){super(...arguments),this.completions=new ft(this._client)}};(function(n){n.Completions=ft})(ht||(ht={}));class dt extends E{create(e,t){return this._client.post("/audio/speech",{body:e,...t,__binaryResponse:!0})}}dt||(dt={});class pt extends E{create(e,t){return this._client.post("/audio/transcriptions",$e({body:e,...t}))}}pt||(pt={});class mt extends E{create(e,t){return this._client.post("/audio/translations",$e({body:e,...t}))}}mt||(mt={});class gt extends E{constructor(){super(...arguments),this.transcriptions=new pt(this._client),this.translations=new mt(this._client),this.speech=new dt(this._client)}}(function(n){n.Transcriptions=pt,n.Translations=mt,n.Speech=dt})(gt||(gt={}));let yt=class extends E{create(e,t,s){return this._client.post(`/assistants/${e}/files`,{body:t,...s,headers:{"OpenAI-Beta":"assistants=v1",...s==null?void 0:s.headers}})}retrieve(e,t,s){return this._client.get(`/assistants/${e}/files/${t}`,{...s,headers:{"OpenAI-Beta":"assistants=v1",...s==null?void 0:s.headers}})}list(e,t={},s){return ee(t)?this.list(e,{},t):this._client.getAPIList(`/assistants/${e}/files`,xn,{query:t,...s,headers:{"OpenAI-Beta":"assistants=v1",...s==null?void 0:s.headers}})}del(e,t,s){return this._client.delete(`/assistants/${e}/files/${t}`,{...s,headers:{"OpenAI-Beta":"assistants=v1",...s==null?void 0:s.headers}})}};class xn extends ie{}(function(n){n.AssistantFilesPage=xn})(yt||(yt={}));class wt extends E{constructor(){super(...arguments),this.files=new yt(this._client)}create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v1",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v1",...t==null?void 0:t.headers}})}update(e,t,s){return this._client.post(`/assistants/${e}`,{body:t,...s,headers:{"OpenAI-Beta":"assistants=v1",...s==null?void 0:s.headers}})}list(e={},t){return ee(e)?this.list({},e):this._client.getAPIList("/assistants",Tn,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v1",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v1",...t==null?void 0:t.headers}})}}class Tn extends ie{}(function(n){n.AssistantsPage=Tn,n.Files=yt,n.AssistantFilesPage=xn})(wt||(wt={}));function as(n){return typeof n.parse=="function"}const ge=n=>(n==null?void 0:n.role)==="assistant",ir=n=>(n==null?void 0:n.role)==="function",ar=n=>(n==null?void 0:n.role)==="tool";var V=globalThis&&globalThis.__classPrivateFieldSet||function(n,e,t,s,r){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?r.call(n,t):r?r.value=t:e.set(n,t),t},S=globalThis&&globalThis.__classPrivateFieldGet||function(n,e,t,s){if(t==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?s:t==="a"?s.call(n):s?s.value:e.get(n)},$,Ge,ze,Ce,Ee,Ke,Pe,ne,xe,Qe,Ye,he,cn,bt,ln,un,fn,hn,or,dn;const os=10;class cr{constructor(){$.add(this),this.controller=new AbortController,Ge.set(this,void 0),ze.set(this,()=>{}),Ce.set(this,()=>{}),Ee.set(this,void 0),Ke.set(this,()=>{}),Pe.set(this,()=>{}),ne.set(this,{}),this._chatCompletions=[],this.messages=[],xe.set(this,!1),Qe.set(this,!1),Ye.set(this,!1),he.set(this,!1),hn.set(this,e=>{if(V(this,Qe,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new q),e instanceof q)return V(this,Ye,!0,"f"),this._emit("abort",e);if(e instanceof R)return this._emit("error",e);if(e instanceof Error){const t=new R(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new R(String(e)))}),V(this,Ge,new Promise((e,t)=>{V(this,ze,e,"f"),V(this,Ce,t,"f")}),"f"),V(this,Ee,new Promise((e,t)=>{V(this,Ke,e,"f"),V(this,Pe,t,"f")}),"f"),S(this,Ge,"f").catch(()=>{}),S(this,Ee,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},S(this,hn,"f"))},0)}_addChatCompletion(e){var s;this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=(s=e.choices[0])==null?void 0:s.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),(ir(e)||ar(e))&&e.content)this._emit("functionCallResult",e.content);else if(ge(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(ge(e)&&e.tool_calls)for(const s of e.tool_calls)s.type==="function"&&this._emit("functionCall",s.function)}}_connected(){this.ended||(S(this,ze,"f").call(this),this._emit("connect"))}get ended(){return S(this,xe,"f")}get errored(){return S(this,Qe,"f")}get aborted(){return S(this,Ye,"f")}abort(){this.controller.abort()}on(e,t){return(S(this,ne,"f")[e]||(S(this,ne,"f")[e]=[])).push({listener:t}),this}off(e,t){const s=S(this,ne,"f")[e];if(!s)return this;const r=s.findIndex(i=>i.listener===t);return r>=0&&s.splice(r,1),this}once(e,t){return(S(this,ne,"f")[e]||(S(this,ne,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,s)=>{V(this,he,!0,"f"),e!=="error"&&this.once("error",s),this.once(e,t)})}async done(){V(this,he,!0,"f"),await S(this,Ee,"f")}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new R("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),S(this,$,"m",cn).call(this)}async finalMessage(){return await this.done(),S(this,$,"m",bt).call(this)}async finalFunctionCall(){return await this.done(),S(this,$,"m",ln).call(this)}async finalFunctionCallResult(){return await this.done(),S(this,$,"m",un).call(this)}async totalUsage(){return await this.done(),S(this,$,"m",fn).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emit(e,...t){if(S(this,xe,"f"))return;e==="end"&&(V(this,xe,!0,"f"),S(this,Ke,"f").call(this));const s=S(this,ne,"f")[e];if(s&&(S(this,ne,"f")[e]=s.filter(r=>!r.once),s.forEach(({listener:r})=>r(...t))),e==="abort"){const r=t[0];!S(this,he,"f")&&!(s!=null&&s.length)&&Promise.reject(r),S(this,Ce,"f").call(this,r),S(this,Pe,"f").call(this,r),this._emit("end");return}if(e==="error"){const r=t[0];!S(this,he,"f")&&!(s!=null&&s.length)&&Promise.reject(r),S(this,Ce,"f").call(this,r),S(this,Pe,"f").call(this,r),this._emit("end")}}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=S(this,$,"m",bt).call(this);t&&this._emit("finalMessage",t);const s=S(this,$,"m",cn).call(this);s&&this._emit("finalContent",s);const r=S(this,$,"m",ln).call(this);r&&this._emit("finalFunctionCall",r);const i=S(this,$,"m",un).call(this);i!=null&&this._emit("finalFunctionCallResult",i),this._chatCompletions.some(a=>a.usage)&&this._emit("totalUsage",S(this,$,"m",fn).call(this))}async _createChatCompletion(e,t,s){const r=s==null?void 0:s.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),S(this,$,"m",or).call(this,t);const i=await e.create({...t,stream:!1},{...s,signal:this.controller.signal});return this._connected(),this._addChatCompletion(i)}async _runChatCompletion(e,t,s){for(const r of t.messages)this._addMessage(r,!1);return await this._createChatCompletion(e,t,s)}async _runFunctions(e,t,s){var w;const r="function",{function_call:i="auto",stream:a,...o}=t,c=typeof i!="string"&&(i==null?void 0:i.name),{maxChatCompletions:l=os}=s||{},h={};for(const b of t.functions)h[b.name||b.function.name]=b;const u=t.functions.map(b=>({name:b.name||b.function.name,parameters:b.parameters,description:b.description}));for(const b of t.messages)this._addMessage(b,!1);for(let b=0;b<l;++b){const p=(w=(await this._createChatCompletion(e,{...o,function_call:i,functions:u,messages:[...this.messages]},s)).choices[0])==null?void 0:w.message;if(!p)throw new R("missing message in ChatCompletion response");if(!p.function_call)return;const{name:y,arguments:m}=p.function_call,_=h[y];if(_){if(c&&c!==y){const O=`Invalid function_call: ${JSON.stringify(y)}. ${JSON.stringify(c)} requested. Please try again`;this._addMessage({role:r,name:y,content:O});continue}}else{const O=`Invalid function_call: ${JSON.stringify(y)}. Available options are: ${u.map(M=>JSON.stringify(M.name)).join(", ")}. Please try again`;this._addMessage({role:r,name:y,content:O});continue}let C;try{C=as(_)?await _.parse(m):m}catch(O){this._addMessage({role:r,name:y,content:O instanceof Error?O.message:String(O)});continue}const T=await _.function(C,this),x=S(this,$,"m",dn).call(this,T);if(this._addMessage({role:r,name:y,content:x}),c)return}}async _runTools(e,t,s){var w,b;const r="tool",{tool_choice:i="auto",stream:a,...o}=t,c=typeof i!="string"&&((w=i==null?void 0:i.function)==null?void 0:w.name),{maxChatCompletions:l=os}=s||{},h={};for(const d of t.tools)d.type==="function"&&(h[d.function.name||d.function.function.name]=d.function);const u="tools"in t?t.tools.map(d=>d.type==="function"?{type:"function",function:{name:d.function.name||d.function.function.name,parameters:d.function.parameters,description:d.function.description}}:d):void 0;for(const d of t.messages)this._addMessage(d,!1);for(let d=0;d<l;++d){const y=(b=(await this._createChatCompletion(e,{...o,tool_choice:i,tools:u,messages:[...this.messages]},s)).choices[0])==null?void 0:b.message;if(!y)throw new R("missing message in ChatCompletion response");if(!y.tool_calls)return;for(const m of y.tool_calls){if(m.type!=="function")continue;const _=m.id,{name:C,arguments:T}=m.function,x=h[C];if(x){if(c&&c!==C){const F=`Invalid tool_call: ${JSON.stringify(C)}. ${JSON.stringify(c)} requested. Please try again`;this._addMessage({role:r,tool_call_id:_,content:F});continue}}else{const F=`Invalid tool_call: ${JSON.stringify(C)}. Available options are: ${u.map(Ht=>JSON.stringify(Ht.function.name)).join(", ")}. Please try again`;this._addMessage({role:r,tool_call_id:_,content:F});continue}let O;try{O=as(x)?await x.parse(T):T}catch(F){const Ht=F instanceof Error?F.message:String(F);this._addMessage({role:r,tool_call_id:_,content:Ht});continue}const M=await x.function(O,this),L=S(this,$,"m",dn).call(this,M);if(this._addMessage({role:r,tool_call_id:_,content:L}),c)return}}}}Ge=new WeakMap,ze=new WeakMap,Ce=new WeakMap,Ee=new WeakMap,Ke=new WeakMap,Pe=new WeakMap,ne=new WeakMap,xe=new WeakMap,Qe=new WeakMap,Ye=new WeakMap,he=new WeakMap,hn=new WeakMap,$=new WeakSet,cn=function(){return S(this,$,"m",bt).call(this).content??null},bt=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(ge(t))return{...t,content:t.content??null}}throw new R("stream ended without producing a ChatCompletionMessage with role=assistant")},ln=function(){var e,t;for(let s=this.messages.length-1;s>=0;s--){const r=this.messages[s];if(ge(r)&&(r!=null&&r.function_call))return r.function_call;if(ge(r)&&((e=r==null?void 0:r.tool_calls)!=null&&e.length))return(t=r.tool_calls.at(-1))==null?void 0:t.function}},un=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(ir(t)&&t.content!=null||ar(t)&&t.content!=null&&this.messages.some(s=>{var r;return s.role==="assistant"&&((r=s.tool_calls)==null?void 0:r.some(i=>i.type==="function"&&i.id===t.tool_call_id))}))return t.content}},fn=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},or=function(e){if(e.n!=null&&e.n>1)throw new R("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},dn=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};class Ne extends cr{static runFunctions(e,t,s){const r=new Ne,i={...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"runFunctions"}};return r._run(()=>r._runFunctions(e,t,i)),r}static runTools(e,t,s){const r=new Ne,i={...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run(()=>r._runTools(e,t,i)),r}_addMessage(e){super._addMessage(e),ge(e)&&e.content&&this._emit("content",e.content)}}var J=globalThis&&globalThis.__classPrivateFieldGet||function(n,e,t,s){if(t==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?s:t==="a"?s.call(n):s?s.value:e.get(n)},Kt=globalThis&&globalThis.__classPrivateFieldSet||function(n,e,t,s,r){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?r.call(n,t):r?r.value=t:e.set(n,t),t},K,ae,Qt,Yt,Je,cs;class Be extends cr{constructor(){super(...arguments),K.add(this),ae.set(this,void 0)}get currentChatCompletionSnapshot(){return J(this,ae,"f")}static fromReadableStream(e){const t=new Be;return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,s){const r=new Be;return r._run(()=>r._runChatCompletion(e,{...t,stream:!0},{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createChatCompletion(e,t,s){var a;const r=s==null?void 0:s.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),J(this,K,"m",Qt).call(this);const i=await e.create({...t,stream:!0},{...s,signal:this.controller.signal});this._connected();for await(const o of i)J(this,K,"m",Yt).call(this,o);if((a=i.controller.signal)!=null&&a.aborted)throw new q;return this._addChatCompletion(J(this,K,"m",Je).call(this))}async _fromReadableStream(e,t){var a;const s=t==null?void 0:t.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),J(this,K,"m",Qt).call(this),this._connected();const r=Y.fromReadableStream(e,this.controller);let i;for await(const o of r)i&&i!==o.id&&this._addChatCompletion(J(this,K,"m",Je).call(this)),J(this,K,"m",Yt).call(this,o),i=o.id;if((a=r.controller.signal)!=null&&a.aborted)throw new q;return this._addChatCompletion(J(this,K,"m",Je).call(this))}[(ae=new WeakMap,K=new WeakSet,Qt=function(){this.ended||Kt(this,ae,void 0,"f")},Yt=function(t){var a,o,c;if(this.ended)return;const s=J(this,K,"m",cs).call(this,t);this._emit("chunk",t,s);const r=(o=(a=t.choices[0])==null?void 0:a.delta)==null?void 0:o.content,i=(c=s.choices[0])==null?void 0:c.message;r!=null&&(i==null?void 0:i.role)==="assistant"&&(i!=null&&i.content)&&this._emit("content",r,i.content)},Je=function(){if(this.ended)throw new R("stream has ended, this shouldn't happen");const t=J(this,ae,"f");if(!t)throw new R("request ended without sending any chunks");return Kt(this,ae,void 0,"f"),Ui(t)},cs=function(t){var s,r,i;let a=J(this,ae,"f");const{choices:o,...c}=t;a?Object.assign(a,c):a=Kt(this,ae,{...c,choices:[]},"f");for(const{delta:l,finish_reason:h,index:u,logprobs:w=null,...b}of t.choices){let d=a.choices[u];if(d||(d=a.choices[u]={finish_reason:h,index:u,message:{},logprobs:w,...b}),w)if(!d.logprobs)d.logprobs=Object.assign({},w);else{const{content:T,...x}=w;Object.assign(d.logprobs,x),T&&((s=d.logprobs).content??(s.content=[]),d.logprobs.content.push(...T))}if(h&&(d.finish_reason=h),Object.assign(d,b),!l)continue;const{content:p,function_call:y,role:m,tool_calls:_,...C}=l;if(Object.assign(d.message,C),p&&(d.message.content=(d.message.content||"")+p),m&&(d.message.role=m),y&&(d.message.function_call?(y.name&&(d.message.function_call.name=y.name),y.arguments&&((r=d.message.function_call).arguments??(r.arguments=""),d.message.function_call.arguments+=y.arguments)):d.message.function_call=y),_){d.message.tool_calls||(d.message.tool_calls=[]);for(const{index:T,id:x,type:O,function:M,...L}of _){const F=(i=d.message.tool_calls)[T]??(i[T]={});Object.assign(F,L),x&&(F.id=x),O&&(F.type=O),M&&(F.function??(F.function={arguments:""})),M!=null&&M.name&&(F.function.name=M.name),M!=null&&M.arguments&&(F.function.arguments+=M.arguments)}}}return a},Symbol.asyncIterator)](){const e=[],t=[];let s=!1;return this.on("chunk",r=>{const i=t.shift();i?i.resolve(r):e.push(r)}),this.on("end",()=>{s=!0;for(const r of t)r.resolve(void 0);t.length=0}),this.on("abort",r=>{s=!0;for(const i of t)i.reject(r);t.length=0}),this.on("error",r=>{s=!0;for(const i of t)i.reject(r);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Y(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function Ui(n){const{id:e,choices:t,created:s,model:r,system_fingerprint:i,...a}=n;return{...a,id:e,choices:t.map(({message:o,finish_reason:c,index:l,logprobs:h,...u})=>{if(!c)throw new R(`missing finish_reason for choice ${l}`);const{content:w=null,function_call:b,tool_calls:d,...p}=o,y=o.role;if(!y)throw new R(`missing role for choice ${l}`);if(b){const{arguments:m,name:_}=b;if(m==null)throw new R(`missing function_call.arguments for choice ${l}`);if(!_)throw new R(`missing function_call.name for choice ${l}`);return{...u,message:{content:w,function_call:{arguments:m,name:_},role:y},finish_reason:c,index:l,logprobs:h}}return d?{...u,index:l,finish_reason:c,logprobs:h,message:{...p,role:y,content:w,tool_calls:d.map((m,_)=>{const{function:C,type:T,id:x,...O}=m,{arguments:M,name:L,...F}=C||{};if(x==null)throw new R(`missing choices[${l}].tool_calls[${_}].id
${Xe(n)}`);if(T==null)throw new R(`missing choices[${l}].tool_calls[${_}].type
${Xe(n)}`);if(L==null)throw new R(`missing choices[${l}].tool_calls[${_}].function.name
${Xe(n)}`);if(M==null)throw new R(`missing choices[${l}].tool_calls[${_}].function.arguments
${Xe(n)}`);return{...O,id:x,type:T,function:{...F,name:L,arguments:M}}})}}:{...u,message:{...p,content:w,role:y},finish_reason:c,index:l,logprobs:h}}),created:s,model:r,object:"chat.completion",...i?{system_fingerprint:i}:{}}}function Xe(n){return JSON.stringify(n)}class ye extends Be{static fromReadableStream(e){const t=new ye;return t._run(()=>t._fromReadableStream(e)),t}static runFunctions(e,t,s){const r=new ye,i={...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"runFunctions"}};return r._run(()=>r._runFunctions(e,t,i)),r}static runTools(e,t,s){const r=new ye,i={...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run(()=>r._runTools(e,t,i)),r}}let lr=class extends E{runFunctions(e,t){return e.stream?ye.runFunctions(this._client.chat.completions,e,t):Ne.runFunctions(this._client.chat.completions,e,t)}runTools(e,t){return e.stream?ye.runTools(this._client.chat.completions,e,t):Ne.runTools(this._client.chat.completions,e,t)}stream(e,t){return Be.createChatCompletion(this._client.chat.completions,e,t)}};class _t extends E{constructor(){super(...arguments),this.completions=new lr(this._client)}}(function(n){n.Completions=lr})(_t||(_t={}));var X=globalThis&&globalThis.__classPrivateFieldSet||function(n,e,t,s,r){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?r.call(n,t):r?r.value=t:e.set(n,t),t},P=globalThis&&globalThis.__classPrivateFieldGet||function(n,e,t,s){if(t==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?s:t==="a"?s.call(n):s?s.value:e.get(n)},Ze,et,Te,ve,tt,Oe,se,Me,nt,st,de,pn;class qi{constructor(){this.controller=new AbortController,Ze.set(this,void 0),et.set(this,()=>{}),Te.set(this,()=>{}),ve.set(this,void 0),tt.set(this,()=>{}),Oe.set(this,()=>{}),se.set(this,{}),Me.set(this,!1),nt.set(this,!1),st.set(this,!1),de.set(this,!1),pn.set(this,e=>{if(X(this,nt,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new q),e instanceof q)return X(this,st,!0,"f"),this._emit("abort",e);if(e instanceof R)return this._emit("error",e);if(e instanceof Error){const t=new R(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new R(String(e)))}),X(this,Ze,new Promise((e,t)=>{X(this,et,e,"f"),X(this,Te,t,"f")}),"f"),X(this,ve,new Promise((e,t)=>{X(this,tt,e,"f"),X(this,Oe,t,"f")}),"f"),P(this,Ze,"f").catch(()=>{}),P(this,ve,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emit("end")},P(this,pn,"f"))},0)}_addRun(e){return e}_connected(){this.ended||(P(this,et,"f").call(this),this._emit("connect"))}get ended(){return P(this,Me,"f")}get errored(){return P(this,nt,"f")}get aborted(){return P(this,st,"f")}abort(){this.controller.abort()}on(e,t){return(P(this,se,"f")[e]||(P(this,se,"f")[e]=[])).push({listener:t}),this}off(e,t){const s=P(this,se,"f")[e];if(!s)return this;const r=s.findIndex(i=>i.listener===t);return r>=0&&s.splice(r,1),this}once(e,t){return(P(this,se,"f")[e]||(P(this,se,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,s)=>{X(this,de,!0,"f"),e!=="error"&&this.once("error",s),this.once(e,t)})}async done(){X(this,de,!0,"f"),await P(this,ve,"f")}_emit(e,...t){if(P(this,Me,"f"))return;e==="end"&&(X(this,Me,!0,"f"),P(this,tt,"f").call(this));const s=P(this,se,"f")[e];if(s&&(P(this,se,"f")[e]=s.filter(r=>!r.once),s.forEach(({listener:r})=>r(...t))),e==="abort"){const r=t[0];!P(this,de,"f")&&!(s!=null&&s.length)&&Promise.reject(r),P(this,Te,"f").call(this,r),P(this,Oe,"f").call(this,r),this._emit("end");return}if(e==="error"){const r=t[0];!P(this,de,"f")&&!(s!=null&&s.length)&&Promise.reject(r),P(this,Te,"f").call(this,r),P(this,Oe,"f").call(this,r),this._emit("end")}}async _threadAssistantStream(e,t,s){return await this._createThreadAssistantStream(t,e,s)}async _runAssistantStream(e,t,s,r){return await this._createAssistantStream(t,e,s,r)}async _runToolAssistantStream(e,t,s,r,i){return await this._createToolAssistantStream(s,e,t,r,i)}async _createThreadAssistantStream(e,t,s){const r=s==null?void 0:s.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));const i=await e.createAndRun({...t,stream:!1},{...s,signal:this.controller.signal});return this._connected(),this._addRun(i)}async _createToolAssistantStream(e,t,s,r,i){const a=i==null?void 0:i.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const o=await e.submitToolOutputs(t,s,{...r,stream:!1},{...i,signal:this.controller.signal});return this._connected(),this._addRun(o)}async _createAssistantStream(e,t,s,r){const i=r==null?void 0:r.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const a=await e.create(t,{...s,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addRun(a)}}Ze=new WeakMap,et=new WeakMap,Te=new WeakMap,ve=new WeakMap,tt=new WeakMap,Oe=new WeakMap,se=new WeakMap,Me=new WeakMap,nt=new WeakMap,st=new WeakMap,de=new WeakMap,pn=new WeakMap;var g=globalThis&&globalThis.__classPrivateFieldGet||function(n,e,t,s){if(t==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?s:t==="a"?s.call(n):s?s.value:e.get(n)},D=globalThis&&globalThis.__classPrivateFieldSet||function(n,e,t,s,r){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?r.call(n,t):r?r.value=t:e.set(n,t),t},W,mn,Q,rt,G,le,pe,ce,St,U,it,at,Ie,ke,Fe,ls,us,fs,hs,ds,ps,ms;class z extends qi{constructor(){super(...arguments),W.add(this),mn.set(this,[]),Q.set(this,{}),rt.set(this,{}),G.set(this,void 0),le.set(this,void 0),pe.set(this,void 0),ce.set(this,void 0),St.set(this,void 0),U.set(this,void 0),it.set(this,void 0),at.set(this,void 0),Ie.set(this,void 0)}[(mn=new WeakMap,Q=new WeakMap,rt=new WeakMap,G=new WeakMap,le=new WeakMap,pe=new WeakMap,ce=new WeakMap,St=new WeakMap,U=new WeakMap,it=new WeakMap,at=new WeakMap,Ie=new WeakMap,W=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let s=!1;return this.on("event",r=>{const i=t.shift();i?i.resolve(r):e.push(r)}),this.on("end",()=>{s=!0;for(const r of t)r.resolve(void 0);t.length=0}),this.on("abort",r=>{s=!0;for(const i of t)i.reject(r);t.length=0}),this.on("error",r=>{s=!0;for(const i of t)i.reject(r);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new z;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){var i;const s=t==null?void 0:t.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),this._connected();const r=Y.fromReadableStream(e,this.controller);for await(const a of r)g(this,W,"m",ke).call(this,a);if((i=r.controller.signal)!=null&&i.aborted)throw new q;return this._addRun(g(this,W,"m",Fe).call(this))}toReadableStream(){return new Y(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,s,r,i){const a=new z;return a._run(()=>a._runToolAssistantStream(e,t,s,r,{...i,headers:{...i==null?void 0:i.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createToolAssistantStream(e,t,s,r,i){var l;const a=i==null?void 0:i.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const o={...r,stream:!0},c=await e.submitToolOutputs(t,s,o,{...i,signal:this.controller.signal});this._connected();for await(const h of c)g(this,W,"m",ke).call(this,h);if((l=c.controller.signal)!=null&&l.aborted)throw new q;return this._addRun(g(this,W,"m",Fe).call(this))}static createThreadAssistantStream(e,t,s){const r=new z;return r._run(()=>r._threadAssistantStream(e,t,{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),r}static createAssistantStream(e,t,s,r){const i=new z;return i._run(()=>i._runAssistantStream(e,t,s,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),i}currentEvent(){return g(this,it,"f")}currentRun(){return g(this,at,"f")}currentMessageSnapshot(){return g(this,G,"f")}currentRunStepSnapshot(){return g(this,Ie,"f")}async finalRunSteps(){return await this.done(),Object.values(g(this,Q,"f"))}async finalMessages(){return await this.done(),Object.values(g(this,rt,"f"))}async finalRun(){if(await this.done(),!g(this,le,"f"))throw Error("Final run was not received.");return g(this,le,"f")}async _createThreadAssistantStream(e,t,s){var o;const r=s==null?void 0:s.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));const i={...t,stream:!0},a=await e.createAndRun(i,{...s,signal:this.controller.signal});this._connected();for await(const c of a)g(this,W,"m",ke).call(this,c);if((o=a.controller.signal)!=null&&o.aborted)throw new q;return this._addRun(g(this,W,"m",Fe).call(this))}async _createAssistantStream(e,t,s,r){var c;const i=r==null?void 0:r.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const a={...s,stream:!0},o=await e.create(t,a,{...r,signal:this.controller.signal});this._connected();for await(const l of o)g(this,W,"m",ke).call(this,l);if((c=o.controller.signal)!=null&&c.aborted)throw new q;return this._addRun(g(this,W,"m",Fe).call(this))}static accumulateDelta(e,t){for(const[s,r]of Object.entries(t)){if(!e.hasOwnProperty(s)){e[s]=r;continue}let i=e[s];if(i==null){e[s]=r;continue}if(s==="index"||s==="type"){e[s]=r;continue}if(typeof i=="string"&&typeof r=="string")i+=r;else if(typeof i=="number"&&typeof r=="number")i+=r;else if(is(i)&&is(r))i=this.accumulateDelta(i,r);else if(Array.isArray(i)&&Array.isArray(r)){if(i.every(a=>typeof a=="string"||typeof a=="number")){i.push(...r);continue}}else throw Error(`Unhandled record type: ${s}, deltaValue: ${r}, accValue: ${i}`);e[s]=i}return e}}ke=function(e){if(!this.ended)switch(D(this,it,e,"f"),g(this,W,"m",fs).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":g(this,W,"m",ms).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":g(this,W,"m",us).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":g(this,W,"m",ls).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},Fe=function(){if(this.ended)throw new R("stream has ended, this shouldn't happen");if(!g(this,le,"f"))throw Error("Final run has not been received");return g(this,le,"f")},ls=function(e){const[t,s]=g(this,W,"m",ds).call(this,e,g(this,G,"f"));D(this,G,t,"f"),g(this,rt,"f")[t.id]=t;for(const r of s){const i=t.content[r.index];(i==null?void 0:i.type)=="text"&&this._emit("textCreated",i.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const r of e.data.delta.content){if(r.type=="text"&&r.text){let i=r.text,a=t.content[r.index];if(a&&a.type=="text")this._emit("textDelta",i,a.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(r.index!=g(this,pe,"f")){if(g(this,ce,"f"))switch(g(this,ce,"f").type){case"text":this._emit("textDone",g(this,ce,"f").text,g(this,G,"f"));break;case"image_file":this._emit("imageFileDone",g(this,ce,"f").image_file,g(this,G,"f"));break}D(this,pe,r.index,"f")}D(this,ce,t.content[r.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(g(this,pe,"f")!==void 0){const r=e.data.content[g(this,pe,"f")];if(r)switch(r.type){case"image_file":this._emit("imageFileDone",r.image_file,g(this,G,"f"));break;case"text":this._emit("textDone",r.text,g(this,G,"f"));break}}g(this,G,"f")&&this._emit("messageDone",e.data),D(this,G,void 0,"f")}},us=function(e){const t=g(this,W,"m",hs).call(this,e);switch(D(this,Ie,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const s=e.data.delta;if(s.step_details&&s.step_details.type=="tool_calls"&&s.step_details.tool_calls&&t.step_details.type=="tool_calls")for(const i of s.step_details.tool_calls)i.index==g(this,St,"f")?this._emit("toolCallDelta",i,t.step_details.tool_calls[i.index]):(g(this,U,"f")&&this._emit("toolCallDone",g(this,U,"f")),D(this,St,i.index,"f"),D(this,U,t.step_details.tool_calls[i.index],"f"),g(this,U,"f")&&this._emit("toolCallCreated",g(this,U,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":D(this,Ie,void 0,"f"),e.data.step_details.type=="tool_calls"&&g(this,U,"f")&&(this._emit("toolCallDone",g(this,U,"f")),D(this,U,void 0,"f")),this._emit("runStepDone",e.data,t);break}},fs=function(e){g(this,mn,"f").push(e),this._emit("event",e)},hs=function(e){switch(e.event){case"thread.run.step.created":return g(this,Q,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=g(this,Q,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let s=e.data;if(s.delta){const r=z.accumulateDelta(t,s.delta);g(this,Q,"f")[e.data.id]=r}return g(this,Q,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":g(this,Q,"f")[e.data.id]=e.data;break}if(g(this,Q,"f")[e.data.id])return g(this,Q,"f")[e.data.id];throw new Error("No snapshot available")},ds=function(e,t){let s=[];switch(e.event){case"thread.message.created":return[e.data,s];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let r=e.data;if(r.delta.content)for(const i of r.delta.content)if(i.index in t.content){let a=t.content[i.index];t.content[i.index]=g(this,W,"m",ps).call(this,i,a)}else t.content[i.index]=i,s.push(i);return[t,s];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,s];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},ps=function(e,t){return z.accumulateDelta(t,e)},ms=function(e){switch(D(this,at,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":D(this,le,e.data,"f"),g(this,U,"f")&&(this._emit("toolCallDone",g(this,U,"f")),D(this,U,void 0,"f"));break}};let At=class extends E{retrieve(e,t,s,r){return this._client.get(`/threads/${e}/messages/${t}/files/${s}`,{...r,headers:{"OpenAI-Beta":"assistants=v1",...r==null?void 0:r.headers}})}list(e,t,s={},r){return ee(s)?this.list(e,t,{},s):this._client.getAPIList(`/threads/${e}/messages/${t}/files`,vn,{query:s,...r,headers:{"OpenAI-Beta":"assistants=v1",...r==null?void 0:r.headers}})}};class vn extends ie{}(function(n){n.MessageFilesPage=vn})(At||(At={}));class Rt extends E{constructor(){super(...arguments),this.files=new At(this._client)}create(e,t,s){return this._client.post(`/threads/${e}/messages`,{body:t,...s,headers:{"OpenAI-Beta":"assistants=v1",...s==null?void 0:s.headers}})}retrieve(e,t,s){return this._client.get(`/threads/${e}/messages/${t}`,{...s,headers:{"OpenAI-Beta":"assistants=v1",...s==null?void 0:s.headers}})}update(e,t,s,r){return this._client.post(`/threads/${e}/messages/${t}`,{body:s,...r,headers:{"OpenAI-Beta":"assistants=v1",...r==null?void 0:r.headers}})}list(e,t={},s){return ee(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,On,{query:t,...s,headers:{"OpenAI-Beta":"assistants=v1",...s==null?void 0:s.headers}})}}class On extends ie{}(function(n){n.MessagesPage=On,n.Files=At,n.MessageFilesPage=vn})(Rt||(Rt={}));class Ct extends E{retrieve(e,t,s,r){return this._client.get(`/threads/${e}/runs/${t}/steps/${s}`,{...r,headers:{"OpenAI-Beta":"assistants=v1",...r==null?void 0:r.headers}})}list(e,t,s={},r){return ee(s)?this.list(e,t,{},s):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,Mn,{query:s,...r,headers:{"OpenAI-Beta":"assistants=v1",...r==null?void 0:r.headers}})}}class Mn extends ie{}(function(n){n.RunStepsPage=Mn})(Ct||(Ct={}));class Et extends E{constructor(){super(...arguments),this.steps=new Ct(this._client)}create(e,t,s){return this._client.post(`/threads/${e}/runs`,{body:t,...s,headers:{"OpenAI-Beta":"assistants=v1",...s==null?void 0:s.headers},stream:t.stream??!1})}retrieve(e,t,s){return this._client.get(`/threads/${e}/runs/${t}`,{...s,headers:{"OpenAI-Beta":"assistants=v1",...s==null?void 0:s.headers}})}update(e,t,s,r){return this._client.post(`/threads/${e}/runs/${t}`,{body:s,...r,headers:{"OpenAI-Beta":"assistants=v1",...r==null?void 0:r.headers}})}list(e,t={},s){return ee(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,kn,{query:t,...s,headers:{"OpenAI-Beta":"assistants=v1",...s==null?void 0:s.headers}})}cancel(e,t,s){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...s,headers:{"OpenAI-Beta":"assistants=v1",...s==null?void 0:s.headers}})}async createAndPoll(e,t,s){const r=await this.create(e,t,s);return await this.poll(e,r.id,s)}createAndStream(e,t,s){return z.createAssistantStream(e,this._client.beta.threads.runs,t,s)}async poll(e,t,s){const r={...s==null?void 0:s.headers,"X-Stainless-Poll-Helper":"true"};for(s!=null&&s.pollIntervalMs&&(r["X-Stainless-Custom-Poll-Interval"]=s.pollIntervalMs.toString());;){const{data:i,response:a}=await this.retrieve(e,t,{...s,headers:{...s==null?void 0:s.headers,...r}}).withResponse();switch(i.status){case"queued":case"in_progress":case"cancelling":let o=5e3;if(s!=null&&s.pollIntervalMs)o=s.pollIntervalMs;else{const c=a.headers.get("openai-poll-after-ms");if(c){const l=parseInt(c);isNaN(l)||(o=l)}}await En(o);break;case"requires_action":case"cancelled":case"completed":case"failed":case"expired":return i}}}stream(e,t,s){return z.createAssistantStream(e,this._client.beta.threads.runs,t,s)}submitToolOutputs(e,t,s,r){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:s,...r,headers:{"OpenAI-Beta":"assistants=v1",...r==null?void 0:r.headers},stream:s.stream??!1})}async submitToolOutputsAndPoll(e,t,s,r){const i=await this.submitToolOutputs(e,t,s,r);return await this.poll(e,i.id,r)}submitToolOutputsStream(e,t,s,r){return z.createToolAssistantStream(e,t,this._client.beta.threads.runs,s,r)}}class kn extends ie{}(function(n){n.RunsPage=kn,n.Steps=Ct,n.RunStepsPage=Mn})(Et||(Et={}));class Pt extends E{constructor(){super(...arguments),this.runs=new Et(this._client),this.messages=new Rt(this._client)}create(e={},t){return ee(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v1",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v1",...t==null?void 0:t.headers}})}update(e,t,s){return this._client.post(`/threads/${e}`,{body:t,...s,headers:{"OpenAI-Beta":"assistants=v1",...s==null?void 0:s.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v1",...t==null?void 0:t.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v1",...t==null?void 0:t.headers},stream:e.stream??!1})}async createAndRunPoll(e,t){const s=await this.createAndRun(e,t);return await this.runs.poll(s.thread_id,s.id,t)}createAndRunStream(e,t){return z.createThreadAssistantStream(e,this._client.beta.threads,t)}}(function(n){n.Runs=Et,n.RunsPage=kn,n.Messages=Rt,n.MessagesPage=On})(Pt||(Pt={}));class xt extends E{constructor(){super(...arguments),this.chat=new _t(this._client),this.assistants=new wt(this._client),this.threads=new Pt(this._client)}}(function(n){n.Chat=_t,n.Assistants=wt,n.AssistantsPage=Tn,n.Threads=Pt})(xt||(xt={}));class Tt extends E{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}Tt||(Tt={});class vt extends E{create(e,t){return this._client.post("/embeddings",{body:e,...t})}}vt||(vt={});class Ot extends E{create(e,t){return this._client.post("/files",$e({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return ee(e)?this.list({},e):this._client.getAPIList("/files",Fn,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/json",...t==null?void 0:t.headers}})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:s=30*60*1e3}={}){const r=new Set(["processed","error","deleted"]),i=Date.now();let a=await this.retrieve(e);for(;!a.status||!r.has(a.status);)if(await En(t),a=await this.retrieve(e),Date.now()-i>s)throw new Cn({message:`Giving up on waiting for file ${e} to finish processing after ${s} milliseconds.`});return a}}class Fn extends Pn{}(function(n){n.FileObjectsPage=Fn})(Ot||(Ot={}));class Mt extends E{create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return ee(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",Wn,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},s){return ee(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,In,{query:t,...s})}}class Wn extends ie{}class In extends ie{}(function(n){n.FineTuningJobsPage=Wn,n.FineTuningJobEventsPage=In})(Mt||(Mt={}));class kt extends E{constructor(){super(...arguments),this.jobs=new Mt(this._client)}}(function(n){n.Jobs=Mt,n.FineTuningJobsPage=Wn,n.FineTuningJobEventsPage=In})(kt||(kt={}));class Ft extends E{createVariation(e,t){return this._client.post("/images/variations",$e({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",$e({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}Ft||(Ft={});class Wt extends E{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",Ln,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}}class Ln extends Pn{}(function(n){n.ModelsPage=Ln})(Wt||(Wt={}));class It extends E{create(e,t){return this._client.post("/moderations",{body:e,...t})}}It||(It={});var ur;class k extends Oi{constructor({baseURL:e=zt("OPENAI_BASE_URL"),apiKey:t=zt("OPENAI_API_KEY"),organization:s=zt("OPENAI_ORG_ID")??null,...r}={}){if(t===void 0)throw new R("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const i={apiKey:t,organization:s,...r,baseURL:e||"https://api.openai.com/v1"};if(!i.dangerouslyAllowBrowser&&Di())throw new R(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:i.baseURL,timeout:i.timeout??6e5,httpAgent:i.httpAgent,maxRetries:i.maxRetries,fetch:i.fetch}),this.completions=new Tt(this),this.chat=new ht(this),this.embeddings=new vt(this),this.files=new Ot(this),this.images=new Ft(this),this.audio=new gt(this),this.moderations=new It(this),this.models=new Wt(this),this.fineTuning=new kt(this),this.beta=new xt(this),this._options=i,this.apiKey=t,this.organization=s}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}}ur=k;k.OpenAI=ur;k.OpenAIError=R;k.APIError=I;k.APIConnectionError=$t;k.APIConnectionTimeoutError=Cn;k.APIUserAbortError=q;k.NotFoundError=Js;k.ConflictError=Xs;k.RateLimitError=zs;k.BadRequestError=qs;k.AuthenticationError=Hs;k.InternalServerError=Ks;k.PermissionDeniedError=Vs;k.UnprocessableEntityError=Gs;(function(n){n.toFile=er,n.fileFromPath=Ds,n.Page=Pn,n.CursorPage=ie,n.Completions=Tt,n.Chat=ht,n.Embeddings=vt,n.Files=Ot,n.FileObjectsPage=Fn,n.Images=Ft,n.Audio=gt,n.Moderations=It,n.Models=Wt,n.ModelsPage=Ln,n.FineTuning=kt,n.Beta=xt})(k||(k={}));const Hi=k;class fr{constructor(e,t){j(this,"author");j(this,"content");this.author=e,this.content=t}toString(){return this.author+":"+this.content}}function hr(n,e){return function(){return n.apply(e,arguments)}}const{toString:Vi}=Object.prototype,{getPrototypeOf:$n}=Object,Bt=(n=>e=>{const t=Vi.call(e);return n[t]||(n[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),te=n=>(n=n.toLowerCase(),e=>Bt(e)===n),jt=n=>e=>typeof e===n,{isArray:Ae}=Array,je=jt("undefined");function Ji(n){return n!==null&&!je(n)&&n.constructor!==null&&!je(n.constructor)&&H(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const dr=te("ArrayBuffer");function Xi(n){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(n):e=n&&n.buffer&&dr(n.buffer),e}const Gi=jt("string"),H=jt("function"),pr=jt("number"),Dt=n=>n!==null&&typeof n=="object",zi=n=>n===!0||n===!1,ot=n=>{if(Bt(n)!=="object")return!1;const e=$n(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},Ki=te("Date"),Qi=te("File"),Yi=te("Blob"),Zi=te("FileList"),ea=n=>Dt(n)&&H(n.pipe),ta=n=>{let e;return n&&(typeof FormData=="function"&&n instanceof FormData||H(n.append)&&((e=Bt(n))==="formdata"||e==="object"&&H(n.toString)&&n.toString()==="[object FormData]"))},na=te("URLSearchParams"),sa=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function qe(n,e,{allOwnKeys:t=!1}={}){if(n===null||typeof n>"u")return;let s,r;if(typeof n!="object"&&(n=[n]),Ae(n))for(s=0,r=n.length;s<r;s++)e.call(null,n[s],s,n);else{const i=t?Object.getOwnPropertyNames(n):Object.keys(n),a=i.length;let o;for(s=0;s<a;s++)o=i[s],e.call(null,n[o],o,n)}}function mr(n,e){e=e.toLowerCase();const t=Object.keys(n);let s=t.length,r;for(;s-- >0;)if(r=t[s],e===r.toLowerCase())return r;return null}const gr=(()=>typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global)(),yr=n=>!je(n)&&n!==gr;function gn(){const{caseless:n}=yr(this)&&this||{},e={},t=(s,r)=>{const i=n&&mr(e,r)||r;ot(e[i])&&ot(s)?e[i]=gn(e[i],s):ot(s)?e[i]=gn({},s):Ae(s)?e[i]=s.slice():e[i]=s};for(let s=0,r=arguments.length;s<r;s++)arguments[s]&&qe(arguments[s],t);return e}const ra=(n,e,t,{allOwnKeys:s}={})=>(qe(e,(r,i)=>{t&&H(r)?n[i]=hr(r,t):n[i]=r},{allOwnKeys:s}),n),ia=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),aa=(n,e,t,s)=>{n.prototype=Object.create(e.prototype,s),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:e.prototype}),t&&Object.assign(n.prototype,t)},oa=(n,e,t,s)=>{let r,i,a;const o={};if(e=e||{},n==null)return e;do{for(r=Object.getOwnPropertyNames(n),i=r.length;i-- >0;)a=r[i],(!s||s(a,n,e))&&!o[a]&&(e[a]=n[a],o[a]=!0);n=t!==!1&&$n(n)}while(n&&(!t||t(n,e))&&n!==Object.prototype);return e},ca=(n,e,t)=>{n=String(n),(t===void 0||t>n.length)&&(t=n.length),t-=e.length;const s=n.indexOf(e,t);return s!==-1&&s===t},la=n=>{if(!n)return null;if(Ae(n))return n;let e=n.length;if(!pr(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=n[e];return t},ua=(n=>e=>n&&e instanceof n)(typeof Uint8Array<"u"&&$n(Uint8Array)),fa=(n,e)=>{const s=(n&&n[Symbol.iterator]).call(n);let r;for(;(r=s.next())&&!r.done;){const i=r.value;e.call(n,i[0],i[1])}},ha=(n,e)=>{let t;const s=[];for(;(t=n.exec(e))!==null;)s.push(t);return s},da=te("HTMLFormElement"),pa=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,s,r){return s.toUpperCase()+r}),gs=(({hasOwnProperty:n})=>(e,t)=>n.call(e,t))(Object.prototype),ma=te("RegExp"),wr=(n,e)=>{const t=Object.getOwnPropertyDescriptors(n),s={};qe(t,(r,i)=>{let a;(a=e(r,i,n))!==!1&&(s[i]=a||r)}),Object.defineProperties(n,s)},ga=n=>{wr(n,(e,t)=>{if(H(n)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const s=n[t];if(H(s)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},ya=(n,e)=>{const t={},s=r=>{r.forEach(i=>{t[i]=!0})};return Ae(n)?s(n):s(String(n).split(e)),t},wa=()=>{},ba=(n,e)=>(n=+n,Number.isFinite(n)?n:e),Zt="abcdefghijklmnopqrstuvwxyz",ys="0123456789",br={DIGIT:ys,ALPHA:Zt,ALPHA_DIGIT:Zt+Zt.toUpperCase()+ys},_a=(n=16,e=br.ALPHA_DIGIT)=>{let t="";const{length:s}=e;for(;n--;)t+=e[Math.random()*s|0];return t};function Sa(n){return!!(n&&H(n.append)&&n[Symbol.toStringTag]==="FormData"&&n[Symbol.iterator])}const Aa=n=>{const e=new Array(10),t=(s,r)=>{if(Dt(s)){if(e.indexOf(s)>=0)return;if(!("toJSON"in s)){e[r]=s;const i=Ae(s)?[]:{};return qe(s,(a,o)=>{const c=t(a,r+1);!je(c)&&(i[o]=c)}),e[r]=void 0,i}}return s};return t(n,0)},Ra=te("AsyncFunction"),Ca=n=>n&&(Dt(n)||H(n))&&H(n.then)&&H(n.catch),f={isArray:Ae,isArrayBuffer:dr,isBuffer:Ji,isFormData:ta,isArrayBufferView:Xi,isString:Gi,isNumber:pr,isBoolean:zi,isObject:Dt,isPlainObject:ot,isUndefined:je,isDate:Ki,isFile:Qi,isBlob:Yi,isRegExp:ma,isFunction:H,isStream:ea,isURLSearchParams:na,isTypedArray:ua,isFileList:Zi,forEach:qe,merge:gn,extend:ra,trim:sa,stripBOM:ia,inherits:aa,toFlatObject:oa,kindOf:Bt,kindOfTest:te,endsWith:ca,toArray:la,forEachEntry:fa,matchAll:ha,isHTMLForm:da,hasOwnProperty:gs,hasOwnProp:gs,reduceDescriptors:wr,freezeMethods:ga,toObjectSet:ya,toCamelCase:pa,noop:wa,toFiniteNumber:ba,findKey:mr,global:gr,isContextDefined:yr,ALPHABET:br,generateString:_a,isSpecCompliantForm:Sa,toJSONObject:Aa,isAsyncFn:Ra,isThenable:Ca};function A(n,e,t,s,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),s&&(this.request=s),r&&(this.response=r)}f.inherits(A,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:f.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const _r=A.prototype,Sr={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{Sr[n]={value:n}});Object.defineProperties(A,Sr);Object.defineProperty(_r,"isAxiosError",{value:!0});A.from=(n,e,t,s,r,i)=>{const a=Object.create(_r);return f.toFlatObject(n,a,function(c){return c!==Error.prototype},o=>o!=="isAxiosError"),A.call(a,n.message,e,t,s,r),a.cause=n,a.name=n.name,i&&Object.assign(a,i),a};const Ea=null;function yn(n){return f.isPlainObject(n)||f.isArray(n)}function Ar(n){return f.endsWith(n,"[]")?n.slice(0,-2):n}function ws(n,e,t){return n?n.concat(e).map(function(r,i){return r=Ar(r),!t&&i?"["+r+"]":r}).join(t?".":""):e}function Pa(n){return f.isArray(n)&&!n.some(yn)}const xa=f.toFlatObject(f,{},null,function(e){return/^is[A-Z]/.test(e)});function Ut(n,e,t){if(!f.isObject(n))throw new TypeError("target must be an object");e=e||new FormData,t=f.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(p,y){return!f.isUndefined(y[p])});const s=t.metaTokens,r=t.visitor||h,i=t.dots,a=t.indexes,c=(t.Blob||typeof Blob<"u"&&Blob)&&f.isSpecCompliantForm(e);if(!f.isFunction(r))throw new TypeError("visitor must be a function");function l(d){if(d===null)return"";if(f.isDate(d))return d.toISOString();if(!c&&f.isBlob(d))throw new A("Blob is not supported. Use a Buffer instead.");return f.isArrayBuffer(d)||f.isTypedArray(d)?c&&typeof Blob=="function"?new Blob([d]):Buffer.from(d):d}function h(d,p,y){let m=d;if(d&&!y&&typeof d=="object"){if(f.endsWith(p,"{}"))p=s?p:p.slice(0,-2),d=JSON.stringify(d);else if(f.isArray(d)&&Pa(d)||(f.isFileList(d)||f.endsWith(p,"[]"))&&(m=f.toArray(d)))return p=Ar(p),m.forEach(function(C,T){!(f.isUndefined(C)||C===null)&&e.append(a===!0?ws([p],T,i):a===null?p:p+"[]",l(C))}),!1}return yn(d)?!0:(e.append(ws(y,p,i),l(d)),!1)}const u=[],w=Object.assign(xa,{defaultVisitor:h,convertValue:l,isVisitable:yn});function b(d,p){if(!f.isUndefined(d)){if(u.indexOf(d)!==-1)throw Error("Circular reference detected in "+p.join("."));u.push(d),f.forEach(d,function(m,_){(!(f.isUndefined(m)||m===null)&&r.call(e,m,f.isString(_)?_.trim():_,p,w))===!0&&b(m,p?p.concat(_):[_])}),u.pop()}}if(!f.isObject(n))throw new TypeError("data must be an object");return b(n),e}function bs(n){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(s){return e[s]})}function Nn(n,e){this._pairs=[],n&&Ut(n,this,e)}const Rr=Nn.prototype;Rr.append=function(e,t){this._pairs.push([e,t])};Rr.toString=function(e){const t=e?function(s){return e.call(this,s,bs)}:bs;return this._pairs.map(function(r){return t(r[0])+"="+t(r[1])},"").join("&")};function Ta(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Cr(n,e,t){if(!e)return n;const s=t&&t.encode||Ta,r=t&&t.serialize;let i;if(r?i=r(e,t):i=f.isURLSearchParams(e)?e.toString():new Nn(e,t).toString(s),i){const a=n.indexOf("#");a!==-1&&(n=n.slice(0,a)),n+=(n.indexOf("?")===-1?"?":"&")+i}return n}class va{constructor(){this.handlers=[]}use(e,t,s){return this.handlers.push({fulfilled:e,rejected:t,synchronous:s?s.synchronous:!1,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){f.forEach(this.handlers,function(s){s!==null&&e(s)})}}const _s=va,Er={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Oa=typeof URLSearchParams<"u"?URLSearchParams:Nn,Ma=typeof FormData<"u"?FormData:null,ka=typeof Blob<"u"?Blob:null,Fa={isBrowser:!0,classes:{URLSearchParams:Oa,FormData:Ma,Blob:ka},protocols:["http","https","file","blob","url","data"]},Pr=typeof window<"u"&&typeof document<"u",Wa=(n=>Pr&&["ReactNative","NativeScript","NS"].indexOf(n)<0)(typeof navigator<"u"&&navigator.product),Ia=(()=>typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),La=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Pr,hasStandardBrowserEnv:Wa,hasStandardBrowserWebWorkerEnv:Ia},Symbol.toStringTag,{value:"Module"})),Z={...La,...Fa};function $a(n,e){return Ut(n,new Z.classes.URLSearchParams,Object.assign({visitor:function(t,s,r,i){return Z.isNode&&f.isBuffer(t)?(this.append(s,t.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)}},e))}function Na(n){return f.matchAll(/\w+|\[(\w*)]/g,n).map(e=>e[0]==="[]"?"":e[1]||e[0])}function Ba(n){const e={},t=Object.keys(n);let s;const r=t.length;let i;for(s=0;s<r;s++)i=t[s],e[i]=n[i];return e}function xr(n){function e(t,s,r,i){let a=t[i++];if(a==="__proto__")return!0;const o=Number.isFinite(+a),c=i>=t.length;return a=!a&&f.isArray(r)?r.length:a,c?(f.hasOwnProp(r,a)?r[a]=[r[a],s]:r[a]=s,!o):((!r[a]||!f.isObject(r[a]))&&(r[a]=[]),e(t,s,r[a],i)&&f.isArray(r[a])&&(r[a]=Ba(r[a])),!o)}if(f.isFormData(n)&&f.isFunction(n.entries)){const t={};return f.forEachEntry(n,(s,r)=>{e(Na(s),r,t,0)}),t}return null}function ja(n,e,t){if(f.isString(n))try{return(e||JSON.parse)(n),f.trim(n)}catch(s){if(s.name!=="SyntaxError")throw s}return(t||JSON.stringify)(n)}const Bn={transitional:Er,adapter:["xhr","http"],transformRequest:[function(e,t){const s=t.getContentType()||"",r=s.indexOf("application/json")>-1,i=f.isObject(e);if(i&&f.isHTMLForm(e)&&(e=new FormData(e)),f.isFormData(e))return r?JSON.stringify(xr(e)):e;if(f.isArrayBuffer(e)||f.isBuffer(e)||f.isStream(e)||f.isFile(e)||f.isBlob(e))return e;if(f.isArrayBufferView(e))return e.buffer;if(f.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let o;if(i){if(s.indexOf("application/x-www-form-urlencoded")>-1)return $a(e,this.formSerializer).toString();if((o=f.isFileList(e))||s.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return Ut(o?{"files[]":e}:e,c&&new c,this.formSerializer)}}return i||r?(t.setContentType("application/json",!1),ja(e)):e}],transformResponse:[function(e){const t=this.transitional||Bn.transitional,s=t&&t.forcedJSONParsing,r=this.responseType==="json";if(e&&f.isString(e)&&(s&&!this.responseType||r)){const a=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(o){if(a)throw o.name==="SyntaxError"?A.from(o,A.ERR_BAD_RESPONSE,this,null,this.response):o}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Z.classes.FormData,Blob:Z.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};f.forEach(["delete","get","head","post","put","patch"],n=>{Bn.headers[n]={}});const jn=Bn,Da=f.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Ua=n=>{const e={};let t,s,r;return n&&n.split(`
`).forEach(function(a){r=a.indexOf(":"),t=a.substring(0,r).trim().toLowerCase(),s=a.substring(r+1).trim(),!(!t||e[t]&&Da[t])&&(t==="set-cookie"?e[t]?e[t].push(s):e[t]=[s]:e[t]=e[t]?e[t]+", "+s:s)}),e},Ss=Symbol("internals");function Re(n){return n&&String(n).trim().toLowerCase()}function ct(n){return n===!1||n==null?n:f.isArray(n)?n.map(ct):String(n)}function qa(n){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let s;for(;s=t.exec(n);)e[s[1]]=s[2];return e}const Ha=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function en(n,e,t,s,r){if(f.isFunction(s))return s.call(this,e,t);if(r&&(e=t),!!f.isString(e)){if(f.isString(s))return e.indexOf(s)!==-1;if(f.isRegExp(s))return s.test(e)}}function Va(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,s)=>t.toUpperCase()+s)}function Ja(n,e){const t=f.toCamelCase(" "+e);["get","set","has"].forEach(s=>{Object.defineProperty(n,s+t,{value:function(r,i,a){return this[s].call(this,e,r,i,a)},configurable:!0})})}class qt{constructor(e){e&&this.set(e)}set(e,t,s){const r=this;function i(o,c,l){const h=Re(c);if(!h)throw new Error("header name must be a non-empty string");const u=f.findKey(r,h);(!u||r[u]===void 0||l===!0||l===void 0&&r[u]!==!1)&&(r[u||c]=ct(o))}const a=(o,c)=>f.forEach(o,(l,h)=>i(l,h,c));return f.isPlainObject(e)||e instanceof this.constructor?a(e,t):f.isString(e)&&(e=e.trim())&&!Ha(e)?a(Ua(e),t):e!=null&&i(t,e,s),this}get(e,t){if(e=Re(e),e){const s=f.findKey(this,e);if(s){const r=this[s];if(!t)return r;if(t===!0)return qa(r);if(f.isFunction(t))return t.call(this,r,s);if(f.isRegExp(t))return t.exec(r);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Re(e),e){const s=f.findKey(this,e);return!!(s&&this[s]!==void 0&&(!t||en(this,this[s],s,t)))}return!1}delete(e,t){const s=this;let r=!1;function i(a){if(a=Re(a),a){const o=f.findKey(s,a);o&&(!t||en(s,s[o],o,t))&&(delete s[o],r=!0)}}return f.isArray(e)?e.forEach(i):i(e),r}clear(e){const t=Object.keys(this);let s=t.length,r=!1;for(;s--;){const i=t[s];(!e||en(this,this[i],i,e,!0))&&(delete this[i],r=!0)}return r}normalize(e){const t=this,s={};return f.forEach(this,(r,i)=>{const a=f.findKey(s,i);if(a){t[a]=ct(r),delete t[i];return}const o=e?Va(i):String(i).trim();o!==i&&delete t[i],t[o]=ct(r),s[o]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return f.forEach(this,(s,r)=>{s!=null&&s!==!1&&(t[r]=e&&f.isArray(s)?s.join(", "):s)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const s=new this(e);return t.forEach(r=>s.set(r)),s}static accessor(e){const s=(this[Ss]=this[Ss]={accessors:{}}).accessors,r=this.prototype;function i(a){const o=Re(a);s[o]||(Ja(r,a),s[o]=!0)}return f.isArray(e)?e.forEach(i):i(e),this}}qt.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);f.reduceDescriptors(qt.prototype,({value:n},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>n,set(s){this[t]=s}}});f.freezeMethods(qt);const re=qt;function tn(n,e){const t=this||jn,s=e||t,r=re.from(s.headers);let i=s.data;return f.forEach(n,function(o){i=o.call(t,i,r.normalize(),e?e.status:void 0)}),r.normalize(),i}function Tr(n){return!!(n&&n.__CANCEL__)}function He(n,e,t){A.call(this,n??"canceled",A.ERR_CANCELED,e,t),this.name="CanceledError"}f.inherits(He,A,{__CANCEL__:!0});function Xa(n,e,t){const s=t.config.validateStatus;!t.status||!s||s(t.status)?n(t):e(new A("Request failed with status code "+t.status,[A.ERR_BAD_REQUEST,A.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}const Ga=Z.hasStandardBrowserEnv?{write(n,e,t,s,r,i){const a=[n+"="+encodeURIComponent(e)];f.isNumber(t)&&a.push("expires="+new Date(t).toGMTString()),f.isString(s)&&a.push("path="+s),f.isString(r)&&a.push("domain="+r),i===!0&&a.push("secure"),document.cookie=a.join("; ")},read(n){const e=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(n){this.write(n,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function za(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function Ka(n,e){return e?n.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):n}function vr(n,e){return n&&!za(e)?Ka(n,e):e}const Qa=Z.hasStandardBrowserEnv?function(){const e=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a");let s;function r(i){let a=i;return e&&(t.setAttribute("href",a),a=t.href),t.setAttribute("href",a),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:t.pathname.charAt(0)==="/"?t.pathname:"/"+t.pathname}}return s=r(window.location.href),function(a){const o=f.isString(a)?r(a):a;return o.protocol===s.protocol&&o.host===s.host}}():function(){return function(){return!0}}();function Ya(n){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return e&&e[1]||""}function Za(n,e){n=n||10;const t=new Array(n),s=new Array(n);let r=0,i=0,a;return e=e!==void 0?e:1e3,function(c){const l=Date.now(),h=s[i];a||(a=l),t[r]=c,s[r]=l;let u=i,w=0;for(;u!==r;)w+=t[u++],u=u%n;if(r=(r+1)%n,r===i&&(i=(i+1)%n),l-a<e)return;const b=h&&l-h;return b?Math.round(w*1e3/b):void 0}}function As(n,e){let t=0;const s=Za(50,250);return r=>{const i=r.loaded,a=r.lengthComputable?r.total:void 0,o=i-t,c=s(o),l=i<=a;t=i;const h={loaded:i,total:a,progress:a?i/a:void 0,bytes:o,rate:c||void 0,estimated:c&&a&&l?(a-i)/c:void 0,event:r};h[e?"download":"upload"]=!0,n(h)}}const eo=typeof XMLHttpRequest<"u",to=eo&&function(n){return new Promise(function(t,s){let r=n.data;const i=re.from(n.headers).normalize();let{responseType:a,withXSRFToken:o}=n,c;function l(){n.cancelToken&&n.cancelToken.unsubscribe(c),n.signal&&n.signal.removeEventListener("abort",c)}let h;if(f.isFormData(r)){if(Z.hasStandardBrowserEnv||Z.hasStandardBrowserWebWorkerEnv)i.setContentType(!1);else if((h=i.getContentType())!==!1){const[p,...y]=h?h.split(";").map(m=>m.trim()).filter(Boolean):[];i.setContentType([p||"multipart/form-data",...y].join("; "))}}let u=new XMLHttpRequest;if(n.auth){const p=n.auth.username||"",y=n.auth.password?unescape(encodeURIComponent(n.auth.password)):"";i.set("Authorization","Basic "+btoa(p+":"+y))}const w=vr(n.baseURL,n.url);u.open(n.method.toUpperCase(),Cr(w,n.params,n.paramsSerializer),!0),u.timeout=n.timeout;function b(){if(!u)return;const p=re.from("getAllResponseHeaders"in u&&u.getAllResponseHeaders()),m={data:!a||a==="text"||a==="json"?u.responseText:u.response,status:u.status,statusText:u.statusText,headers:p,config:n,request:u};Xa(function(C){t(C),l()},function(C){s(C),l()},m),u=null}if("onloadend"in u?u.onloadend=b:u.onreadystatechange=function(){!u||u.readyState!==4||u.status===0&&!(u.responseURL&&u.responseURL.indexOf("file:")===0)||setTimeout(b)},u.onabort=function(){u&&(s(new A("Request aborted",A.ECONNABORTED,n,u)),u=null)},u.onerror=function(){s(new A("Network Error",A.ERR_NETWORK,n,u)),u=null},u.ontimeout=function(){let y=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const m=n.transitional||Er;n.timeoutErrorMessage&&(y=n.timeoutErrorMessage),s(new A(y,m.clarifyTimeoutError?A.ETIMEDOUT:A.ECONNABORTED,n,u)),u=null},Z.hasStandardBrowserEnv&&(o&&f.isFunction(o)&&(o=o(n)),o||o!==!1&&Qa(w))){const p=n.xsrfHeaderName&&n.xsrfCookieName&&Ga.read(n.xsrfCookieName);p&&i.set(n.xsrfHeaderName,p)}r===void 0&&i.setContentType(null),"setRequestHeader"in u&&f.forEach(i.toJSON(),function(y,m){u.setRequestHeader(m,y)}),f.isUndefined(n.withCredentials)||(u.withCredentials=!!n.withCredentials),a&&a!=="json"&&(u.responseType=n.responseType),typeof n.onDownloadProgress=="function"&&u.addEventListener("progress",As(n.onDownloadProgress,!0)),typeof n.onUploadProgress=="function"&&u.upload&&u.upload.addEventListener("progress",As(n.onUploadProgress)),(n.cancelToken||n.signal)&&(c=p=>{u&&(s(!p||p.type?new He(null,n,u):p),u.abort(),u=null)},n.cancelToken&&n.cancelToken.subscribe(c),n.signal&&(n.signal.aborted?c():n.signal.addEventListener("abort",c)));const d=Ya(w);if(d&&Z.protocols.indexOf(d)===-1){s(new A("Unsupported protocol "+d+":",A.ERR_BAD_REQUEST,n));return}u.send(r||null)})},wn={http:Ea,xhr:to};f.forEach(wn,(n,e)=>{if(n){try{Object.defineProperty(n,"name",{value:e})}catch{}Object.defineProperty(n,"adapterName",{value:e})}});const Rs=n=>`- ${n}`,no=n=>f.isFunction(n)||n===null||n===!1,Or={getAdapter:n=>{n=f.isArray(n)?n:[n];const{length:e}=n;let t,s;const r={};for(let i=0;i<e;i++){t=n[i];let a;if(s=t,!no(t)&&(s=wn[(a=String(t)).toLowerCase()],s===void 0))throw new A(`Unknown adapter '${a}'`);if(s)break;r[a||"#"+i]=s}if(!s){const i=Object.entries(r).map(([o,c])=>`adapter ${o} `+(c===!1?"is not supported by the environment":"is not available in the build"));let a=e?i.length>1?`since :
`+i.map(Rs).join(`
`):" "+Rs(i[0]):"as no adapter specified";throw new A("There is no suitable adapter to dispatch the request "+a,"ERR_NOT_SUPPORT")}return s},adapters:wn};function nn(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new He(null,n)}function Cs(n){return nn(n),n.headers=re.from(n.headers),n.data=tn.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),Or.getAdapter(n.adapter||jn.adapter)(n).then(function(s){return nn(n),s.data=tn.call(n,n.transformResponse,s),s.headers=re.from(s.headers),s},function(s){return Tr(s)||(nn(n),s&&s.response&&(s.response.data=tn.call(n,n.transformResponse,s.response),s.response.headers=re.from(s.response.headers))),Promise.reject(s)})}const Es=n=>n instanceof re?{...n}:n;function _e(n,e){e=e||{};const t={};function s(l,h,u){return f.isPlainObject(l)&&f.isPlainObject(h)?f.merge.call({caseless:u},l,h):f.isPlainObject(h)?f.merge({},h):f.isArray(h)?h.slice():h}function r(l,h,u){if(f.isUndefined(h)){if(!f.isUndefined(l))return s(void 0,l,u)}else return s(l,h,u)}function i(l,h){if(!f.isUndefined(h))return s(void 0,h)}function a(l,h){if(f.isUndefined(h)){if(!f.isUndefined(l))return s(void 0,l)}else return s(void 0,h)}function o(l,h,u){if(u in e)return s(l,h);if(u in n)return s(void 0,l)}const c={url:i,method:i,data:i,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:o,headers:(l,h)=>r(Es(l),Es(h),!0)};return f.forEach(Object.keys(Object.assign({},n,e)),function(h){const u=c[h]||r,w=u(n[h],e[h],h);f.isUndefined(w)&&u!==o||(t[h]=w)}),t}const Mr="1.6.8",Dn={};["object","boolean","number","function","string","symbol"].forEach((n,e)=>{Dn[n]=function(s){return typeof s===n||"a"+(e<1?"n ":" ")+n}});const Ps={};Dn.transitional=function(e,t,s){function r(i,a){return"[Axios v"+Mr+"] Transitional option '"+i+"'"+a+(s?". "+s:"")}return(i,a,o)=>{if(e===!1)throw new A(r(a," has been removed"+(t?" in "+t:"")),A.ERR_DEPRECATED);return t&&!Ps[a]&&(Ps[a]=!0,console.warn(r(a," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(i,a,o):!0}};function so(n,e,t){if(typeof n!="object")throw new A("options must be an object",A.ERR_BAD_OPTION_VALUE);const s=Object.keys(n);let r=s.length;for(;r-- >0;){const i=s[r],a=e[i];if(a){const o=n[i],c=o===void 0||a(o,i,n);if(c!==!0)throw new A("option "+i+" must be "+c,A.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new A("Unknown option "+i,A.ERR_BAD_OPTION)}}const bn={assertOptions:so,validators:Dn},oe=bn.validators;class Lt{constructor(e){this.defaults=e,this.interceptors={request:new _s,response:new _s}}async request(e,t){try{return await this._request(e,t)}catch(s){if(s instanceof Error){let r;Error.captureStackTrace?Error.captureStackTrace(r={}):r=new Error;const i=r.stack?r.stack.replace(/^.+\n/,""):"";s.stack?i&&!String(s.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+i):s.stack=i}throw s}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=_e(this.defaults,t);const{transitional:s,paramsSerializer:r,headers:i}=t;s!==void 0&&bn.assertOptions(s,{silentJSONParsing:oe.transitional(oe.boolean),forcedJSONParsing:oe.transitional(oe.boolean),clarifyTimeoutError:oe.transitional(oe.boolean)},!1),r!=null&&(f.isFunction(r)?t.paramsSerializer={serialize:r}:bn.assertOptions(r,{encode:oe.function,serialize:oe.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let a=i&&f.merge(i.common,i[t.method]);i&&f.forEach(["delete","get","head","post","put","patch","common"],d=>{delete i[d]}),t.headers=re.concat(a,i);const o=[];let c=!0;this.interceptors.request.forEach(function(p){typeof p.runWhen=="function"&&p.runWhen(t)===!1||(c=c&&p.synchronous,o.unshift(p.fulfilled,p.rejected))});const l=[];this.interceptors.response.forEach(function(p){l.push(p.fulfilled,p.rejected)});let h,u=0,w;if(!c){const d=[Cs.bind(this),void 0];for(d.unshift.apply(d,o),d.push.apply(d,l),w=d.length,h=Promise.resolve(t);u<w;)h=h.then(d[u++],d[u++]);return h}w=o.length;let b=t;for(u=0;u<w;){const d=o[u++],p=o[u++];try{b=d(b)}catch(y){p.call(this,y);break}}try{h=Cs.call(this,b)}catch(d){return Promise.reject(d)}for(u=0,w=l.length;u<w;)h=h.then(l[u++],l[u++]);return h}getUri(e){e=_e(this.defaults,e);const t=vr(e.baseURL,e.url);return Cr(t,e.params,e.paramsSerializer)}}f.forEach(["delete","get","head","options"],function(e){Lt.prototype[e]=function(t,s){return this.request(_e(s||{},{method:e,url:t,data:(s||{}).data}))}});f.forEach(["post","put","patch"],function(e){function t(s){return function(i,a,o){return this.request(_e(o||{},{method:e,headers:s?{"Content-Type":"multipart/form-data"}:{},url:i,data:a}))}}Lt.prototype[e]=t(),Lt.prototype[e+"Form"]=t(!0)});const lt=Lt;class Un{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(i){t=i});const s=this;this.promise.then(r=>{if(!s._listeners)return;let i=s._listeners.length;for(;i-- >0;)s._listeners[i](r);s._listeners=null}),this.promise.then=r=>{let i;const a=new Promise(o=>{s.subscribe(o),i=o}).then(r);return a.cancel=function(){s.unsubscribe(i)},a},e(function(i,a,o){s.reason||(s.reason=new He(i,a,o),t(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}static source(){let e;return{token:new Un(function(r){e=r}),cancel:e}}}const ro=Un;function io(n){return function(t){return n.apply(null,t)}}function ao(n){return f.isObject(n)&&n.isAxiosError===!0}const _n={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(_n).forEach(([n,e])=>{_n[e]=n});const oo=_n;function kr(n){const e=new lt(n),t=hr(lt.prototype.request,e);return f.extend(t,lt.prototype,e,{allOwnKeys:!0}),f.extend(t,e,null,{allOwnKeys:!0}),t.create=function(r){return kr(_e(n,r))},t}const v=kr(jn);v.Axios=lt;v.CanceledError=He;v.CancelToken=ro;v.isCancel=Tr;v.VERSION=Mr;v.toFormData=Ut;v.AxiosError=A;v.Cancel=v.CanceledError;v.all=function(e){return Promise.all(e)};v.spread=io;v.isAxiosError=ao;v.mergeConfig=_e;v.AxiosHeaders=re;v.formToJSON=n=>xr(f.isHTMLForm(n)?new FormData(n):n);v.getAdapter=Or.getAdapter;v.HttpStatusCode=oo;v.default=v;const co=v;class lo{constructor(e){j(this,"descriptionOfUser");j(this,"openai",null);j(this,"chatHistory");this.descriptionOfUser="Tu t'appelles "+e+`, tu es un développeur en télétravail. Un collègue discute avec toi. Montre lui que tu es en train de travailler et coupe court à la conversation pour gagner du temps. Aie un langage familier et décontracté, mais ne te répète pas. Fait des réponses très brèves tout en étant convaincant. Fait des fautes de frappes de temps en temps et utilises quand c'est nécessaire des abréviations comme "tkt" pour "t'inquiète" ou "dsl" pour "désolé". Dit des mots comme "merde" ou "ptn" quand tu es embêté et évite la ponctuation. Si jamais on te demande, pour l'instant tu n'es pas disponible pour un call
`,this.chatHistory=[],this.initializeOpenAI()}async initializeOpenAI(){try{const t=(await co.get("https://key-getter-b64d10ddaae7.herokuapp.com/api/key")).data.key;this.openai=new Hi({dangerouslyAllowBrowser:!0,apiKey:t})}catch(e){console.error("Error initializing OpenAI:",e)}}async respondTo(e){var s;if(!this.openai){console.error("OpenAI client is not initialized.");return}let t=this.generatePrompt(e);console.log(t);try{const r=await this.openai.chat.completions.create({messages:[{role:"user",content:t}],model:"gpt-3.5-turbo"}),i=(s=r.choices[0])==null?void 0:s.message.content;if(i==null)throw new Error("OpenAI returned no response: "+JSON.stringify(r));return console.log("OpenAI response:",i),e.forEach(a=>{this.chatHistory.push(a)}),this.chatHistory.push(new fr("Toi",i)),i}catch(r){return console.error("An error occurred while generating a response:",r),null}}generatePrompt(e){if(e.length===0)return"";let t=this.descriptionOfUser;return this.chatHistory.length!=0&&(t+=`Voici l'historique de la discussion :
`,this.chatHistory.forEach(s=>{t+=s.content+`
`})),e.length===1?(this.chatHistory.length===0?t+="Répond à ce message de "+e[0].author+" : "+e[0].content:t+="Répond à ce message : "+e[0].content,t):(t+=`Fait une seule réponse pour les messages suivants :
`,e.forEach(s=>{t+=s.content+`
`}),t)}}class uo{constructor(e){j(this,"isTyping");j(this,"messagesToRespond");j(this,"generateMessage");j(this,"responseTime");this.isTyping=!1,this.messagesToRespond=[],this.generateMessage=new lo(e),this.responseTime=0}respondToMessage(e,t){e.player.state.isSleepModeActive&&(this.messagesToRespond.push(t),this.responseTime=Math.floor(Math.random()*15e3)+1e4,console.log("randomTime",this.responseTime),!this.isTyping&&(this.isTyping=!0,setTimeout(async()=>{e.chat.startTyping({scope:"bubble",author:e.player.name});let s=await this.generateMessage.respondTo(this.messagesToRespond);if(s==null){e.chat.sendChatMessage("Désolé, je n'ai pas pu répondre à ta question. Je suis en train de travailler.",{scope:"bubble",author:e.player.name}),e.chat.stopTyping({scope:"bubble",author:e.player.name}),this.isTyping=!1,this.messagesToRespond=[];return}let r=this.getResponseTime(s);console.log(s),console.log("time to type the message",r),setTimeout(()=>{e.chat.sendChatMessage(s,{scope:"bubble",author:e.player.name}),e.chat.stopTyping({scope:"bubble",author:e.player.name}),this.isTyping=!1,this.messagesToRespond=[]},r)},this.responseTime)))}getResponseTime(e){const t=(Math.floor(Math.random()*80)+80)/60*1e3;return e.length*(t/4.8)}}class fo{constructor(){j(this,"mySound");j(this,"isSleepModeActive",!1);j(this,"config",{volume:50,loop:!1,rate:1,detune:1,delay:0,seek:0,mute:!1});this.mySound={}}playAudioFile(e,t){if(console.log("before"+this.isSleepModeActive),!this.isSleepModeActive)return;console.log("after"+this.isSleepModeActive),console.log("starting playing audio");const s="/WA-map-starter-kit/audio/";console.log("directory of file",s);const r=`${s}${t}.ogg`;console.log("file name",r),console.log("starting playing for "+t),e.player.proximityMeeting.playSound(r).then(()=>console.log("audio playing")),e.player.proximityMeeting.onLeave().subscribe(async()=>{e.room.area.onLeave("jitsiMeetingRoom").subscribe(()=>{this.mySound&&this.mySound.stop&&(this.mySound.stop(),console.log("Audio stopped."))}),e.chat.sendChatMessage("You left the proximity chat","System"),console.log("I m leaving")})}}console.log("Script started successfully");let ut;WA.onInit().then(async()=>{console.log("Scripting API ready"),console.log("Player tags: ",WA.player.tags);const n=new fo;await WA.players.configureTracking({players:!0,movement:!1}),WA.player.state.isSleepModeActive=!1,console.log("Sleep mode: ",WA.player.state.isSleepModeActive);let e,t,s,r;const i=new uo(WA.player.name),a=async()=>{WA.player.state.isSleepModeActive=!WA.player.state.isSleepModeActive,n.isSleepModeActive=WA.player.state.isSleepModeActive,e!=null&&(e.remove(),t&&t.remove(),WA.player.state.isSleepModeActive?(s=await WA.nav.openCoWebSite("/WA-map-starter-kit/sleepMode.html"),t=WA.ui.registerMenuCommand("Mouvement Automatique",{callback:()=>{r=WA.nav.openCoWebSite("/WA-map-starter-kit/time2chill.html",!0)}})):(s&&s.close(),r&&(await r).close()),e=WA.ui.registerMenuCommand(xs(WA),{callback:()=>{a()}}))};e=WA.ui.registerMenuCommand(xs(WA),{callback:()=>{WA.nav.openCoWebSite("/WA-map-starter-kit/time2chill.html",!0),a()}}),WA.player.proximityMeeting.onJoin().subscribe(async o=>{console.log("Player joined :"+o),console.log("Player joined :"+WA.player.name),n.playAudioFile(WA,WA.player.name)}),WA.chat.onChatMessage((o,c)=>{if(console.log("The local user typed a message",o),c.author!==void 0){console.log("Message author: ",c.author.name);let l=new fr(c.author.name,o);i.respondToMessage(WA,l)}},{scope:"bubble"}),WA.room.area.onEnter("clock").subscribe(()=>{const o=new Date,c=o.getHours().toString().padStart(2,"0"),l=o.getMinutes().toString().padStart(2,"0"),h=c+":"+l;ut=WA.ui.openPopup("clockPopup",h,[])}),WA.room.area.onLeave("clock").subscribe(ho),gi().then(()=>{console.log("Scripting API Extra ready")}).catch(o=>console.error(o))}).catch(n=>console.error(n));function ho(){ut!==void 0&&(ut.close(),ut=void 0)}function xs(n){return n.player.state.isSleepModeActive?"Se Réveiller !":"C'est l'heure de dormir"}
