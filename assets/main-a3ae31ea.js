var Ms=Object.defineProperty;var Fs=(n,e,t)=>e in n?Ms(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var H=(n,e,t)=>(Fs(n,typeof e!="symbol"?e+"":e,t),t);class we{constructor(e){this.properties=e??[]}get(e){const t=this.properties.filter(r=>r.name===e).map(r=>r.value);if(t.length>1)throw new Error('Expected only one property to be named "'+e+'"');if(t.length!==0)return t[0]}getString(e){return this.getByType(e,"string")}getNumber(e){return this.getByType(e,"number")}getBoolean(e){return this.getByType(e,"boolean")}getByType(e,t){const r=this.get(e);if(r!==void 0){if(t!=="json"&&typeof r!==t)throw new Error('Expected property "'+e+'" to have type "'+t+'"');return r}}mustGetString(e){return this.mustGetByType(e,"string")}mustGetNumber(e){return this.mustGetByType(e,"number")}mustGetBoolean(e){return this.mustGetByType(e,"boolean")}mustGetByType(e,t){const r=this.get(e);if(r===void 0)throw new Error('Property "'+e+'" is missing');if(t!=="json"&&typeof r!==t)throw new Error('Expected property "'+e+'" to have type "'+t+'"');return r}getType(e){const t=this.properties.filter(r=>r.name===e).map(r=>r.type);if(t.length>1)throw new Error('Expected only one property to be named "'+e+'"');if(t.length!==0)return t[0]}}const xr="https://unpkg.com/@workadventure/scripting-api-extra@1.7.4/dist";class Is{constructor(e){this.name=e.name,this.x=e.x,this.y=e.y,this.properties=new we(e.properties)}get isReadable(){const e=this.properties.getString("readableBy");return e?WA.player.tags.includes(e):!0}get isWritable(){const e=this.properties.getString("writableBy");return e?WA.player.tags.includes(e):!0}}function qn(n){const e=n?"#"+n.join():"";WA.nav.openCoWebSite(xr+"/configuration.html"+e,!0)}async function Ls(n,e){const t=await WA.room.getTiledMap(),r=new Map;return Tr(t.layers,r,n,e),r}function Tr(n,e,t,r){for(const s of n)if(s.type==="objectgroup"){for(const i of s.objects)if(i.type==="variable"||i.class==="variable"){if(t&&s.name!==t||r&&!r.includes(i.name))continue;e.set(i.name,new Is(i))}}else s.type==="group"&&Tr(s.layers,e,t,r)}let Vt;async function De(){return Vt===void 0&&(Vt=Ns()),Vt}async function Ns(){return Bs(await WA.room.getTiledMap())}function Bs(n){const e=new Map;return vr(n.layers,"",e),e}function vr(n,e,t){for(const r of n)r.type==="group"?vr(r.layers,e+r.name+"/",t):(r.name=e+r.name,t.set(r.name,r))}async function Or(){const n=await De(),e=[];for(const t of n.values())if(t.type==="objectgroup")for(const r of t.objects)(r.type==="area"||r.class==="area")&&e.push(r);return e}function $s(n){let e=1/0,t=1/0,r=0,s=0;const i=n.data;if(typeof i=="string")throw new Error("Unsupported tile layer data stored as string instead of CSV");for(let a=0;a<n.height;a++)for(let o=0;o<n.width;o++)i[o+a*n.width]!==0&&(e=Math.min(e,o),s=Math.max(s,o),t=Math.min(t,a),r=Math.max(r,a));return{top:t,left:e,right:s+1,bottom:r+1}}function kr(n){let e=1/0,t=1/0,r=0,s=0;for(const i of n){const a=$s(i);a.left<e&&(e=a.left),a.top<t&&(t=a.top),a.right>s&&(s=a.right),a.bottom>r&&(r=a.bottom)}return{top:t,left:e,right:s,bottom:r}}/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */var Ws=Object.prototype.toString,Se=Array.isArray||function(e){return Ws.call(e)==="[object Array]"};function Sn(n){return typeof n=="function"}function js(n){return Se(n)?"array":typeof n}function Jt(n){return n.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function Hn(n,e){return n!=null&&typeof n=="object"&&e in n}function Ds(n,e){return n!=null&&typeof n!="object"&&n.hasOwnProperty&&n.hasOwnProperty(e)}var Us=RegExp.prototype.test;function qs(n,e){return Us.call(n,e)}var Hs=/\S/;function Vs(n){return!qs(Hs,n)}var Js={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function Xs(n){return String(n).replace(/[&<>"'`=\/]/g,function(t){return Js[t]})}var Gs=/\s*/,zs=/\s+/,Vn=/\s*=/,Ks=/\s*\}/,Qs=/#|\^|\/|>|\{|&|=|!/;function Ys(n,e){if(!n)return[];var t=!1,r=[],s=[],i=[],a=!1,o=!1,c="",l=0;function h(){if(a&&!o)for(;i.length;)delete s[i.pop()];else i=[];a=!1,o=!1}var u,w,b;function d(N){if(typeof N=="string"&&(N=N.split(zs,2)),!Se(N)||N.length!==2)throw new Error("Invalid tags: "+N);u=new RegExp(Jt(N[0])+"\\s*"),w=new RegExp("\\s*"+Jt(N[1])),b=new RegExp("\\s*"+Jt("}"+N[1]))}d(e||W.tags);for(var p=new Ue(n),y,m,_,C,T,x;!p.eos();){if(y=p.pos,_=p.scanUntil(u),_)for(var O=0,k=_.length;O<k;++O)C=_.charAt(O),Vs(C)?(i.push(s.length),c+=C):(o=!0,t=!0,c+=" "),s.push(["text",C,y,y+1]),y+=1,C===`
`&&(h(),c="",l=0,t=!1);if(!p.scan(u))break;if(a=!0,m=p.scan(Qs)||"name",p.scan(Gs),m==="="?(_=p.scanUntil(Vn),p.scan(Vn),p.scanUntil(w)):m==="{"?(_=p.scanUntil(b),p.scan(Ks),p.scanUntil(w),m="&"):_=p.scanUntil(w),!p.scan(w))throw new Error("Unclosed tag at "+p.pos);if(m==">"?T=[m,_,y,p.pos,c,l,t]:T=[m,_,y,p.pos],l++,s.push(T),m==="#"||m==="^")r.push(T);else if(m==="/"){if(x=r.pop(),!x)throw new Error('Unopened section "'+_+'" at '+y);if(x[1]!==_)throw new Error('Unclosed section "'+x[1]+'" at '+y)}else m==="name"||m==="{"||m==="&"?o=!0:m==="="&&d(_)}if(h(),x=r.pop(),x)throw new Error('Unclosed section "'+x[1]+'" at '+p.pos);return ei(Zs(s))}function Zs(n){for(var e=[],t,r,s=0,i=n.length;s<i;++s)t=n[s],t&&(t[0]==="text"&&r&&r[0]==="text"?(r[1]+=t[1],r[3]=t[3]):(e.push(t),r=t));return e}function ei(n){for(var e=[],t=e,r=[],s,i,a=0,o=n.length;a<o;++a)switch(s=n[a],s[0]){case"#":case"^":t.push(s),r.push(s),t=s[4]=[];break;case"/":i=r.pop(),i[5]=s[2],t=r.length>0?r[r.length-1][4]:e;break;default:t.push(s)}return e}function Ue(n){this.string=n,this.tail=n,this.pos=0}Ue.prototype.eos=function(){return this.tail===""};Ue.prototype.scan=function(e){var t=this.tail.match(e);if(!t||t.index!==0)return"";var r=t[0];return this.tail=this.tail.substring(r.length),this.pos+=r.length,r};Ue.prototype.scanUntil=function(e){var t=this.tail.search(e),r;switch(t){case-1:r=this.tail,this.tail="";break;case 0:r="";break;default:r=this.tail.substring(0,t),this.tail=this.tail.substring(t)}return this.pos+=r.length,r};function be(n,e){this.view=n,this.cache={".":this.view},this.parent=e}be.prototype.push=function(e){return new be(e,this)};be.prototype.lookup=function(e){var t=this.cache,r;if(t.hasOwnProperty(e))r=t[e];else{for(var s=this,i,a,o,c=!1;s;){if(e.indexOf(".")>0)for(i=s.view,a=e.split("."),o=0;i!=null&&o<a.length;)o===a.length-1&&(c=Hn(i,a[o])||Ds(i,a[o])),i=i[a[o++]];else i=s.view[e],c=Hn(s.view,e);if(c){r=i;break}s=s.parent}t[e]=r}return Sn(r)&&(r=r.call(this.view)),r};function $(){this.templateCache={_cache:{},set:function(e,t){this._cache[e]=t},get:function(e){return this._cache[e]},clear:function(){this._cache={}}}}$.prototype.clearCache=function(){typeof this.templateCache<"u"&&this.templateCache.clear()};$.prototype.parse=function(e,t){var r=this.templateCache,s=e+":"+(t||W.tags).join(":"),i=typeof r<"u",a=i?r.get(s):void 0;return a==null&&(a=Ys(e,t),i&&r.set(s,a)),a};$.prototype.render=function(e,t,r,s){var i=this.getConfigTags(s),a=this.parse(e,i),o=t instanceof be?t:new be(t,void 0);return this.renderTokens(a,o,r,e,s)};$.prototype.renderTokens=function(e,t,r,s,i){for(var a="",o,c,l,h=0,u=e.length;h<u;++h)l=void 0,o=e[h],c=o[0],c==="#"?l=this.renderSection(o,t,r,s,i):c==="^"?l=this.renderInverted(o,t,r,s,i):c===">"?l=this.renderPartial(o,t,r,i):c==="&"?l=this.unescapedValue(o,t):c==="name"?l=this.escapedValue(o,t,i):c==="text"&&(l=this.rawValue(o)),l!==void 0&&(a+=l);return a};$.prototype.renderSection=function(e,t,r,s,i){var a=this,o="",c=t.lookup(e[1]);function l(w){return a.render(w,t,r,i)}if(c){if(Se(c))for(var h=0,u=c.length;h<u;++h)o+=this.renderTokens(e[4],t.push(c[h]),r,s,i);else if(typeof c=="object"||typeof c=="string"||typeof c=="number")o+=this.renderTokens(e[4],t.push(c),r,s,i);else if(Sn(c)){if(typeof s!="string")throw new Error("Cannot use higher-order sections without the original template");c=c.call(t.view,s.slice(e[3],e[5]),l),c!=null&&(o+=c)}else o+=this.renderTokens(e[4],t,r,s,i);return o}};$.prototype.renderInverted=function(e,t,r,s,i){var a=t.lookup(e[1]);if(!a||Se(a)&&a.length===0)return this.renderTokens(e[4],t,r,s,i)};$.prototype.indentPartial=function(e,t,r){for(var s=t.replace(/[^ \t]/g,""),i=e.split(`
`),a=0;a<i.length;a++)i[a].length&&(a>0||!r)&&(i[a]=s+i[a]);return i.join(`
`)};$.prototype.renderPartial=function(e,t,r,s){if(r){var i=this.getConfigTags(s),a=Sn(r)?r(e[1]):r[e[1]];if(a!=null){var o=e[6],c=e[5],l=e[4],h=a;c==0&&l&&(h=this.indentPartial(a,l,o));var u=this.parse(h,i);return this.renderTokens(u,t,r,h,s)}}};$.prototype.unescapedValue=function(e,t){var r=t.lookup(e[1]);if(r!=null)return r};$.prototype.escapedValue=function(e,t,r){var s=this.getConfigEscape(r)||W.escape,i=t.lookup(e[1]);if(i!=null)return typeof i=="number"&&s===W.escape?String(i):s(i)};$.prototype.rawValue=function(e){return e[1]};$.prototype.getConfigTags=function(e){return Se(e)?e:e&&typeof e=="object"?e.tags:void 0};$.prototype.getConfigEscape=function(e){if(e&&typeof e=="object"&&!Se(e))return e.escape};var W={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(n){Ne.templateCache=n},get templateCache(){return Ne.templateCache}},Ne=new $;W.clearCache=function(){return Ne.clearCache()};W.parse=function(e,t){return Ne.parse(e,t)};W.render=function(e,t,r,s){if(typeof e!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+js(e)+'" was given as the first argument for mustache#render(template, view, partials)');return Ne.render(e,t,r,s)};W.escape=Xs;W.Scanner=Ue;W.Context=be;W.Writer=$;class Mr{constructor(e,t){this.template=e,this.state=t,this.ast=W.parse(e)}getValue(){return this.value===void 0&&(this.value=W.render(this.template,this.state)),this.value}onChange(e){const t=[];for(const r of this.getUsedVariables().values())t.push(this.state.onVariableChange(r).subscribe(()=>{const s=W.render(this.template,this.state);s!==this.value&&(this.value=s,e(this.value))}));return{unsubscribe:()=>{for(const r of t)r.unsubscribe()}}}isPureString(){return this.ast.length===0||this.ast.length===1&&this.ast[0][0]==="text"}getUsedVariables(){const e=new Set;return this.recursiveGetUsedVariables(this.ast,e),e}recursiveGetUsedVariables(e,t){for(const r of e){const s=r[0],i=r[1],a=r[4];["name","&","#","^"].includes(s)&&t.add(i),a!==void 0&&typeof a!="string"&&this.recursiveGetUsedVariables(a,t)}}}async function ti(){var n;const e=await Or();for(const t of e){const r=(n=t.properties)!==null&&n!==void 0?n:[];for(const s of r){if(s.type==="int"||s.type==="bool"||s.type==="object"||typeof s.value!="string")continue;const i=new Mr(s.value,WA.state);if(i.isPureString())continue;const a=i.getValue();await Jn(t.name,s.name,a),i.onChange(async o=>{await Jn(t.name,s.name,o)})}}}async function ni(){var n;const e=await De();for(const[t,r]of e.entries())if(r.type!=="objectgroup"){const s=(n=r.properties)!==null&&n!==void 0?n:[];for(const i of s){if(i.type==="int"||i.type==="bool"||i.type==="object"||typeof i.value!="string")continue;const a=new Mr(i.value,WA.state);if(a.isPureString())continue;const o=a.getValue();Xn(t,i.name,o),a.onChange(c=>{Xn(t,i.name,c)})}}}async function Jn(n,e,t){console.log(n),(await WA.room.area.get(n)).setProperty(e,t)}function Xn(n,e,t){WA.room.setProperty(n,e,t),e==="visible"&&(t?WA.room.showLayer(n):WA.room.hideLayer(n))}const ri="https://admin.workadventu.re/html";let rn,An=0,Rn=0;function Gn(n){if(WA.state[n.name]){let e=n.properties.mustGetString("openLayer");for(const t of e.split(`
`))WA.room.showLayer(t);e=n.properties.mustGetString("closeLayer");for(const t of e.split(`
`))WA.room.hideLayer(t)}else{let e=n.properties.mustGetString("openLayer");for(const t of e.split(`
`))WA.room.hideLayer(t);e=n.properties.mustGetString("closeLayer");for(const t of e.split(`
`))WA.room.showLayer(t)}}function si(n){const e=n.properties.getString("openSound"),t=n.properties.getNumber("soundRadius");let r=1;if(t){const s=Ir(n.properties.mustGetString("openLayer").split(`
`));if(s>t)return;r=1-s/t}e&&WA.sound.loadSound(e).play({volume:r})}function ii(n){const e=n.properties.getString("closeSound"),t=n.properties.getNumber("soundRadius");let r=1;if(t){const s=Ir(n.properties.mustGetString("closeLayer").split(`
`));if(s>t)return;r=1-s/t}e&&WA.sound.loadSound(e).play({volume:r})}function Fr(n){return n.map(e=>rn.get(e)).filter(e=>(e==null?void 0:e.type)==="tilelayer")}function Ir(n){const e=Fr(n),t=kr(e),r=((t.right-t.left)/2+t.left)*32,s=((t.bottom-t.top)/2+t.top)*32;return Math.sqrt(Math.pow(An-r,2)+Math.pow(Rn-s,2))}function ai(n){WA.state.onVariableChange(n.name).subscribe(()=>{WA.state[n.name]?si(n):ii(n),Gn(n)}),Gn(n)}function zn(n,e,t,r){const s=n.name;let i,a,o=!1;const c=t.getString("tag");let l=!0;c&&!WA.player.tags.includes(c)&&(l=!1);const h=!!c;function u(){var m;i&&i.remove(),i=WA.ui.displayActionMessage({message:(m=t.getString("closeTriggerMessage"))!==null&&m!==void 0?m:"Press SPACE to close the door",callback:()=>{WA.state[e.name]=!1,w()}})}function w(){var m;i&&i.remove(),i=WA.ui.displayActionMessage({message:(m=t.getString("openTriggerMessage"))!==null&&m!==void 0?m:"Press SPACE to open the door",callback:()=>{WA.state[e.name]=!0,u()}})}function b(){let m;if(n.type==="tilelayer")m=kr(Fr(e.properties.mustGetString("closeLayer").split(`
`)));else{if(n.x===void 0||n.y===void 0||n.width===void 0||n.height===void 0)throw new Error(`Doorstep zone "${n.name}" is missing x, y, width or height`);m={top:n.y,left:n.x,right:n.x+n.width,bottom:n.y+n.height}}a=WA.room.website.create({name:"doorKeypad"+s,url:r+"/keypad.html#"+encodeURIComponent(s),position:{x:m.right*32,y:m.top*32,width:32*3,height:32*4},allowApi:!0})}function d(){a&&(WA.room.website.delete(a.name),a=void 0)}function p(){if(o=!0,t.getBoolean("autoOpen")&&l){WA.state[e.name]=!0;return}if(!WA.state[e.name]&&(h&&!l||!h)&&(t.getString("code")||t.getString("codeVariable"))){b();return}l&&(WA.state[e.name]?u():w())}function y(){o=!1,t.getBoolean("autoClose")&&(WA.state[e.name]=!1),i&&i.remove(),d()}n.type==="tilelayer"?(WA.room.onEnterLayer(s).subscribe(p),WA.room.onLeaveLayer(s).subscribe(y)):(WA.room.area.onEnter(s).subscribe(p),WA.room.area.onLeave(s).subscribe(y)),WA.state.onVariableChange(e.name).subscribe(()=>{o&&(!t.getBoolean("autoClose")&&WA.state[e.name]===!0&&u(),a&&WA.state[e.name]===!0&&d(),!t.getBoolean("autoOpen")&&WA.state[e.name]===!1&&w())})}function oi(n){const e=n.properties.mustGetString("bellSound"),t=n.properties.getNumber("soundRadius");let r=1;if(t){const s=Math.sqrt(Math.pow(n.x-An,2)+Math.pow(n.y-Rn,2));if(s>t)return;r=1-s/t}WA.sound.loadSound(e).play({volume:r})}function ci(n){WA.state[n.name]===void 0&&(WA.state[n.name]=0),WA.state.onVariableChange(n.name).subscribe(()=>{WA.state[n.name]&&oi(n)})}function Kn(n,e,t){let r;const s=e.getString("bellPopup");if(t.type==="tilelayer"){const i=t.name;WA.room.onEnterLayer(i).subscribe(()=>{var a;s?r=WA.ui.openPopup(s,"",[{label:(a=e.getString("bellButtonText"))!==null&&a!==void 0?a:"Ring",callback:()=>{WA.state[n]=WA.state[n]+1}}]):WA.state[n]=WA.state[n]+1}),WA.room.onLeaveLayer(i).subscribe(()=>{r&&(r.close(),r=void 0)})}else{const i=t.name;WA.room.area.onEnter(i).subscribe(()=>{var a;s?r=WA.ui.openPopup(s,"",[{label:(a=e.getString("bellButtonText"))!==null&&a!==void 0?a:"Ring",callback:()=>{WA.state[n]=WA.state[n]+1}}]):WA.state[n]=WA.state[n]+1}),WA.room.area.onLeave(i).subscribe(()=>{r&&(r.close(),r=void 0)})}}async function li(n){n=n??ri;const e=await Ls();rn=await De();for(const t of e.values())t.properties.get("door")&&ai(t),t.properties.get("bell")&&ci(t);for(const t of rn.values()){const r=new we(t.properties),s=r.getString("doorVariable");if(s&&t.type==="tilelayer"){const a=e.get(s);if(a===void 0)throw new Error('Cannot find variable "'+s+'" referred in the "doorVariable" property of layer "'+t.name+'"');zn(t,a,r,n)}const i=r.getString("bellVariable");i&&t.type==="tilelayer"&&Kn(i,r,t)}for(const t of await Or()){const r=new we(t.properties),s=r.getString("doorVariable");if(s){const a=e.get(s);if(a===void 0)throw new Error('Cannot find variable "'+s+'" referred in the "doorVariable" property of object "'+t.name+'"');zn(t,a,r,n)}const i=r.getString("bellVariable");i&&Kn(i,r,t)}WA.player.onPlayerMove(t=>{An=t.x,Rn=t.y})}function ui(n,e){const t=n.getString("bindVariable");if(t){const r=n.get("enterValue"),s=n.get("leaveValue"),i=n.getString("triggerMessage"),a=n.getString("tag");fi(t,e,r,s,i,a)}}function fi(n,e,t,r,s,i){i&&!WA.player.tags.includes(i)||(t!==void 0&&WA.room.onEnterLayer(e).subscribe(()=>{s||(WA.state[n]=t)}),r!==void 0&&WA.room.onLeaveLayer(e).subscribe(()=>{WA.state[n]=r}))}async function hi(){const n=await De();for(const e of n.values()){const t=new we(e.properties);ui(t,e.name)}}let Qn;async function di(n){const e=await WA.room.getTiledMap();n=n??xr,Qn=await De();const t=e.layers.find(r=>r.name==="configuration");if(t){const s=new we(t.properties).getString("tag");(!s||WA.player.tags.includes(s))&&WA.ui.registerMenuCommand("Configure the room",()=>{WA.nav.openCoWebSite(n+"/configuration.html",!0)});for(const i of Qn.values()){const a=new we(i.properties),o=a.getString("openConfig");o&&i.type==="tilelayer"&&pi(o.split(","),i.name,a)}}}function pi(n,e,t){let r;const s=t.getString("openConfigAdminTag");let i=!0;s&&!WA.player.tags.includes(s)&&(i=!1);function a(){var c;r&&r.remove(),r=WA.ui.displayActionMessage({message:(c=t.getString("openConfigTriggerMessage"))!==null&&c!==void 0?c:"Press SPACE or touch here to configure",callback:()=>qn(n)})}function o(){WA.nav.closeCoWebSite()}WA.room.onEnterLayer(e).subscribe(()=>{const c=t.getString("openConfigTrigger");i&&(c&&c==="onaction"?a():qn(n))}),WA.room.onLeaveLayer(e).subscribe(()=>{r&&r.remove(),o()})}function mi(){return WA.onInit().then(()=>{li().catch(n=>console.error(n)),hi().catch(n=>console.error(n)),di().catch(n=>console.error(n)),ni().catch(n=>console.error(n)),ti().catch(n=>console.error(n))}).catch(n=>console.error(n))}const fe="4.32.1";let Yn=!1,Ie,Lr,Nr,sn,Br,$r,Wr,jr,Dr;function gi(n,e={auto:!1}){if(Yn)throw new Error(`you must \`import 'openai/shims/${n.kind}'\` before importing anything else from openai`);if(Ie)throw new Error(`can't \`import 'openai/shims/${n.kind}'\` after \`import 'openai/shims/${Ie}'\``);Yn=e.auto,Ie=n.kind,Lr=n.fetch,n.Request,n.Response,n.Headers,Nr=n.FormData,n.Blob,sn=n.File,Br=n.ReadableStream,$r=n.getMultipartRequestOptions,Wr=n.getDefaultAgent,jr=n.fileFromPath,Dr=n.isFsReadStream}class yi{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}function wi({manuallyImported:n}={}){const e=n?"You may need to use polyfills":"Add one of these imports before your first `import … from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let t,r,s,i;try{t=fetch,r=Request,s=Response,i=Headers}catch(a){throw new Error(`this environment is missing the following Web Fetch API type: ${a.message}. ${e}`)}return{kind:"web",fetch:t,Request:r,Response:s,Headers:i,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(a,o)=>({...o,body:new yi(a)}),getDefaultAgent:a=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:a=>!1}}Ie||gi(wi(),{auto:!0});class R extends Error{}class L extends R{constructor(e,t,r,s){super(`${L.makeMessage(e,t,r)}`),this.status=e,this.headers=s;const i=t;this.error=i,this.code=i==null?void 0:i.code,this.param=i==null?void 0:i.param,this.type=i==null?void 0:i.type}static makeMessage(e,t,r){const s=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,r,s){if(!e)return new Bt({cause:on(t)});const i=t==null?void 0:t.error;return e===400?new Ur(e,i,r,s):e===401?new qr(e,i,r,s):e===403?new Hr(e,i,r,s):e===404?new Vr(e,i,r,s):e===409?new Jr(e,i,r,s):e===422?new Xr(e,i,r,s):e===429?new Gr(e,i,r,s):e>=500?new zr(e,i,r,s):new L(e,i,r,s)}}class U extends L{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0),this.status=void 0}}class Bt extends L{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),this.status=void 0,t&&(this.cause=t)}}class Cn extends Bt{constructor({message:e}={}){super({message:e??"Request timed out."})}}class Ur extends L{constructor(){super(...arguments),this.status=400}}class qr extends L{constructor(){super(...arguments),this.status=401}}class Hr extends L{constructor(){super(...arguments),this.status=403}}class Vr extends L{constructor(){super(...arguments),this.status=404}}class Jr extends L{constructor(){super(...arguments),this.status=409}}class Xr extends L{constructor(){super(...arguments),this.status=422}}class Gr extends L{constructor(){super(...arguments),this.status=429}}class zr extends L{}class Y{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let r=!1;const s=new bi;async function*i(){if(!e.body)throw t.abort(),new R("Attempted to iterate over a response with no body");const o=new ue,c=Zn(e.body);for await(const l of c)for(const h of o.decode(l)){const u=s.decode(h);u&&(yield u)}for(const l of o.flush()){const h=s.decode(l);h&&(yield h)}}async function*a(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let o=!1;try{for await(const c of i())if(!o){if(c.data.startsWith("[DONE]")){o=!0;continue}if(c.event===null){let l;try{l=JSON.parse(c.data)}catch(h){throw console.error("Could not parse message into JSON:",c.data),console.error("From chunk:",c.raw),h}if(l&&l.error)throw new L(void 0,l.error,void 0,void 0);yield l}else{let l;try{l=JSON.parse(c.data)}catch(h){throw console.error("Could not parse message into JSON:",c.data),console.error("From chunk:",c.raw),h}if(c.event=="error")throw new L(void 0,l.error,l.message,void 0);yield{event:c.event,data:l}}}o=!0}catch(c){if(c instanceof Error&&c.name==="AbortError")return;throw c}finally{o||t.abort()}}return new Y(a,t)}static fromReadableStream(e,t){let r=!1;async function*s(){const a=new ue,o=Zn(e);for await(const c of o)for(const l of a.decode(c))yield l;for(const c of a.flush())yield c}async function*i(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let a=!1;try{for await(const o of s())a||o&&(yield JSON.parse(o));a=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{a||t.abort()}}return new Y(i,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],r=this.iterator(),s=i=>({next:()=>{if(i.length===0){const a=r.next();e.push(a),t.push(a)}return i.shift()}});return[new Y(()=>s(e),this.controller),new Y(()=>s(t),this.controller)]}toReadableStream(){const e=this;let t;const r=new TextEncoder;return new Br({async start(){t=e[Symbol.asyncIterator]()},async pull(s){try{const{value:i,done:a}=await t.next();if(a)return s.close();const o=r.encode(JSON.stringify(i)+`
`);s.enqueue(o)}catch(i){s.error(i)}},async cancel(){var s;await((s=t.return)==null?void 0:s.call(t))}})}}class bi{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,s]=_i(e,":");return s.startsWith(" ")&&(s=s.substring(1)),t==="event"?this.event=s:t==="data"&&this.data.push(s),null}}class ue{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];const r=ue.NEWLINE_CHARS.has(t[t.length-1]||"");let s=t.split(ue.NEWLINE_REGEXP);return r&&s.pop(),s.length===1&&!r?(this.buffer.push(s[0]),[]):(this.buffer.length>0&&(s=[this.buffer.join("")+s[0],...s.slice(1)],this.buffer=[]),r||(this.buffer=[s.pop()||""]),s)}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new R(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new R(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new R("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}}ue.NEWLINE_CHARS=new Set([`
`,"\r","\v","\f","","","","","\u2028","\u2029"]);ue.NEWLINE_REGEXP=/\r\n|[\n\r\x0b\x0c\x1c\x1d\x1e\x85\u2028\u2029]/g;function _i(n,e){const t=n.indexOf(e);return t!==-1?[n.substring(0,t),e,n.substring(t+e.length)]:[n,"",""]}function Zn(n){if(n[Symbol.asyncIterator])return n;const e=n.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}const Kr=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function",Qr=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&Yr(n),Yr=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function",Si=n=>Qr(n)||Kr(n)||Dr(n);async function Zr(n,e,t){var s;if(n=await n,t??(t=Qr(n)?{lastModified:n.lastModified,type:n.type}:{}),Kr(n)){const i=await n.blob();return e||(e=new URL(n.url).pathname.split(/[\\/]/).pop()??"unknown_file"),new sn([i],e,t)}const r=await Ai(n);if(e||(e=Ci(n)??"unknown_file"),!t.type){const i=(s=r[0])==null?void 0:s.type;typeof i=="string"&&(t={...t,type:i})}return new sn(r,e,t)}async function Ai(n){var t;let e=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)e.push(n);else if(Yr(n))e.push(await n.arrayBuffer());else if(Ei(n))for await(const r of n)e.push(r);else throw new Error(`Unexpected data type: ${typeof n}; constructor: ${(t=n==null?void 0:n.constructor)==null?void 0:t.name}; props: ${Ri(n)}`);return e}function Ri(n){return`[${Object.getOwnPropertyNames(n).map(t=>`"${t}"`).join(", ")}]`}function Ci(n){var e;return Xt(n.name)||Xt(n.filename)||((e=Xt(n.path))==null?void 0:e.split(/[\\/]/).pop())}const Xt=n=>{if(typeof n=="string")return n;if(typeof Buffer<"u"&&n instanceof Buffer)return String(n)},Ei=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function",er=n=>n&&typeof n=="object"&&n.body&&n[Symbol.toStringTag]==="MultipartBody",Be=async n=>{const e=await Pi(n.body);return $r(e,n)},Pi=async n=>{const e=new Nr;return await Promise.all(Object.entries(n||{}).map(([t,r])=>an(e,t,r))),e},an=async(n,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")n.append(e,String(t));else if(Si(t)){const r=await Zr(t);n.append(e,r)}else if(Array.isArray(t))await Promise.all(t.map(r=>an(n,e+"[]",r)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([r,s])=>an(n,`${e}[${r}]`,s)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var xi=globalThis&&globalThis.__classPrivateFieldSet||function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},Ti=globalThis&&globalThis.__classPrivateFieldGet||function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},Ve;async function es(n){const{response:e}=n;if(n.options.stream)return me("response",e.status,e.url,e.headers,e.body),n.options.__streamClass?n.options.__streamClass.fromSSEResponse(e,n.controller):Y.fromSSEResponse(e,n.controller);if(e.status===204)return null;if(n.options.__binaryResponse)return e;const t=e.headers.get("content-type");if((t==null?void 0:t.includes("application/json"))||(t==null?void 0:t.includes("application/vnd.api+json"))){const i=await e.json();return me("response",e.status,e.url,e.headers,i),i}const s=await e.text();return me("response",e.status,e.url,e.headers,s),s}class $t extends Promise{constructor(e,t=es){super(r=>{r(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new $t(this.responsePromise,async t=>e(await this.parseResponse(t)))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class vi{constructor({baseURL:e,maxRetries:t=2,timeout:r=6e5,httpAgent:s,fetch:i}){this.baseURL=e,this.maxRetries=Gt("maxRetries",t),this.timeout=Gt("timeout",r),this.httpAgent=s,this.fetch=i??Lr}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...Li(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${Wi()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(s=>({method:e,path:t,...s})))}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}return null}buildRequest(e){var d;const{method:t,path:r,query:s,headers:i={}}=e,a=er(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,o=this.calculateContentLength(a),c=this.buildURL(r,s);"timeout"in e&&Gt("timeout",e.timeout);const l=e.timeout??this.timeout,h=e.httpAgent??this.httpAgent??Wr(c),u=l+1e3;typeof((d=h==null?void 0:h.options)==null?void 0:d.timeout)=="number"&&u>(h.options.timeout??0)&&(h.options.timeout=u),this.idempotencyHeader&&t!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),i[this.idempotencyHeader]=e.idempotencyKey);const w=this.buildHeaders({options:e,headers:i,contentLength:o});return{req:{method:t,...a&&{body:a},headers:w,...h&&{agent:h},signal:e.signal??null},url:c,timeout:l}}buildHeaders({options:e,headers:t,contentLength:r}){const s={};r&&(s["content-length"]=r);const i=this.defaultHeaders(e);return sr(s,i),sr(s,t),er(e.body)&&Ie!=="node"&&delete s["content-type"],this.validateHeaders(s,t),s}async prepareOptions(e){}async prepareRequest(e,{url:t,options:r}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,r,s){return L.generate(e,t,r,s)}request(e,t=null){return new $t(this.makeRequest(e,t))}async makeRequest(e,t){var h,u;const r=await e;t==null&&(t=r.maxRetries??this.maxRetries),await this.prepareOptions(r);const{req:s,url:i,timeout:a}=this.buildRequest(r);if(await this.prepareRequest(s,{url:i,options:r}),me("request",i,r,s.headers),(h=r.signal)!=null&&h.aborted)throw new U;const o=new AbortController,c=await this.fetchWithTimeout(i,s,a,o).catch(on);if(c instanceof Error){if((u=r.signal)!=null&&u.aborted)throw new U;if(t)return this.retryRequest(r,t);throw c.name==="AbortError"?new Cn:new Bt({cause:c})}const l=ki(c.headers);if(!c.ok){if(t&&this.shouldRetry(c)){const m=`retrying, ${t} attempts remaining`;return me(`response (error; ${m})`,c.status,i,l),this.retryRequest(r,t,l)}const w=await c.text().catch(m=>on(m).message),b=Ni(w),d=b?void 0:w;throw me(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,c.status,i,l,d),this.makeStatusError(c.status,b,d,l)}return{response:c,options:r,controller:o}}requestAPIList(e,t){const r=this.makeRequest(t,null);return new Oi(this,r,e)}buildURL(e,t){const r=$i(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return ns(s)||(t={...s,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,r])=>typeof r<"u").map(([t,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(t)}=`;throw new R(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,r,s){const{signal:i,...a}=t||{};i&&i.addEventListener("abort",()=>s.abort());const o=setTimeout(()=>s.abort(),r);return this.getRequestClient().fetch.call(void 0,e,{signal:s.signal,...a}).finally(()=>{clearTimeout(o)})}getRequestClient(){return{fetch:this.fetch}}shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,r){let s;const i=r==null?void 0:r["retry-after-ms"];if(i){const o=parseFloat(i);Number.isNaN(o)||(s=o)}const a=r==null?void 0:r["retry-after"];if(a&&!s){const o=parseFloat(a);Number.isNaN(o)?s=Date.parse(a)-Date.now():s=o*1e3}if(!(s&&0<=s&&s<60*1e3)){const o=e.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(t,o)}return await En(s),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const i=t-e,a=Math.min(.5*Math.pow(2,i),8),o=1-Math.random()*.25;return a*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${fe}`}}class ts{constructor(e,t,r,s){Ve.set(this,void 0),xi(this,Ve,e,"f"),this.options=s,this.response=t,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new R("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){const r=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[s,i]of r)e.url.searchParams.set(s,i);t.query=void 0,t.path=e.url.toString()}return await Ti(this,Ve,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(Ve=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class Oi extends $t{constructor(e,t,r){super(t,async s=>new r(e,s.response,await es(s),s.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}}const ki=n=>new Proxy(Object.fromEntries(n.entries()),{get(e,t){const r=t.toString();return e[r.toLowerCase()]||e[r]}}),Mi={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryResponse:!0,__streamClass:!0},ee=n=>typeof n=="object"&&n!==null&&!ns(n)&&Object.keys(n).every(e=>rs(Mi,e)),Fi=()=>{var e;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":fe,"X-Stainless-OS":nr(Deno.build.os),"X-Stainless-Arch":tr(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((e=Deno.version)==null?void 0:e.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":fe,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":fe,"X-Stainless-OS":nr(process.platform),"X-Stainless-Arch":tr(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const n=Ii();return n?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":fe,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${n.browser}`,"X-Stainless-Runtime-Version":n.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":fe,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function Ii(){if(typeof navigator>"u"||!navigator)return null;const n=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of n){const r=t.exec(navigator.userAgent);if(r){const s=r[1]||0,i=r[2]||0,a=r[3]||0;return{browser:e,version:`${s}.${i}.${a}`}}}return null}const tr=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?`other:${n}`:"unknown",nr=n=>(n=n.toLowerCase(),n.includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?`Other:${n}`:"Unknown");let rr;const Li=()=>rr??(rr=Fi()),Ni=n=>{try{return JSON.parse(n)}catch{return}},Bi=new RegExp("^(?:[a-z]+:)?//","i"),$i=n=>Bi.test(n),En=n=>new Promise(e=>setTimeout(e,n)),Gt=(n,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new R(`${n} must be an integer`);if(e<0)throw new R(`${n} must be a positive integer`);return e},on=n=>n instanceof Error?n:new Error(n),zt=n=>{var e,t,r,s,i;if(typeof process<"u")return((t=(e=process.env)==null?void 0:e[n])==null?void 0:t.trim())??void 0;if(typeof Deno<"u")return(i=(s=(r=Deno.env)==null?void 0:r.get)==null?void 0:s.call(r,n))==null?void 0:i.trim()};function ns(n){if(!n)return!0;for(const e in n)return!1;return!0}function rs(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function sr(n,e){for(const t in e){if(!rs(e,t))continue;const r=t.toLowerCase();if(!r)continue;const s=e[t];s===null?delete n[r]:s!==void 0&&(n[r]=s)}}function me(n,...e){var t;typeof process<"u"&&((t=process==null?void 0:process.env)==null?void 0:t.DEBUG)==="true"&&console.log(`OpenAI:DEBUG:${n}`,...e)}const Wi=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const e=Math.random()*16|0;return(n==="x"?e:e&3|8).toString(16)}),ji=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";function ir(n){return n!=null&&typeof n=="object"&&!Array.isArray(n)}class Pn extends ts{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data||[],this.object=r.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class ie extends ts{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data||[]}getPaginatedItems(){return this.data??[]}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){var r;const e=this.getPaginatedItems();if(!e.length)return null;const t=(r=e[e.length-1])==null?void 0:r.id;return t?{params:{after:t}}:null}}class E{constructor(e){this._client=e}}let ft=class extends E{create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}};ft||(ft={});let ht=class extends E{constructor(){super(...arguments),this.completions=new ft(this._client)}};(function(n){n.Completions=ft})(ht||(ht={}));class dt extends E{create(e,t){return this._client.post("/audio/speech",{body:e,...t,__binaryResponse:!0})}}dt||(dt={});class pt extends E{create(e,t){return this._client.post("/audio/transcriptions",Be({body:e,...t}))}}pt||(pt={});class mt extends E{create(e,t){return this._client.post("/audio/translations",Be({body:e,...t}))}}mt||(mt={});class gt extends E{constructor(){super(...arguments),this.transcriptions=new pt(this._client),this.translations=new mt(this._client),this.speech=new dt(this._client)}}(function(n){n.Transcriptions=pt,n.Translations=mt,n.Speech=dt})(gt||(gt={}));let yt=class extends E{create(e,t,r){return this._client.post(`/assistants/${e}/files`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v1",...r==null?void 0:r.headers}})}retrieve(e,t,r){return this._client.get(`/assistants/${e}/files/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v1",...r==null?void 0:r.headers}})}list(e,t={},r){return ee(t)?this.list(e,{},t):this._client.getAPIList(`/assistants/${e}/files`,xn,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v1",...r==null?void 0:r.headers}})}del(e,t,r){return this._client.delete(`/assistants/${e}/files/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v1",...r==null?void 0:r.headers}})}};class xn extends ie{}(function(n){n.AssistantFilesPage=xn})(yt||(yt={}));class wt extends E{constructor(){super(...arguments),this.files=new yt(this._client)}create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v1",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v1",...t==null?void 0:t.headers}})}update(e,t,r){return this._client.post(`/assistants/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v1",...r==null?void 0:r.headers}})}list(e={},t){return ee(e)?this.list({},e):this._client.getAPIList("/assistants",Tn,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v1",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v1",...t==null?void 0:t.headers}})}}class Tn extends ie{}(function(n){n.AssistantsPage=Tn,n.Files=yt,n.AssistantFilesPage=xn})(wt||(wt={}));function ar(n){return typeof n.parse=="function"}const ge=n=>(n==null?void 0:n.role)==="assistant",ss=n=>(n==null?void 0:n.role)==="function",is=n=>(n==null?void 0:n.role)==="tool";var V=globalThis&&globalThis.__classPrivateFieldSet||function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},S=globalThis&&globalThis.__classPrivateFieldGet||function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},B,Ge,ze,Ce,Ee,Ke,Pe,ne,xe,Qe,Ye,he,cn,bt,ln,un,fn,hn,as,dn;const or=10;class os{constructor(){B.add(this),this.controller=new AbortController,Ge.set(this,void 0),ze.set(this,()=>{}),Ce.set(this,()=>{}),Ee.set(this,void 0),Ke.set(this,()=>{}),Pe.set(this,()=>{}),ne.set(this,{}),this._chatCompletions=[],this.messages=[],xe.set(this,!1),Qe.set(this,!1),Ye.set(this,!1),he.set(this,!1),hn.set(this,e=>{if(V(this,Qe,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new U),e instanceof U)return V(this,Ye,!0,"f"),this._emit("abort",e);if(e instanceof R)return this._emit("error",e);if(e instanceof Error){const t=new R(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new R(String(e)))}),V(this,Ge,new Promise((e,t)=>{V(this,ze,e,"f"),V(this,Ce,t,"f")}),"f"),V(this,Ee,new Promise((e,t)=>{V(this,Ke,e,"f"),V(this,Pe,t,"f")}),"f"),S(this,Ge,"f").catch(()=>{}),S(this,Ee,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},S(this,hn,"f"))},0)}_addChatCompletion(e){var r;this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=(r=e.choices[0])==null?void 0:r.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),(ss(e)||is(e))&&e.content)this._emit("functionCallResult",e.content);else if(ge(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(ge(e)&&e.tool_calls)for(const r of e.tool_calls)r.type==="function"&&this._emit("functionCall",r.function)}}_connected(){this.ended||(S(this,ze,"f").call(this),this._emit("connect"))}get ended(){return S(this,xe,"f")}get errored(){return S(this,Qe,"f")}get aborted(){return S(this,Ye,"f")}abort(){this.controller.abort()}on(e,t){return(S(this,ne,"f")[e]||(S(this,ne,"f")[e]=[])).push({listener:t}),this}off(e,t){const r=S(this,ne,"f")[e];if(!r)return this;const s=r.findIndex(i=>i.listener===t);return s>=0&&r.splice(s,1),this}once(e,t){return(S(this,ne,"f")[e]||(S(this,ne,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{V(this,he,!0,"f"),e!=="error"&&this.once("error",r),this.once(e,t)})}async done(){V(this,he,!0,"f"),await S(this,Ee,"f")}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new R("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),S(this,B,"m",cn).call(this)}async finalMessage(){return await this.done(),S(this,B,"m",bt).call(this)}async finalFunctionCall(){return await this.done(),S(this,B,"m",ln).call(this)}async finalFunctionCallResult(){return await this.done(),S(this,B,"m",un).call(this)}async totalUsage(){return await this.done(),S(this,B,"m",fn).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emit(e,...t){if(S(this,xe,"f"))return;e==="end"&&(V(this,xe,!0,"f"),S(this,Ke,"f").call(this));const r=S(this,ne,"f")[e];if(r&&(S(this,ne,"f")[e]=r.filter(s=>!s.once),r.forEach(({listener:s})=>s(...t))),e==="abort"){const s=t[0];!S(this,he,"f")&&!(r!=null&&r.length)&&Promise.reject(s),S(this,Ce,"f").call(this,s),S(this,Pe,"f").call(this,s),this._emit("end");return}if(e==="error"){const s=t[0];!S(this,he,"f")&&!(r!=null&&r.length)&&Promise.reject(s),S(this,Ce,"f").call(this,s),S(this,Pe,"f").call(this,s),this._emit("end")}}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=S(this,B,"m",bt).call(this);t&&this._emit("finalMessage",t);const r=S(this,B,"m",cn).call(this);r&&this._emit("finalContent",r);const s=S(this,B,"m",ln).call(this);s&&this._emit("finalFunctionCall",s);const i=S(this,B,"m",un).call(this);i!=null&&this._emit("finalFunctionCallResult",i),this._chatCompletions.some(a=>a.usage)&&this._emit("totalUsage",S(this,B,"m",fn).call(this))}async _createChatCompletion(e,t,r){const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),S(this,B,"m",as).call(this,t);const i=await e.create({...t,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addChatCompletion(i)}async _runChatCompletion(e,t,r){for(const s of t.messages)this._addMessage(s,!1);return await this._createChatCompletion(e,t,r)}async _runFunctions(e,t,r){var w;const s="function",{function_call:i="auto",stream:a,...o}=t,c=typeof i!="string"&&(i==null?void 0:i.name),{maxChatCompletions:l=or}=r||{},h={};for(const b of t.functions)h[b.name||b.function.name]=b;const u=t.functions.map(b=>({name:b.name||b.function.name,parameters:b.parameters,description:b.description}));for(const b of t.messages)this._addMessage(b,!1);for(let b=0;b<l;++b){const p=(w=(await this._createChatCompletion(e,{...o,function_call:i,functions:u,messages:[...this.messages]},r)).choices[0])==null?void 0:w.message;if(!p)throw new R("missing message in ChatCompletion response");if(!p.function_call)return;const{name:y,arguments:m}=p.function_call,_=h[y];if(_){if(c&&c!==y){const O=`Invalid function_call: ${JSON.stringify(y)}. ${JSON.stringify(c)} requested. Please try again`;this._addMessage({role:s,name:y,content:O});continue}}else{const O=`Invalid function_call: ${JSON.stringify(y)}. Available options are: ${u.map(k=>JSON.stringify(k.name)).join(", ")}. Please try again`;this._addMessage({role:s,name:y,content:O});continue}let C;try{C=ar(_)?await _.parse(m):m}catch(O){this._addMessage({role:s,name:y,content:O instanceof Error?O.message:String(O)});continue}const T=await _.function(C,this),x=S(this,B,"m",dn).call(this,T);if(this._addMessage({role:s,name:y,content:x}),c)return}}async _runTools(e,t,r){var w,b;const s="tool",{tool_choice:i="auto",stream:a,...o}=t,c=typeof i!="string"&&((w=i==null?void 0:i.function)==null?void 0:w.name),{maxChatCompletions:l=or}=r||{},h={};for(const d of t.tools)d.type==="function"&&(h[d.function.name||d.function.function.name]=d.function);const u="tools"in t?t.tools.map(d=>d.type==="function"?{type:"function",function:{name:d.function.name||d.function.function.name,parameters:d.function.parameters,description:d.function.description}}:d):void 0;for(const d of t.messages)this._addMessage(d,!1);for(let d=0;d<l;++d){const y=(b=(await this._createChatCompletion(e,{...o,tool_choice:i,tools:u,messages:[...this.messages]},r)).choices[0])==null?void 0:b.message;if(!y)throw new R("missing message in ChatCompletion response");if(!y.tool_calls)return;for(const m of y.tool_calls){if(m.type!=="function")continue;const _=m.id,{name:C,arguments:T}=m.function,x=h[C];if(x){if(c&&c!==C){const F=`Invalid tool_call: ${JSON.stringify(C)}. ${JSON.stringify(c)} requested. Please try again`;this._addMessage({role:s,tool_call_id:_,content:F});continue}}else{const F=`Invalid tool_call: ${JSON.stringify(C)}. Available options are: ${u.map(Ht=>JSON.stringify(Ht.function.name)).join(", ")}. Please try again`;this._addMessage({role:s,tool_call_id:_,content:F});continue}let O;try{O=ar(x)?await x.parse(T):T}catch(F){const Ht=F instanceof Error?F.message:String(F);this._addMessage({role:s,tool_call_id:_,content:Ht});continue}const k=await x.function(O,this),N=S(this,B,"m",dn).call(this,k);if(this._addMessage({role:s,tool_call_id:_,content:N}),c)return}}}}Ge=new WeakMap,ze=new WeakMap,Ce=new WeakMap,Ee=new WeakMap,Ke=new WeakMap,Pe=new WeakMap,ne=new WeakMap,xe=new WeakMap,Qe=new WeakMap,Ye=new WeakMap,he=new WeakMap,hn=new WeakMap,B=new WeakSet,cn=function(){return S(this,B,"m",bt).call(this).content??null},bt=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(ge(t))return{...t,content:t.content??null}}throw new R("stream ended without producing a ChatCompletionMessage with role=assistant")},ln=function(){var e,t;for(let r=this.messages.length-1;r>=0;r--){const s=this.messages[r];if(ge(s)&&(s!=null&&s.function_call))return s.function_call;if(ge(s)&&((e=s==null?void 0:s.tool_calls)!=null&&e.length))return(t=s.tool_calls.at(-1))==null?void 0:t.function}},un=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(ss(t)&&t.content!=null||is(t)&&t.content!=null&&this.messages.some(r=>{var s;return r.role==="assistant"&&((s=r.tool_calls)==null?void 0:s.some(i=>i.type==="function"&&i.id===t.tool_call_id))}))return t.content}},fn=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},as=function(e){if(e.n!=null&&e.n>1)throw new R("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},dn=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};class $e extends os{static runFunctions(e,t,r){const s=new $e,i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,i)),s}static runTools(e,t,r){const s=new $e,i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,i)),s}_addMessage(e){super._addMessage(e),ge(e)&&e.content&&this._emit("content",e.content)}}var J=globalThis&&globalThis.__classPrivateFieldGet||function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},Kt=globalThis&&globalThis.__classPrivateFieldSet||function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},K,ae,Qt,Yt,Je,cr;class We extends os{constructor(){super(...arguments),K.add(this),ae.set(this,void 0)}get currentChatCompletionSnapshot(){return J(this,ae,"f")}static fromReadableStream(e){const t=new We;return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,r){const s=new We;return s._run(()=>s._runChatCompletion(e,{...t,stream:!0},{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createChatCompletion(e,t,r){var a;const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),J(this,K,"m",Qt).call(this);const i=await e.create({...t,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(const o of i)J(this,K,"m",Yt).call(this,o);if((a=i.controller.signal)!=null&&a.aborted)throw new U;return this._addChatCompletion(J(this,K,"m",Je).call(this))}async _fromReadableStream(e,t){var a;const r=t==null?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),J(this,K,"m",Qt).call(this),this._connected();const s=Y.fromReadableStream(e,this.controller);let i;for await(const o of s)i&&i!==o.id&&this._addChatCompletion(J(this,K,"m",Je).call(this)),J(this,K,"m",Yt).call(this,o),i=o.id;if((a=s.controller.signal)!=null&&a.aborted)throw new U;return this._addChatCompletion(J(this,K,"m",Je).call(this))}[(ae=new WeakMap,K=new WeakSet,Qt=function(){this.ended||Kt(this,ae,void 0,"f")},Yt=function(t){var a,o,c;if(this.ended)return;const r=J(this,K,"m",cr).call(this,t);this._emit("chunk",t,r);const s=(o=(a=t.choices[0])==null?void 0:a.delta)==null?void 0:o.content,i=(c=r.choices[0])==null?void 0:c.message;s!=null&&(i==null?void 0:i.role)==="assistant"&&(i!=null&&i.content)&&this._emit("content",s,i.content)},Je=function(){if(this.ended)throw new R("stream has ended, this shouldn't happen");const t=J(this,ae,"f");if(!t)throw new R("request ended without sending any chunks");return Kt(this,ae,void 0,"f"),Di(t)},cr=function(t){var r,s,i;let a=J(this,ae,"f");const{choices:o,...c}=t;a?Object.assign(a,c):a=Kt(this,ae,{...c,choices:[]},"f");for(const{delta:l,finish_reason:h,index:u,logprobs:w=null,...b}of t.choices){let d=a.choices[u];if(d||(d=a.choices[u]={finish_reason:h,index:u,message:{},logprobs:w,...b}),w)if(!d.logprobs)d.logprobs=Object.assign({},w);else{const{content:T,...x}=w;Object.assign(d.logprobs,x),T&&((r=d.logprobs).content??(r.content=[]),d.logprobs.content.push(...T))}if(h&&(d.finish_reason=h),Object.assign(d,b),!l)continue;const{content:p,function_call:y,role:m,tool_calls:_,...C}=l;if(Object.assign(d.message,C),p&&(d.message.content=(d.message.content||"")+p),m&&(d.message.role=m),y&&(d.message.function_call?(y.name&&(d.message.function_call.name=y.name),y.arguments&&((s=d.message.function_call).arguments??(s.arguments=""),d.message.function_call.arguments+=y.arguments)):d.message.function_call=y),_){d.message.tool_calls||(d.message.tool_calls=[]);for(const{index:T,id:x,type:O,function:k,...N}of _){const F=(i=d.message.tool_calls)[T]??(i[T]={});Object.assign(F,N),x&&(F.id=x),O&&(F.type=O),k&&(F.function??(F.function={arguments:""})),k!=null&&k.name&&(F.function.name=k.name),k!=null&&k.arguments&&(F.function.arguments+=k.arguments)}}}return a},Symbol.asyncIterator)](){const e=[],t=[];let r=!1;return this.on("chunk",s=>{const i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),this.on("error",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Y(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function Di(n){const{id:e,choices:t,created:r,model:s,system_fingerprint:i,...a}=n;return{...a,id:e,choices:t.map(({message:o,finish_reason:c,index:l,logprobs:h,...u})=>{if(!c)throw new R(`missing finish_reason for choice ${l}`);const{content:w=null,function_call:b,tool_calls:d,...p}=o,y=o.role;if(!y)throw new R(`missing role for choice ${l}`);if(b){const{arguments:m,name:_}=b;if(m==null)throw new R(`missing function_call.arguments for choice ${l}`);if(!_)throw new R(`missing function_call.name for choice ${l}`);return{...u,message:{content:w,function_call:{arguments:m,name:_},role:y},finish_reason:c,index:l,logprobs:h}}return d?{...u,index:l,finish_reason:c,logprobs:h,message:{...p,role:y,content:w,tool_calls:d.map((m,_)=>{const{function:C,type:T,id:x,...O}=m,{arguments:k,name:N,...F}=C||{};if(x==null)throw new R(`missing choices[${l}].tool_calls[${_}].id
${Xe(n)}`);if(T==null)throw new R(`missing choices[${l}].tool_calls[${_}].type
${Xe(n)}`);if(N==null)throw new R(`missing choices[${l}].tool_calls[${_}].function.name
${Xe(n)}`);if(k==null)throw new R(`missing choices[${l}].tool_calls[${_}].function.arguments
${Xe(n)}`);return{...O,id:x,type:T,function:{...F,name:N,arguments:k}}})}}:{...u,message:{...p,content:w,role:y},finish_reason:c,index:l,logprobs:h}}),created:r,model:s,object:"chat.completion",...i?{system_fingerprint:i}:{}}}function Xe(n){return JSON.stringify(n)}class ye extends We{static fromReadableStream(e){const t=new ye;return t._run(()=>t._fromReadableStream(e)),t}static runFunctions(e,t,r){const s=new ye,i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,i)),s}static runTools(e,t,r){const s=new ye,i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,i)),s}}let cs=class extends E{runFunctions(e,t){return e.stream?ye.runFunctions(this._client.chat.completions,e,t):$e.runFunctions(this._client.chat.completions,e,t)}runTools(e,t){return e.stream?ye.runTools(this._client.chat.completions,e,t):$e.runTools(this._client.chat.completions,e,t)}stream(e,t){return We.createChatCompletion(this._client.chat.completions,e,t)}};class _t extends E{constructor(){super(...arguments),this.completions=new cs(this._client)}}(function(n){n.Completions=cs})(_t||(_t={}));var X=globalThis&&globalThis.__classPrivateFieldSet||function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},P=globalThis&&globalThis.__classPrivateFieldGet||function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},Ze,et,Te,ve,tt,Oe,re,ke,nt,rt,de,pn;class Ui{constructor(){this.controller=new AbortController,Ze.set(this,void 0),et.set(this,()=>{}),Te.set(this,()=>{}),ve.set(this,void 0),tt.set(this,()=>{}),Oe.set(this,()=>{}),re.set(this,{}),ke.set(this,!1),nt.set(this,!1),rt.set(this,!1),de.set(this,!1),pn.set(this,e=>{if(X(this,nt,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new U),e instanceof U)return X(this,rt,!0,"f"),this._emit("abort",e);if(e instanceof R)return this._emit("error",e);if(e instanceof Error){const t=new R(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new R(String(e)))}),X(this,Ze,new Promise((e,t)=>{X(this,et,e,"f"),X(this,Te,t,"f")}),"f"),X(this,ve,new Promise((e,t)=>{X(this,tt,e,"f"),X(this,Oe,t,"f")}),"f"),P(this,Ze,"f").catch(()=>{}),P(this,ve,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emit("end")},P(this,pn,"f"))},0)}_addRun(e){return e}_connected(){this.ended||(P(this,et,"f").call(this),this._emit("connect"))}get ended(){return P(this,ke,"f")}get errored(){return P(this,nt,"f")}get aborted(){return P(this,rt,"f")}abort(){this.controller.abort()}on(e,t){return(P(this,re,"f")[e]||(P(this,re,"f")[e]=[])).push({listener:t}),this}off(e,t){const r=P(this,re,"f")[e];if(!r)return this;const s=r.findIndex(i=>i.listener===t);return s>=0&&r.splice(s,1),this}once(e,t){return(P(this,re,"f")[e]||(P(this,re,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{X(this,de,!0,"f"),e!=="error"&&this.once("error",r),this.once(e,t)})}async done(){X(this,de,!0,"f"),await P(this,ve,"f")}_emit(e,...t){if(P(this,ke,"f"))return;e==="end"&&(X(this,ke,!0,"f"),P(this,tt,"f").call(this));const r=P(this,re,"f")[e];if(r&&(P(this,re,"f")[e]=r.filter(s=>!s.once),r.forEach(({listener:s})=>s(...t))),e==="abort"){const s=t[0];!P(this,de,"f")&&!(r!=null&&r.length)&&Promise.reject(s),P(this,Te,"f").call(this,s),P(this,Oe,"f").call(this,s),this._emit("end");return}if(e==="error"){const s=t[0];!P(this,de,"f")&&!(r!=null&&r.length)&&Promise.reject(s),P(this,Te,"f").call(this,s),P(this,Oe,"f").call(this,s),this._emit("end")}}async _threadAssistantStream(e,t,r){return await this._createThreadAssistantStream(t,e,r)}async _runAssistantStream(e,t,r,s){return await this._createAssistantStream(t,e,r,s)}async _runToolAssistantStream(e,t,r,s,i){return await this._createToolAssistantStream(r,e,t,s,i)}async _createThreadAssistantStream(e,t,r){const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));const i=await e.createAndRun({...t,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addRun(i)}async _createToolAssistantStream(e,t,r,s,i){const a=i==null?void 0:i.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const o=await e.submitToolOutputs(t,r,{...s,stream:!1},{...i,signal:this.controller.signal});return this._connected(),this._addRun(o)}async _createAssistantStream(e,t,r,s){const i=s==null?void 0:s.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const a=await e.create(t,{...r,stream:!1},{...s,signal:this.controller.signal});return this._connected(),this._addRun(a)}}Ze=new WeakMap,et=new WeakMap,Te=new WeakMap,ve=new WeakMap,tt=new WeakMap,Oe=new WeakMap,re=new WeakMap,ke=new WeakMap,nt=new WeakMap,rt=new WeakMap,de=new WeakMap,pn=new WeakMap;var g=globalThis&&globalThis.__classPrivateFieldGet||function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},j=globalThis&&globalThis.__classPrivateFieldSet||function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},I,mn,Q,st,G,le,pe,ce,St,D,it,at,Le,Me,Fe,lr,ur,fr,hr,dr,pr,mr;class z extends Ui{constructor(){super(...arguments),I.add(this),mn.set(this,[]),Q.set(this,{}),st.set(this,{}),G.set(this,void 0),le.set(this,void 0),pe.set(this,void 0),ce.set(this,void 0),St.set(this,void 0),D.set(this,void 0),it.set(this,void 0),at.set(this,void 0),Le.set(this,void 0)}[(mn=new WeakMap,Q=new WeakMap,st=new WeakMap,G=new WeakMap,le=new WeakMap,pe=new WeakMap,ce=new WeakMap,St=new WeakMap,D=new WeakMap,it=new WeakMap,at=new WeakMap,Le=new WeakMap,I=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let r=!1;return this.on("event",s=>{const i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),this.on("error",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new z;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){var i;const r=t==null?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),this._connected();const s=Y.fromReadableStream(e,this.controller);for await(const a of s)g(this,I,"m",Me).call(this,a);if((i=s.controller.signal)!=null&&i.aborted)throw new U;return this._addRun(g(this,I,"m",Fe).call(this))}toReadableStream(){return new Y(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,r,s,i){const a=new z;return a._run(()=>a._runToolAssistantStream(e,t,r,s,{...i,headers:{...i==null?void 0:i.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createToolAssistantStream(e,t,r,s,i){var l;const a=i==null?void 0:i.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const o={...s,stream:!0},c=await e.submitToolOutputs(t,r,o,{...i,signal:this.controller.signal});this._connected();for await(const h of c)g(this,I,"m",Me).call(this,h);if((l=c.controller.signal)!=null&&l.aborted)throw new U;return this._addRun(g(this,I,"m",Fe).call(this))}static createThreadAssistantStream(e,t,r){const s=new z;return s._run(()=>s._threadAssistantStream(e,t,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}static createAssistantStream(e,t,r,s){const i=new z;return i._run(()=>i._runAssistantStream(e,t,r,{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),i}currentEvent(){return g(this,it,"f")}currentRun(){return g(this,at,"f")}currentMessageSnapshot(){return g(this,G,"f")}currentRunStepSnapshot(){return g(this,Le,"f")}async finalRunSteps(){return await this.done(),Object.values(g(this,Q,"f"))}async finalMessages(){return await this.done(),Object.values(g(this,st,"f"))}async finalRun(){if(await this.done(),!g(this,le,"f"))throw Error("Final run was not received.");return g(this,le,"f")}async _createThreadAssistantStream(e,t,r){var o;const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));const i={...t,stream:!0},a=await e.createAndRun(i,{...r,signal:this.controller.signal});this._connected();for await(const c of a)g(this,I,"m",Me).call(this,c);if((o=a.controller.signal)!=null&&o.aborted)throw new U;return this._addRun(g(this,I,"m",Fe).call(this))}async _createAssistantStream(e,t,r,s){var c;const i=s==null?void 0:s.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const a={...r,stream:!0},o=await e.create(t,a,{...s,signal:this.controller.signal});this._connected();for await(const l of o)g(this,I,"m",Me).call(this,l);if((c=o.controller.signal)!=null&&c.aborted)throw new U;return this._addRun(g(this,I,"m",Fe).call(this))}static accumulateDelta(e,t){for(const[r,s]of Object.entries(t)){if(!e.hasOwnProperty(r)){e[r]=s;continue}let i=e[r];if(i==null){e[r]=s;continue}if(r==="index"||r==="type"){e[r]=s;continue}if(typeof i=="string"&&typeof s=="string")i+=s;else if(typeof i=="number"&&typeof s=="number")i+=s;else if(ir(i)&&ir(s))i=this.accumulateDelta(i,s);else if(Array.isArray(i)&&Array.isArray(s)){if(i.every(a=>typeof a=="string"||typeof a=="number")){i.push(...s);continue}}else throw Error(`Unhandled record type: ${r}, deltaValue: ${s}, accValue: ${i}`);e[r]=i}return e}}Me=function(e){if(!this.ended)switch(j(this,it,e,"f"),g(this,I,"m",fr).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":g(this,I,"m",mr).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":g(this,I,"m",ur).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":g(this,I,"m",lr).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},Fe=function(){if(this.ended)throw new R("stream has ended, this shouldn't happen");if(!g(this,le,"f"))throw Error("Final run has not been received");return g(this,le,"f")},lr=function(e){const[t,r]=g(this,I,"m",dr).call(this,e,g(this,G,"f"));j(this,G,t,"f"),g(this,st,"f")[t.id]=t;for(const s of r){const i=t.content[s.index];(i==null?void 0:i.type)=="text"&&this._emit("textCreated",i.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const s of e.data.delta.content){if(s.type=="text"&&s.text){let i=s.text,a=t.content[s.index];if(a&&a.type=="text")this._emit("textDelta",i,a.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=g(this,pe,"f")){if(g(this,ce,"f"))switch(g(this,ce,"f").type){case"text":this._emit("textDone",g(this,ce,"f").text,g(this,G,"f"));break;case"image_file":this._emit("imageFileDone",g(this,ce,"f").image_file,g(this,G,"f"));break}j(this,pe,s.index,"f")}j(this,ce,t.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(g(this,pe,"f")!==void 0){const s=e.data.content[g(this,pe,"f")];if(s)switch(s.type){case"image_file":this._emit("imageFileDone",s.image_file,g(this,G,"f"));break;case"text":this._emit("textDone",s.text,g(this,G,"f"));break}}g(this,G,"f")&&this._emit("messageDone",e.data),j(this,G,void 0,"f")}},ur=function(e){const t=g(this,I,"m",hr).call(this,e);switch(j(this,Le,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const r=e.data.delta;if(r.step_details&&r.step_details.type=="tool_calls"&&r.step_details.tool_calls&&t.step_details.type=="tool_calls")for(const i of r.step_details.tool_calls)i.index==g(this,St,"f")?this._emit("toolCallDelta",i,t.step_details.tool_calls[i.index]):(g(this,D,"f")&&this._emit("toolCallDone",g(this,D,"f")),j(this,St,i.index,"f"),j(this,D,t.step_details.tool_calls[i.index],"f"),g(this,D,"f")&&this._emit("toolCallCreated",g(this,D,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":j(this,Le,void 0,"f"),e.data.step_details.type=="tool_calls"&&g(this,D,"f")&&(this._emit("toolCallDone",g(this,D,"f")),j(this,D,void 0,"f")),this._emit("runStepDone",e.data,t);break}},fr=function(e){g(this,mn,"f").push(e),this._emit("event",e)},hr=function(e){switch(e.event){case"thread.run.step.created":return g(this,Q,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=g(this,Q,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let r=e.data;if(r.delta){const s=z.accumulateDelta(t,r.delta);g(this,Q,"f")[e.data.id]=s}return g(this,Q,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":g(this,Q,"f")[e.data.id]=e.data;break}if(g(this,Q,"f")[e.data.id])return g(this,Q,"f")[e.data.id];throw new Error("No snapshot available")},dr=function(e,t){let r=[];switch(e.event){case"thread.message.created":return[e.data,r];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let s=e.data;if(s.delta.content)for(const i of s.delta.content)if(i.index in t.content){let a=t.content[i.index];t.content[i.index]=g(this,I,"m",pr).call(this,i,a)}else t.content[i.index]=i,r.push(i);return[t,r];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,r];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},pr=function(e,t){return z.accumulateDelta(t,e)},mr=function(e){switch(j(this,at,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":j(this,le,e.data,"f"),g(this,D,"f")&&(this._emit("toolCallDone",g(this,D,"f")),j(this,D,void 0,"f"));break}};let At=class extends E{retrieve(e,t,r,s){return this._client.get(`/threads/${e}/messages/${t}/files/${r}`,{...s,headers:{"OpenAI-Beta":"assistants=v1",...s==null?void 0:s.headers}})}list(e,t,r={},s){return ee(r)?this.list(e,t,{},r):this._client.getAPIList(`/threads/${e}/messages/${t}/files`,vn,{query:r,...s,headers:{"OpenAI-Beta":"assistants=v1",...s==null?void 0:s.headers}})}};class vn extends ie{}(function(n){n.MessageFilesPage=vn})(At||(At={}));class Rt extends E{constructor(){super(...arguments),this.files=new At(this._client)}create(e,t,r){return this._client.post(`/threads/${e}/messages`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v1",...r==null?void 0:r.headers}})}retrieve(e,t,r){return this._client.get(`/threads/${e}/messages/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v1",...r==null?void 0:r.headers}})}update(e,t,r,s){return this._client.post(`/threads/${e}/messages/${t}`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v1",...s==null?void 0:s.headers}})}list(e,t={},r){return ee(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,On,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v1",...r==null?void 0:r.headers}})}}class On extends ie{}(function(n){n.MessagesPage=On,n.Files=At,n.MessageFilesPage=vn})(Rt||(Rt={}));class Ct extends E{retrieve(e,t,r,s){return this._client.get(`/threads/${e}/runs/${t}/steps/${r}`,{...s,headers:{"OpenAI-Beta":"assistants=v1",...s==null?void 0:s.headers}})}list(e,t,r={},s){return ee(r)?this.list(e,t,{},r):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,kn,{query:r,...s,headers:{"OpenAI-Beta":"assistants=v1",...s==null?void 0:s.headers}})}}class kn extends ie{}(function(n){n.RunStepsPage=kn})(Ct||(Ct={}));class Et extends E{constructor(){super(...arguments),this.steps=new Ct(this._client)}create(e,t,r){return this._client.post(`/threads/${e}/runs`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v1",...r==null?void 0:r.headers},stream:t.stream??!1})}retrieve(e,t,r){return this._client.get(`/threads/${e}/runs/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v1",...r==null?void 0:r.headers}})}update(e,t,r,s){return this._client.post(`/threads/${e}/runs/${t}`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v1",...s==null?void 0:s.headers}})}list(e,t={},r){return ee(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,Mn,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v1",...r==null?void 0:r.headers}})}cancel(e,t,r){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v1",...r==null?void 0:r.headers}})}async createAndPoll(e,t,r){const s=await this.create(e,t,r);return await this.poll(e,s.id,r)}createAndStream(e,t,r){return z.createAssistantStream(e,this._client.beta.threads.runs,t,r)}async poll(e,t,r){const s={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const{data:i,response:a}=await this.retrieve(e,t,{...r,headers:{...r==null?void 0:r.headers,...s}}).withResponse();switch(i.status){case"queued":case"in_progress":case"cancelling":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{const c=a.headers.get("openai-poll-after-ms");if(c){const l=parseInt(c);isNaN(l)||(o=l)}}await En(o);break;case"requires_action":case"cancelled":case"completed":case"failed":case"expired":return i}}}stream(e,t,r){return z.createAssistantStream(e,this._client.beta.threads.runs,t,r)}submitToolOutputs(e,t,r,s){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v1",...s==null?void 0:s.headers},stream:r.stream??!1})}async submitToolOutputsAndPoll(e,t,r,s){const i=await this.submitToolOutputs(e,t,r,s);return await this.poll(e,i.id,s)}submitToolOutputsStream(e,t,r,s){return z.createToolAssistantStream(e,t,this._client.beta.threads.runs,r,s)}}class Mn extends ie{}(function(n){n.RunsPage=Mn,n.Steps=Ct,n.RunStepsPage=kn})(Et||(Et={}));class Pt extends E{constructor(){super(...arguments),this.runs=new Et(this._client),this.messages=new Rt(this._client)}create(e={},t){return ee(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v1",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v1",...t==null?void 0:t.headers}})}update(e,t,r){return this._client.post(`/threads/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v1",...r==null?void 0:r.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v1",...t==null?void 0:t.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v1",...t==null?void 0:t.headers},stream:e.stream??!1})}async createAndRunPoll(e,t){const r=await this.createAndRun(e,t);return await this.runs.poll(r.thread_id,r.id,t)}createAndRunStream(e,t){return z.createThreadAssistantStream(e,this._client.beta.threads,t)}}(function(n){n.Runs=Et,n.RunsPage=Mn,n.Messages=Rt,n.MessagesPage=On})(Pt||(Pt={}));class xt extends E{constructor(){super(...arguments),this.chat=new _t(this._client),this.assistants=new wt(this._client),this.threads=new Pt(this._client)}}(function(n){n.Chat=_t,n.Assistants=wt,n.AssistantsPage=Tn,n.Threads=Pt})(xt||(xt={}));class Tt extends E{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}Tt||(Tt={});class vt extends E{create(e,t){return this._client.post("/embeddings",{body:e,...t})}}vt||(vt={});class Ot extends E{create(e,t){return this._client.post("/files",Be({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return ee(e)?this.list({},e):this._client.getAPIList("/files",Fn,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/json",...t==null?void 0:t.headers}})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:r=30*60*1e3}={}){const s=new Set(["processed","error","deleted"]),i=Date.now();let a=await this.retrieve(e);for(;!a.status||!s.has(a.status);)if(await En(t),a=await this.retrieve(e),Date.now()-i>r)throw new Cn({message:`Giving up on waiting for file ${e} to finish processing after ${r} milliseconds.`});return a}}class Fn extends Pn{}(function(n){n.FileObjectsPage=Fn})(Ot||(Ot={}));class kt extends E{create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return ee(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",In,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},r){return ee(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,Ln,{query:t,...r})}}class In extends ie{}class Ln extends ie{}(function(n){n.FineTuningJobsPage=In,n.FineTuningJobEventsPage=Ln})(kt||(kt={}));class Mt extends E{constructor(){super(...arguments),this.jobs=new kt(this._client)}}(function(n){n.Jobs=kt,n.FineTuningJobsPage=In,n.FineTuningJobEventsPage=Ln})(Mt||(Mt={}));class Ft extends E{createVariation(e,t){return this._client.post("/images/variations",Be({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",Be({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}Ft||(Ft={});class It extends E{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",Nn,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}}class Nn extends Pn{}(function(n){n.ModelsPage=Nn})(It||(It={}));class Lt extends E{create(e,t){return this._client.post("/moderations",{body:e,...t})}}Lt||(Lt={});var ls;class M extends vi{constructor({baseURL:e=zt("OPENAI_BASE_URL"),apiKey:t=zt("OPENAI_API_KEY"),organization:r=zt("OPENAI_ORG_ID")??null,...s}={}){if(t===void 0)throw new R("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const i={apiKey:t,organization:r,...s,baseURL:e||"https://api.openai.com/v1"};if(!i.dangerouslyAllowBrowser&&ji())throw new R(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:i.baseURL,timeout:i.timeout??6e5,httpAgent:i.httpAgent,maxRetries:i.maxRetries,fetch:i.fetch}),this.completions=new Tt(this),this.chat=new ht(this),this.embeddings=new vt(this),this.files=new Ot(this),this.images=new Ft(this),this.audio=new gt(this),this.moderations=new Lt(this),this.models=new It(this),this.fineTuning=new Mt(this),this.beta=new xt(this),this._options=i,this.apiKey=t,this.organization=r}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}}ls=M;M.OpenAI=ls;M.OpenAIError=R;M.APIError=L;M.APIConnectionError=Bt;M.APIConnectionTimeoutError=Cn;M.APIUserAbortError=U;M.NotFoundError=Vr;M.ConflictError=Jr;M.RateLimitError=Gr;M.BadRequestError=Ur;M.AuthenticationError=qr;M.InternalServerError=zr;M.PermissionDeniedError=Hr;M.UnprocessableEntityError=Xr;(function(n){n.toFile=Zr,n.fileFromPath=jr,n.Page=Pn,n.CursorPage=ie,n.Completions=Tt,n.Chat=ht,n.Embeddings=vt,n.Files=Ot,n.FileObjectsPage=Fn,n.Images=Ft,n.Audio=gt,n.Moderations=Lt,n.Models=It,n.ModelsPage=Nn,n.FineTuning=Mt,n.Beta=xt})(M||(M={}));const qi=M;class us{constructor(e,t){H(this,"author");H(this,"content");this.author=e,this.content=t}toString(){return this.author+":"+this.content}}function fs(n,e){return function(){return n.apply(e,arguments)}}const{toString:Hi}=Object.prototype,{getPrototypeOf:Bn}=Object,Wt=(n=>e=>{const t=Hi.call(e);return n[t]||(n[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),te=n=>(n=n.toLowerCase(),e=>Wt(e)===n),jt=n=>e=>typeof e===n,{isArray:Ae}=Array,je=jt("undefined");function Vi(n){return n!==null&&!je(n)&&n.constructor!==null&&!je(n.constructor)&&q(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const hs=te("ArrayBuffer");function Ji(n){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(n):e=n&&n.buffer&&hs(n.buffer),e}const Xi=jt("string"),q=jt("function"),ds=jt("number"),Dt=n=>n!==null&&typeof n=="object",Gi=n=>n===!0||n===!1,ot=n=>{if(Wt(n)!=="object")return!1;const e=Bn(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},zi=te("Date"),Ki=te("File"),Qi=te("Blob"),Yi=te("FileList"),Zi=n=>Dt(n)&&q(n.pipe),ea=n=>{let e;return n&&(typeof FormData=="function"&&n instanceof FormData||q(n.append)&&((e=Wt(n))==="formdata"||e==="object"&&q(n.toString)&&n.toString()==="[object FormData]"))},ta=te("URLSearchParams"),na=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function qe(n,e,{allOwnKeys:t=!1}={}){if(n===null||typeof n>"u")return;let r,s;if(typeof n!="object"&&(n=[n]),Ae(n))for(r=0,s=n.length;r<s;r++)e.call(null,n[r],r,n);else{const i=t?Object.getOwnPropertyNames(n):Object.keys(n),a=i.length;let o;for(r=0;r<a;r++)o=i[r],e.call(null,n[o],o,n)}}function ps(n,e){e=e.toLowerCase();const t=Object.keys(n);let r=t.length,s;for(;r-- >0;)if(s=t[r],e===s.toLowerCase())return s;return null}const ms=(()=>typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global)(),gs=n=>!je(n)&&n!==ms;function gn(){const{caseless:n}=gs(this)&&this||{},e={},t=(r,s)=>{const i=n&&ps(e,s)||s;ot(e[i])&&ot(r)?e[i]=gn(e[i],r):ot(r)?e[i]=gn({},r):Ae(r)?e[i]=r.slice():e[i]=r};for(let r=0,s=arguments.length;r<s;r++)arguments[r]&&qe(arguments[r],t);return e}const ra=(n,e,t,{allOwnKeys:r}={})=>(qe(e,(s,i)=>{t&&q(s)?n[i]=fs(s,t):n[i]=s},{allOwnKeys:r}),n),sa=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),ia=(n,e,t,r)=>{n.prototype=Object.create(e.prototype,r),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:e.prototype}),t&&Object.assign(n.prototype,t)},aa=(n,e,t,r)=>{let s,i,a;const o={};if(e=e||{},n==null)return e;do{for(s=Object.getOwnPropertyNames(n),i=s.length;i-- >0;)a=s[i],(!r||r(a,n,e))&&!o[a]&&(e[a]=n[a],o[a]=!0);n=t!==!1&&Bn(n)}while(n&&(!t||t(n,e))&&n!==Object.prototype);return e},oa=(n,e,t)=>{n=String(n),(t===void 0||t>n.length)&&(t=n.length),t-=e.length;const r=n.indexOf(e,t);return r!==-1&&r===t},ca=n=>{if(!n)return null;if(Ae(n))return n;let e=n.length;if(!ds(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=n[e];return t},la=(n=>e=>n&&e instanceof n)(typeof Uint8Array<"u"&&Bn(Uint8Array)),ua=(n,e)=>{const r=(n&&n[Symbol.iterator]).call(n);let s;for(;(s=r.next())&&!s.done;){const i=s.value;e.call(n,i[0],i[1])}},fa=(n,e)=>{let t;const r=[];for(;(t=n.exec(e))!==null;)r.push(t);return r},ha=te("HTMLFormElement"),da=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,r,s){return r.toUpperCase()+s}),gr=(({hasOwnProperty:n})=>(e,t)=>n.call(e,t))(Object.prototype),pa=te("RegExp"),ys=(n,e)=>{const t=Object.getOwnPropertyDescriptors(n),r={};qe(t,(s,i)=>{let a;(a=e(s,i,n))!==!1&&(r[i]=a||s)}),Object.defineProperties(n,r)},ma=n=>{ys(n,(e,t)=>{if(q(n)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const r=n[t];if(q(r)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},ga=(n,e)=>{const t={},r=s=>{s.forEach(i=>{t[i]=!0})};return Ae(n)?r(n):r(String(n).split(e)),t},ya=()=>{},wa=(n,e)=>(n=+n,Number.isFinite(n)?n:e),Zt="abcdefghijklmnopqrstuvwxyz",yr="0123456789",ws={DIGIT:yr,ALPHA:Zt,ALPHA_DIGIT:Zt+Zt.toUpperCase()+yr},ba=(n=16,e=ws.ALPHA_DIGIT)=>{let t="";const{length:r}=e;for(;n--;)t+=e[Math.random()*r|0];return t};function _a(n){return!!(n&&q(n.append)&&n[Symbol.toStringTag]==="FormData"&&n[Symbol.iterator])}const Sa=n=>{const e=new Array(10),t=(r,s)=>{if(Dt(r)){if(e.indexOf(r)>=0)return;if(!("toJSON"in r)){e[s]=r;const i=Ae(r)?[]:{};return qe(r,(a,o)=>{const c=t(a,s+1);!je(c)&&(i[o]=c)}),e[s]=void 0,i}}return r};return t(n,0)},Aa=te("AsyncFunction"),Ra=n=>n&&(Dt(n)||q(n))&&q(n.then)&&q(n.catch),f={isArray:Ae,isArrayBuffer:hs,isBuffer:Vi,isFormData:ea,isArrayBufferView:Ji,isString:Xi,isNumber:ds,isBoolean:Gi,isObject:Dt,isPlainObject:ot,isUndefined:je,isDate:zi,isFile:Ki,isBlob:Qi,isRegExp:pa,isFunction:q,isStream:Zi,isURLSearchParams:ta,isTypedArray:la,isFileList:Yi,forEach:qe,merge:gn,extend:ra,trim:na,stripBOM:sa,inherits:ia,toFlatObject:aa,kindOf:Wt,kindOfTest:te,endsWith:oa,toArray:ca,forEachEntry:ua,matchAll:fa,isHTMLForm:ha,hasOwnProperty:gr,hasOwnProp:gr,reduceDescriptors:ys,freezeMethods:ma,toObjectSet:ga,toCamelCase:da,noop:ya,toFiniteNumber:wa,findKey:ps,global:ms,isContextDefined:gs,ALPHABET:ws,generateString:ba,isSpecCompliantForm:_a,toJSONObject:Sa,isAsyncFn:Aa,isThenable:Ra};function A(n,e,t,r,s){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),r&&(this.request=r),s&&(this.response=s)}f.inherits(A,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:f.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const bs=A.prototype,_s={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{_s[n]={value:n}});Object.defineProperties(A,_s);Object.defineProperty(bs,"isAxiosError",{value:!0});A.from=(n,e,t,r,s,i)=>{const a=Object.create(bs);return f.toFlatObject(n,a,function(c){return c!==Error.prototype},o=>o!=="isAxiosError"),A.call(a,n.message,e,t,r,s),a.cause=n,a.name=n.name,i&&Object.assign(a,i),a};const Ca=null;function yn(n){return f.isPlainObject(n)||f.isArray(n)}function Ss(n){return f.endsWith(n,"[]")?n.slice(0,-2):n}function wr(n,e,t){return n?n.concat(e).map(function(s,i){return s=Ss(s),!t&&i?"["+s+"]":s}).join(t?".":""):e}function Ea(n){return f.isArray(n)&&!n.some(yn)}const Pa=f.toFlatObject(f,{},null,function(e){return/^is[A-Z]/.test(e)});function Ut(n,e,t){if(!f.isObject(n))throw new TypeError("target must be an object");e=e||new FormData,t=f.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(p,y){return!f.isUndefined(y[p])});const r=t.metaTokens,s=t.visitor||h,i=t.dots,a=t.indexes,c=(t.Blob||typeof Blob<"u"&&Blob)&&f.isSpecCompliantForm(e);if(!f.isFunction(s))throw new TypeError("visitor must be a function");function l(d){if(d===null)return"";if(f.isDate(d))return d.toISOString();if(!c&&f.isBlob(d))throw new A("Blob is not supported. Use a Buffer instead.");return f.isArrayBuffer(d)||f.isTypedArray(d)?c&&typeof Blob=="function"?new Blob([d]):Buffer.from(d):d}function h(d,p,y){let m=d;if(d&&!y&&typeof d=="object"){if(f.endsWith(p,"{}"))p=r?p:p.slice(0,-2),d=JSON.stringify(d);else if(f.isArray(d)&&Ea(d)||(f.isFileList(d)||f.endsWith(p,"[]"))&&(m=f.toArray(d)))return p=Ss(p),m.forEach(function(C,T){!(f.isUndefined(C)||C===null)&&e.append(a===!0?wr([p],T,i):a===null?p:p+"[]",l(C))}),!1}return yn(d)?!0:(e.append(wr(y,p,i),l(d)),!1)}const u=[],w=Object.assign(Pa,{defaultVisitor:h,convertValue:l,isVisitable:yn});function b(d,p){if(!f.isUndefined(d)){if(u.indexOf(d)!==-1)throw Error("Circular reference detected in "+p.join("."));u.push(d),f.forEach(d,function(m,_){(!(f.isUndefined(m)||m===null)&&s.call(e,m,f.isString(_)?_.trim():_,p,w))===!0&&b(m,p?p.concat(_):[_])}),u.pop()}}if(!f.isObject(n))throw new TypeError("data must be an object");return b(n),e}function br(n){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(r){return e[r]})}function $n(n,e){this._pairs=[],n&&Ut(n,this,e)}const As=$n.prototype;As.append=function(e,t){this._pairs.push([e,t])};As.toString=function(e){const t=e?function(r){return e.call(this,r,br)}:br;return this._pairs.map(function(s){return t(s[0])+"="+t(s[1])},"").join("&")};function xa(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Rs(n,e,t){if(!e)return n;const r=t&&t.encode||xa,s=t&&t.serialize;let i;if(s?i=s(e,t):i=f.isURLSearchParams(e)?e.toString():new $n(e,t).toString(r),i){const a=n.indexOf("#");a!==-1&&(n=n.slice(0,a)),n+=(n.indexOf("?")===-1?"?":"&")+i}return n}class Ta{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){f.forEach(this.handlers,function(r){r!==null&&e(r)})}}const _r=Ta,Cs={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},va=typeof URLSearchParams<"u"?URLSearchParams:$n,Oa=typeof FormData<"u"?FormData:null,ka=typeof Blob<"u"?Blob:null,Ma={isBrowser:!0,classes:{URLSearchParams:va,FormData:Oa,Blob:ka},protocols:["http","https","file","blob","url","data"]},Es=typeof window<"u"&&typeof document<"u",Fa=(n=>Es&&["ReactNative","NativeScript","NS"].indexOf(n)<0)(typeof navigator<"u"&&navigator.product),Ia=(()=>typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),La=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Es,hasStandardBrowserEnv:Fa,hasStandardBrowserWebWorkerEnv:Ia},Symbol.toStringTag,{value:"Module"})),Z={...La,...Ma};function Na(n,e){return Ut(n,new Z.classes.URLSearchParams,Object.assign({visitor:function(t,r,s,i){return Z.isNode&&f.isBuffer(t)?(this.append(r,t.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)}},e))}function Ba(n){return f.matchAll(/\w+|\[(\w*)]/g,n).map(e=>e[0]==="[]"?"":e[1]||e[0])}function $a(n){const e={},t=Object.keys(n);let r;const s=t.length;let i;for(r=0;r<s;r++)i=t[r],e[i]=n[i];return e}function Ps(n){function e(t,r,s,i){let a=t[i++];if(a==="__proto__")return!0;const o=Number.isFinite(+a),c=i>=t.length;return a=!a&&f.isArray(s)?s.length:a,c?(f.hasOwnProp(s,a)?s[a]=[s[a],r]:s[a]=r,!o):((!s[a]||!f.isObject(s[a]))&&(s[a]=[]),e(t,r,s[a],i)&&f.isArray(s[a])&&(s[a]=$a(s[a])),!o)}if(f.isFormData(n)&&f.isFunction(n.entries)){const t={};return f.forEachEntry(n,(r,s)=>{e(Ba(r),s,t,0)}),t}return null}function Wa(n,e,t){if(f.isString(n))try{return(e||JSON.parse)(n),f.trim(n)}catch(r){if(r.name!=="SyntaxError")throw r}return(t||JSON.stringify)(n)}const Wn={transitional:Cs,adapter:["xhr","http"],transformRequest:[function(e,t){const r=t.getContentType()||"",s=r.indexOf("application/json")>-1,i=f.isObject(e);if(i&&f.isHTMLForm(e)&&(e=new FormData(e)),f.isFormData(e))return s?JSON.stringify(Ps(e)):e;if(f.isArrayBuffer(e)||f.isBuffer(e)||f.isStream(e)||f.isFile(e)||f.isBlob(e))return e;if(f.isArrayBufferView(e))return e.buffer;if(f.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let o;if(i){if(r.indexOf("application/x-www-form-urlencoded")>-1)return Na(e,this.formSerializer).toString();if((o=f.isFileList(e))||r.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return Ut(o?{"files[]":e}:e,c&&new c,this.formSerializer)}}return i||s?(t.setContentType("application/json",!1),Wa(e)):e}],transformResponse:[function(e){const t=this.transitional||Wn.transitional,r=t&&t.forcedJSONParsing,s=this.responseType==="json";if(e&&f.isString(e)&&(r&&!this.responseType||s)){const a=!(t&&t.silentJSONParsing)&&s;try{return JSON.parse(e)}catch(o){if(a)throw o.name==="SyntaxError"?A.from(o,A.ERR_BAD_RESPONSE,this,null,this.response):o}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Z.classes.FormData,Blob:Z.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};f.forEach(["delete","get","head","post","put","patch"],n=>{Wn.headers[n]={}});const jn=Wn,ja=f.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Da=n=>{const e={};let t,r,s;return n&&n.split(`
`).forEach(function(a){s=a.indexOf(":"),t=a.substring(0,s).trim().toLowerCase(),r=a.substring(s+1).trim(),!(!t||e[t]&&ja[t])&&(t==="set-cookie"?e[t]?e[t].push(r):e[t]=[r]:e[t]=e[t]?e[t]+", "+r:r)}),e},Sr=Symbol("internals");function Re(n){return n&&String(n).trim().toLowerCase()}function ct(n){return n===!1||n==null?n:f.isArray(n)?n.map(ct):String(n)}function Ua(n){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=t.exec(n);)e[r[1]]=r[2];return e}const qa=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function en(n,e,t,r,s){if(f.isFunction(r))return r.call(this,e,t);if(s&&(e=t),!!f.isString(e)){if(f.isString(r))return e.indexOf(r)!==-1;if(f.isRegExp(r))return r.test(e)}}function Ha(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,r)=>t.toUpperCase()+r)}function Va(n,e){const t=f.toCamelCase(" "+e);["get","set","has"].forEach(r=>{Object.defineProperty(n,r+t,{value:function(s,i,a){return this[r].call(this,e,s,i,a)},configurable:!0})})}class qt{constructor(e){e&&this.set(e)}set(e,t,r){const s=this;function i(o,c,l){const h=Re(c);if(!h)throw new Error("header name must be a non-empty string");const u=f.findKey(s,h);(!u||s[u]===void 0||l===!0||l===void 0&&s[u]!==!1)&&(s[u||c]=ct(o))}const a=(o,c)=>f.forEach(o,(l,h)=>i(l,h,c));return f.isPlainObject(e)||e instanceof this.constructor?a(e,t):f.isString(e)&&(e=e.trim())&&!qa(e)?a(Da(e),t):e!=null&&i(t,e,r),this}get(e,t){if(e=Re(e),e){const r=f.findKey(this,e);if(r){const s=this[r];if(!t)return s;if(t===!0)return Ua(s);if(f.isFunction(t))return t.call(this,s,r);if(f.isRegExp(t))return t.exec(s);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Re(e),e){const r=f.findKey(this,e);return!!(r&&this[r]!==void 0&&(!t||en(this,this[r],r,t)))}return!1}delete(e,t){const r=this;let s=!1;function i(a){if(a=Re(a),a){const o=f.findKey(r,a);o&&(!t||en(r,r[o],o,t))&&(delete r[o],s=!0)}}return f.isArray(e)?e.forEach(i):i(e),s}clear(e){const t=Object.keys(this);let r=t.length,s=!1;for(;r--;){const i=t[r];(!e||en(this,this[i],i,e,!0))&&(delete this[i],s=!0)}return s}normalize(e){const t=this,r={};return f.forEach(this,(s,i)=>{const a=f.findKey(r,i);if(a){t[a]=ct(s),delete t[i];return}const o=e?Ha(i):String(i).trim();o!==i&&delete t[i],t[o]=ct(s),r[o]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return f.forEach(this,(r,s)=>{r!=null&&r!==!1&&(t[s]=e&&f.isArray(r)?r.join(", "):r)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const r=new this(e);return t.forEach(s=>r.set(s)),r}static accessor(e){const r=(this[Sr]=this[Sr]={accessors:{}}).accessors,s=this.prototype;function i(a){const o=Re(a);r[o]||(Va(s,a),r[o]=!0)}return f.isArray(e)?e.forEach(i):i(e),this}}qt.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);f.reduceDescriptors(qt.prototype,({value:n},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>n,set(r){this[t]=r}}});f.freezeMethods(qt);const se=qt;function tn(n,e){const t=this||jn,r=e||t,s=se.from(r.headers);let i=r.data;return f.forEach(n,function(o){i=o.call(t,i,s.normalize(),e?e.status:void 0)}),s.normalize(),i}function xs(n){return!!(n&&n.__CANCEL__)}function He(n,e,t){A.call(this,n??"canceled",A.ERR_CANCELED,e,t),this.name="CanceledError"}f.inherits(He,A,{__CANCEL__:!0});function Ja(n,e,t){const r=t.config.validateStatus;!t.status||!r||r(t.status)?n(t):e(new A("Request failed with status code "+t.status,[A.ERR_BAD_REQUEST,A.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}const Xa=Z.hasStandardBrowserEnv?{write(n,e,t,r,s,i){const a=[n+"="+encodeURIComponent(e)];f.isNumber(t)&&a.push("expires="+new Date(t).toGMTString()),f.isString(r)&&a.push("path="+r),f.isString(s)&&a.push("domain="+s),i===!0&&a.push("secure"),document.cookie=a.join("; ")},read(n){const e=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(n){this.write(n,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Ga(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function za(n,e){return e?n.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):n}function Ts(n,e){return n&&!Ga(e)?za(n,e):e}const Ka=Z.hasStandardBrowserEnv?function(){const e=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a");let r;function s(i){let a=i;return e&&(t.setAttribute("href",a),a=t.href),t.setAttribute("href",a),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:t.pathname.charAt(0)==="/"?t.pathname:"/"+t.pathname}}return r=s(window.location.href),function(a){const o=f.isString(a)?s(a):a;return o.protocol===r.protocol&&o.host===r.host}}():function(){return function(){return!0}}();function Qa(n){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return e&&e[1]||""}function Ya(n,e){n=n||10;const t=new Array(n),r=new Array(n);let s=0,i=0,a;return e=e!==void 0?e:1e3,function(c){const l=Date.now(),h=r[i];a||(a=l),t[s]=c,r[s]=l;let u=i,w=0;for(;u!==s;)w+=t[u++],u=u%n;if(s=(s+1)%n,s===i&&(i=(i+1)%n),l-a<e)return;const b=h&&l-h;return b?Math.round(w*1e3/b):void 0}}function Ar(n,e){let t=0;const r=Ya(50,250);return s=>{const i=s.loaded,a=s.lengthComputable?s.total:void 0,o=i-t,c=r(o),l=i<=a;t=i;const h={loaded:i,total:a,progress:a?i/a:void 0,bytes:o,rate:c||void 0,estimated:c&&a&&l?(a-i)/c:void 0,event:s};h[e?"download":"upload"]=!0,n(h)}}const Za=typeof XMLHttpRequest<"u",eo=Za&&function(n){return new Promise(function(t,r){let s=n.data;const i=se.from(n.headers).normalize();let{responseType:a,withXSRFToken:o}=n,c;function l(){n.cancelToken&&n.cancelToken.unsubscribe(c),n.signal&&n.signal.removeEventListener("abort",c)}let h;if(f.isFormData(s)){if(Z.hasStandardBrowserEnv||Z.hasStandardBrowserWebWorkerEnv)i.setContentType(!1);else if((h=i.getContentType())!==!1){const[p,...y]=h?h.split(";").map(m=>m.trim()).filter(Boolean):[];i.setContentType([p||"multipart/form-data",...y].join("; "))}}let u=new XMLHttpRequest;if(n.auth){const p=n.auth.username||"",y=n.auth.password?unescape(encodeURIComponent(n.auth.password)):"";i.set("Authorization","Basic "+btoa(p+":"+y))}const w=Ts(n.baseURL,n.url);u.open(n.method.toUpperCase(),Rs(w,n.params,n.paramsSerializer),!0),u.timeout=n.timeout;function b(){if(!u)return;const p=se.from("getAllResponseHeaders"in u&&u.getAllResponseHeaders()),m={data:!a||a==="text"||a==="json"?u.responseText:u.response,status:u.status,statusText:u.statusText,headers:p,config:n,request:u};Ja(function(C){t(C),l()},function(C){r(C),l()},m),u=null}if("onloadend"in u?u.onloadend=b:u.onreadystatechange=function(){!u||u.readyState!==4||u.status===0&&!(u.responseURL&&u.responseURL.indexOf("file:")===0)||setTimeout(b)},u.onabort=function(){u&&(r(new A("Request aborted",A.ECONNABORTED,n,u)),u=null)},u.onerror=function(){r(new A("Network Error",A.ERR_NETWORK,n,u)),u=null},u.ontimeout=function(){let y=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const m=n.transitional||Cs;n.timeoutErrorMessage&&(y=n.timeoutErrorMessage),r(new A(y,m.clarifyTimeoutError?A.ETIMEDOUT:A.ECONNABORTED,n,u)),u=null},Z.hasStandardBrowserEnv&&(o&&f.isFunction(o)&&(o=o(n)),o||o!==!1&&Ka(w))){const p=n.xsrfHeaderName&&n.xsrfCookieName&&Xa.read(n.xsrfCookieName);p&&i.set(n.xsrfHeaderName,p)}s===void 0&&i.setContentType(null),"setRequestHeader"in u&&f.forEach(i.toJSON(),function(y,m){u.setRequestHeader(m,y)}),f.isUndefined(n.withCredentials)||(u.withCredentials=!!n.withCredentials),a&&a!=="json"&&(u.responseType=n.responseType),typeof n.onDownloadProgress=="function"&&u.addEventListener("progress",Ar(n.onDownloadProgress,!0)),typeof n.onUploadProgress=="function"&&u.upload&&u.upload.addEventListener("progress",Ar(n.onUploadProgress)),(n.cancelToken||n.signal)&&(c=p=>{u&&(r(!p||p.type?new He(null,n,u):p),u.abort(),u=null)},n.cancelToken&&n.cancelToken.subscribe(c),n.signal&&(n.signal.aborted?c():n.signal.addEventListener("abort",c)));const d=Qa(w);if(d&&Z.protocols.indexOf(d)===-1){r(new A("Unsupported protocol "+d+":",A.ERR_BAD_REQUEST,n));return}u.send(s||null)})},wn={http:Ca,xhr:eo};f.forEach(wn,(n,e)=>{if(n){try{Object.defineProperty(n,"name",{value:e})}catch{}Object.defineProperty(n,"adapterName",{value:e})}});const Rr=n=>`- ${n}`,to=n=>f.isFunction(n)||n===null||n===!1,vs={getAdapter:n=>{n=f.isArray(n)?n:[n];const{length:e}=n;let t,r;const s={};for(let i=0;i<e;i++){t=n[i];let a;if(r=t,!to(t)&&(r=wn[(a=String(t)).toLowerCase()],r===void 0))throw new A(`Unknown adapter '${a}'`);if(r)break;s[a||"#"+i]=r}if(!r){const i=Object.entries(s).map(([o,c])=>`adapter ${o} `+(c===!1?"is not supported by the environment":"is not available in the build"));let a=e?i.length>1?`since :
`+i.map(Rr).join(`
`):" "+Rr(i[0]):"as no adapter specified";throw new A("There is no suitable adapter to dispatch the request "+a,"ERR_NOT_SUPPORT")}return r},adapters:wn};function nn(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new He(null,n)}function Cr(n){return nn(n),n.headers=se.from(n.headers),n.data=tn.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),vs.getAdapter(n.adapter||jn.adapter)(n).then(function(r){return nn(n),r.data=tn.call(n,n.transformResponse,r),r.headers=se.from(r.headers),r},function(r){return xs(r)||(nn(n),r&&r.response&&(r.response.data=tn.call(n,n.transformResponse,r.response),r.response.headers=se.from(r.response.headers))),Promise.reject(r)})}const Er=n=>n instanceof se?{...n}:n;function _e(n,e){e=e||{};const t={};function r(l,h,u){return f.isPlainObject(l)&&f.isPlainObject(h)?f.merge.call({caseless:u},l,h):f.isPlainObject(h)?f.merge({},h):f.isArray(h)?h.slice():h}function s(l,h,u){if(f.isUndefined(h)){if(!f.isUndefined(l))return r(void 0,l,u)}else return r(l,h,u)}function i(l,h){if(!f.isUndefined(h))return r(void 0,h)}function a(l,h){if(f.isUndefined(h)){if(!f.isUndefined(l))return r(void 0,l)}else return r(void 0,h)}function o(l,h,u){if(u in e)return r(l,h);if(u in n)return r(void 0,l)}const c={url:i,method:i,data:i,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:o,headers:(l,h)=>s(Er(l),Er(h),!0)};return f.forEach(Object.keys(Object.assign({},n,e)),function(h){const u=c[h]||s,w=u(n[h],e[h],h);f.isUndefined(w)&&u!==o||(t[h]=w)}),t}const Os="1.6.8",Dn={};["object","boolean","number","function","string","symbol"].forEach((n,e)=>{Dn[n]=function(r){return typeof r===n||"a"+(e<1?"n ":" ")+n}});const Pr={};Dn.transitional=function(e,t,r){function s(i,a){return"[Axios v"+Os+"] Transitional option '"+i+"'"+a+(r?". "+r:"")}return(i,a,o)=>{if(e===!1)throw new A(s(a," has been removed"+(t?" in "+t:"")),A.ERR_DEPRECATED);return t&&!Pr[a]&&(Pr[a]=!0,console.warn(s(a," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(i,a,o):!0}};function no(n,e,t){if(typeof n!="object")throw new A("options must be an object",A.ERR_BAD_OPTION_VALUE);const r=Object.keys(n);let s=r.length;for(;s-- >0;){const i=r[s],a=e[i];if(a){const o=n[i],c=o===void 0||a(o,i,n);if(c!==!0)throw new A("option "+i+" must be "+c,A.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new A("Unknown option "+i,A.ERR_BAD_OPTION)}}const bn={assertOptions:no,validators:Dn},oe=bn.validators;class Nt{constructor(e){this.defaults=e,this.interceptors={request:new _r,response:new _r}}async request(e,t){try{return await this._request(e,t)}catch(r){if(r instanceof Error){let s;Error.captureStackTrace?Error.captureStackTrace(s={}):s=new Error;const i=s.stack?s.stack.replace(/^.+\n/,""):"";r.stack?i&&!String(r.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+i):r.stack=i}throw r}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=_e(this.defaults,t);const{transitional:r,paramsSerializer:s,headers:i}=t;r!==void 0&&bn.assertOptions(r,{silentJSONParsing:oe.transitional(oe.boolean),forcedJSONParsing:oe.transitional(oe.boolean),clarifyTimeoutError:oe.transitional(oe.boolean)},!1),s!=null&&(f.isFunction(s)?t.paramsSerializer={serialize:s}:bn.assertOptions(s,{encode:oe.function,serialize:oe.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let a=i&&f.merge(i.common,i[t.method]);i&&f.forEach(["delete","get","head","post","put","patch","common"],d=>{delete i[d]}),t.headers=se.concat(a,i);const o=[];let c=!0;this.interceptors.request.forEach(function(p){typeof p.runWhen=="function"&&p.runWhen(t)===!1||(c=c&&p.synchronous,o.unshift(p.fulfilled,p.rejected))});const l=[];this.interceptors.response.forEach(function(p){l.push(p.fulfilled,p.rejected)});let h,u=0,w;if(!c){const d=[Cr.bind(this),void 0];for(d.unshift.apply(d,o),d.push.apply(d,l),w=d.length,h=Promise.resolve(t);u<w;)h=h.then(d[u++],d[u++]);return h}w=o.length;let b=t;for(u=0;u<w;){const d=o[u++],p=o[u++];try{b=d(b)}catch(y){p.call(this,y);break}}try{h=Cr.call(this,b)}catch(d){return Promise.reject(d)}for(u=0,w=l.length;u<w;)h=h.then(l[u++],l[u++]);return h}getUri(e){e=_e(this.defaults,e);const t=Ts(e.baseURL,e.url);return Rs(t,e.params,e.paramsSerializer)}}f.forEach(["delete","get","head","options"],function(e){Nt.prototype[e]=function(t,r){return this.request(_e(r||{},{method:e,url:t,data:(r||{}).data}))}});f.forEach(["post","put","patch"],function(e){function t(r){return function(i,a,o){return this.request(_e(o||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:i,data:a}))}}Nt.prototype[e]=t(),Nt.prototype[e+"Form"]=t(!0)});const lt=Nt;class Un{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(i){t=i});const r=this;this.promise.then(s=>{if(!r._listeners)return;let i=r._listeners.length;for(;i-- >0;)r._listeners[i](s);r._listeners=null}),this.promise.then=s=>{let i;const a=new Promise(o=>{r.subscribe(o),i=o}).then(s);return a.cancel=function(){r.unsubscribe(i)},a},e(function(i,a,o){r.reason||(r.reason=new He(i,a,o),t(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}static source(){let e;return{token:new Un(function(s){e=s}),cancel:e}}}const ro=Un;function so(n){return function(t){return n.apply(null,t)}}function io(n){return f.isObject(n)&&n.isAxiosError===!0}const _n={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(_n).forEach(([n,e])=>{_n[e]=n});const ao=_n;function ks(n){const e=new lt(n),t=fs(lt.prototype.request,e);return f.extend(t,lt.prototype,e,{allOwnKeys:!0}),f.extend(t,e,null,{allOwnKeys:!0}),t.create=function(s){return ks(_e(n,s))},t}const v=ks(jn);v.Axios=lt;v.CanceledError=He;v.CancelToken=ro;v.isCancel=xs;v.VERSION=Os;v.toFormData=Ut;v.AxiosError=A;v.Cancel=v.CanceledError;v.all=function(e){return Promise.all(e)};v.spread=so;v.isAxiosError=io;v.mergeConfig=_e;v.AxiosHeaders=se;v.formToJSON=n=>Ps(f.isHTMLForm(n)?new FormData(n):n);v.getAdapter=vs.getAdapter;v.HttpStatusCode=ao;v.default=v;const oo=v;class co{constructor(e){H(this,"openai",null);H(this,"descriptionOfUser");H(this,"chatHistory");this.descriptionOfUser=e,this.chatHistory=[],this.initializeOpenAI()}async initializeOpenAI(){try{const t=(await oo.get("https://key-getter-b64d10ddaae7.herokuapp.com/api/key")).data.key;this.openai=new qi({dangerouslyAllowBrowser:!0,apiKey:t})}catch(e){console.error("Error initializing OpenAI:",e)}}async respondTo(e){var r;if(!this.openai){console.error("OpenAI client is not initialized.");return}let t=this.generatePrompt(e);console.log(t);try{const s=await this.openai.chat.completions.create({messages:[{role:"user",content:t}],model:"gpt-3.5-turbo"}),i=(r=s.choices[0])==null?void 0:r.message.content;if(i==null)throw new Error("OpenAI returned no response: "+JSON.stringify(s));return console.log("OpenAI response:",i),e.forEach(a=>{this.chatHistory.push(a)}),this.chatHistory.push(new us("Toi",i)),i}catch(s){return console.error("An error occurred while generating a response:",s),null}}generatePrompt(e){if(e.length===0)return"";let t=this.descriptionOfUser;return this.chatHistory.length!=0&&(t+=`Voici l'historique de la discussion :
`,this.chatHistory.forEach(r=>{t+="- "+r.content+`
`})),e.length===1?(this.chatHistory.length===0?t+="Répond à ce message de "+e[0].author+" : "+e[0].content:t+="Répond à ce message : "+e[0].content,t):(t+=`Fait une seule réponse pour les messages suivants :
`,e.forEach(r=>{t+="- "+r.content+`
`}),t)}}class lo{constructor(){H(this,"isTyping",!1);H(this,"isSleepModeActive",!1);H(this,"messagesToRespond",[]);H(this,"generateMessage",new co("Tu t'appelles "+WA.player.name+`, tu es un développeur en télétravail. Répond à ces messages pour montrer que tu es en train de travailler et coupe court à la conversation pour gagner du temps. Si possible fait quelques fautes de frappes et utilise quand tu peux des abréviations comme "tkt" pour "t'inquiète" et rajoute des ticks de langages crédibles mais différents à chaque réponses que tu donnes. Évite la ponctuation. Évite de te répéter avec tes anciens messages. Si on te demande, tu n'es pas disponible pour un call, tu dois aller faire caca
`));H(this,"responseTime",0)}respondToMessage(e,t){this.isSleepModeActive&&(this.messagesToRespond.push(t),this.responseTime=Math.floor(Math.random()*15e3)+1e4,console.log("randomTime",this.responseTime),!this.isTyping&&(this.isTyping=!0,setTimeout(async()=>{e.chat.startTyping({scope:"bubble",author:e.player.name});let r=await this.generateMessage.respondTo(this.messagesToRespond);if(r==null){e.chat.sendChatMessage("Désolé, je n'ai pas pu répondre à ta question. Je suis en train de travailler.",{scope:"bubble",author:e.player.name}),e.chat.stopTyping({scope:"bubble",author:e.player.name}),this.isTyping=!1,this.messagesToRespond=[];return}let s=this.getResponseTime(r);console.log(r),console.log("time to type the message",s),setTimeout(()=>{e.chat.sendChatMessage(r,{scope:"bubble",author:e.player.name}),e.chat.stopTyping({scope:"bubble",author:e.player.name}),this.isTyping=!1,this.messagesToRespond=[]},s)},this.responseTime)))}getResponseTime(e){const t=(Math.floor(Math.random()*80)+40)/60*1e3;return e.length*(t/4.8)}}console.log("Script started successfully");let ut;WA.onInit().then(async()=>{console.log("Scripting API ready"),console.log("Player tags: ",WA.player.tags);let n=!1,e;const t=new lo,r=()=>{console.log("Test boutton !"),n=!n,t.isSleepModeActive=n,e!=null&&(e.remove(),e=WA.ui.registerMenuCommand(n?"Se Réveiller !":"C'est l'heure de dormir ^^",{callback:()=>{r()}}))};e=WA.ui.registerMenuCommand(n?"Se Réveiller !":"C'est l'heure de dormir ^^",{callback:()=>{r()}}),await WA.players.configureTracking({players:!0,movement:!1}),WA.chat.onChatMessage((s,i)=>{if(console.log("The local user typed a message",s),i.author!==void 0){console.log("Message author: ",i.author.name);let a=new us(i.author.name,s);t.respondToMessage(WA,a)}},{scope:"bubble"}),WA.room.area.onEnter("clock").subscribe(()=>{const s=new Date,i=s.getHours()+":"+s.getMinutes();ut=WA.ui.openPopup("clockPopup","Ronan "+i,[])}),WA.room.area.onLeave("clock").subscribe(uo),mi().then(()=>{console.log("Scripting API Extra ready")}).catch(s=>console.error(s))}).catch(n=>console.error(n));function uo(){ut!==void 0&&(ut.close(),ut=void 0)}
